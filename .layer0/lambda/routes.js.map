{
  "version": 3,
  "sources": ["../../node_modules/@layer0/core/constants.js", "../../node_modules/@layer0/core/environment.js", "../../node_modules/slash/index.js", "../../node_modules/@layer0/core/utils/nonWebpackRequire.js", "../../node_modules/@layer0/core/context.js", "../../node_modules/@layer0/core/timing.js", "../../node_modules/uuid/dist/rng.js", "../../node_modules/uuid/dist/regex.js", "../../node_modules/uuid/dist/validate.js", "../../node_modules/uuid/dist/stringify.js", "../../node_modules/uuid/dist/v1.js", "../../node_modules/uuid/dist/parse.js", "../../node_modules/uuid/dist/v35.js", "../../node_modules/uuid/dist/md5.js", "../../node_modules/uuid/dist/v3.js", "../../node_modules/uuid/dist/v4.js", "../../node_modules/uuid/dist/sha1.js", "../../node_modules/uuid/dist/v5.js", "../../node_modules/uuid/dist/nil.js", "../../node_modules/uuid/dist/version.js", "../../node_modules/uuid/dist/index.js", "../../node_modules/@layer0/core/router/BaseResponseWriter.js", "../../node_modules/@layer0/core/router/universalRouteUtils.js", "../../node_modules/@layer0/core/utils/mapValues.js", "../../node_modules/@layer0/core/router/CacheManifest.js", "../../node_modules/@layer0/core/router/cacheManifestFromRouter.js", "../../node_modules/@layer0/devtools/addBuiltInRoutes.js", "../../node_modules/@layer0/core/router/addBuiltInRoutes.js", "../../node_modules/@layer0/core/router/BehindEdgeResponseWriterProxy.js", "../../node_modules/@layer0/core/utils/get.js", "../../node_modules/@layer0/core/utils/has.js", "../../node_modules/@layer0/core/node_modules/deepmerge/dist/cjs.js", "../../node_modules/@layer0/core/utils/Validator.js", "../../node_modules/@layer0/core/config.js", "../../node_modules/@layer0/core/utils/toEdgeRegex.js", "../../node_modules/@layer0/core/utils/toHttpMethodMatchRegex.js", "../../node_modules/@layer0/core/utils/convertStringMatcherToRegex.js", "../../node_modules/@layer0/core/utils/bindParamsToPath.js", "../../node_modules/@layer0/core/node_modules/path-to-regexp/src/index.ts", "../../node_modules/@layer0/core/utils/convertParamsToBackReferences.js", "../../node_modules/@layer0/core/utils/isEmpty.js", "../../node_modules/@layer0/core/errors/BackendFetchError.js", "../../node_modules/@layer0/core/router/mergeQueryString.js", "../../node_modules/@layer0/core/router/Backend.js", "../../node_modules/@layer0/core/node_modules/cookie/index.js", "../../node_modules/@layer0/core/utils/identity.js", "../../node_modules/@layer0/core/router/interpolateParams.js", "../../node_modules/eventemitter3/index.js", "../../node_modules/requires-port/index.js", "../../node_modules/http-proxy/lib/http-proxy/common.js", "../../node_modules/http-proxy/lib/http-proxy/passes/web-outgoing.js", "../../node_modules/ms/index.js", "../../node_modules/debug/src/common.js", "../../node_modules/debug/src/browser.js", "../../node_modules/has-flag/index.js", "../../node_modules/supports-color/index.js", "../../node_modules/debug/src/node.js", "../../node_modules/debug/src/index.js", "../../node_modules/follow-redirects/debug.js", "../../node_modules/follow-redirects/index.js", "../../node_modules/http-proxy/lib/http-proxy/passes/web-incoming.js", "../../node_modules/http-proxy/lib/http-proxy/passes/ws-incoming.js", "../../node_modules/http-proxy/lib/http-proxy/index.js", "../../node_modules/http-proxy/lib/http-proxy.js", "../../node_modules/http-proxy/index.js", "../../node_modules/@layer0/core/router/stream.js", "../../node_modules/@layer0/core/router/validateWriter.js", "../../node_modules/@layer0/core/router/normalizeCriteria.js", "../../node_modules/@layer0/core/router/PathMatcher.js", "../../node_modules/@layer0/core/utils/toLower.js", "../../node_modules/@layer0/core/router/Route.js", "../../node_modules/@layer0/core/utils/decode.js", "../../node_modules/yallist/iterator.js", "../../node_modules/yallist/yallist.js", "../../node_modules/lru-cache/index.js", "../../node_modules/lodash.clonedeep/index.js", "../../node_modules/@layer0/core/cache/Cache.js", "../../node_modules/@layer0/core/cache/CacheKey.js", "../../node_modules/@layer0/core/utils/logo.js", "../../node_modules/@layer0/core/router/ResponseWriter.js", "../../node_modules/@layer0/core/utils/validateBackends.js", "../../node_modules/@layer0/core/edge/EdgeResponseWriter.js", "../../node_modules/@layer0/core/router/RequestContext.js", "../../node_modules/@layer0/core/edge/EdgeErrorPageResponseWriter.js", "../../node_modules/@layer0/core/edge/createEdgeConfig.js", "../../node_modules/@layer0/core/utils/minBy.js", "../../node_modules/@layer0/core/utils/Tasks.js", "../../node_modules/@layer0/core/router/PreloadRequests.js", "../../node_modules/@layer0/core/utils/readRawBody.js", "../../node_modules/@layer0/core/source.js", "../../node_modules/@layer0/core/utils/requireInternal.js", "../../node_modules/@layer0/core/router/RouteGroup.js", "../../node_modules/@layer0/core/router/RouteGroupList.js", "../../node_modules/@layer0/core/router/Router.js", "../../node_modules/@layer0/core/router/GroupConfig.js", "../../node_modules/@layer0/core/router/Groups.js", "../../node_modules/@layer0/core/router/CustomCacheKey.js", "../../node_modules/@layer0/core/index.js", "../../node_modules/@layer0/core/router/deriveSurrogateKeysFromJson.js", "../../node_modules/@layer0/core/router/createCustomCacheKey.js", "../../node_modules/@layer0/core/router/index.js", "../../routes.js"],
  "sourcesContent": ["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Layer0 configuration file name.\n */\nexports.LAYER0_CONFIG_FILE = 'layer0.config.js';\n/**\n * Indicate asset files that need to be uploaded under a different\n * bucket key.\n * It contains values like\n * {\n *   '/posts' => '/posts/index.html'\n * }\n */\nexports.LAYER0_ASSET_ALIASES_FILE = 'asset-aliases.json';\n/**\n * Environment variables used by Layer0.\n */\nexports.LAYER0_ENV_VARIABLES = {\n    /**\n     * Layer0 configuration environment variable key.\n     */\n    config: 'LAYER0_CONFIG',\n    /**\n     * Indicates whether code is running locally or in the cloud.\n     * @private\n     */\n    deploymentType: 'LAYER0_DEPLOYMENT_TYPE',\n    /**\n     * Allows Layer0 development team to easily override Layer0 version\n     * during development process.\n     * @private\n     */\n    versionOverride: 'LAYER0_VERSION_OVERRIDE',\n};\n/**\n * Indicates that code is running in AWS.\n * @private\n */\nexports.LAYER0_DEPLOYMENT_TYPE_AWS = 'AWS';\n/**\n * Prefix of all Layer0 headers.\n */\nexports.LAYER0_HEADERS_PREFIX = 'x-0-';\n/**\n * Maximum number of user headers allowed by Layer0 platform.\n *\n * We limit the request and response headers allowed to 70. This is due to a limitation that edge has\n * which at the moment supports up to 96 headers. Edge provider itself needs to use some of those headers\n * with the remainder used by our edge code.\n *\n * NOTE: This constant must be equal ot the constant of the same name defined in Layer0 buffer proxy.\n * NOTE: If this constant is updated then the constant of the same name has to be updated in @layer0/build-lambda module.\n */\nexports.LAYER0_MAX_USER_HEADERS_ALLOWED = 70;\n/**\n * Status code returned when there are too many request or response headers.\n *\n * Must be equal to HeaderOverflowError status code as defined in build lambda and Layer0 buffer proxy.\n */\nexports.LAYER0_TOO_MANY_HEADERS_STATUS_CODE = 542;\n/**\n * The status code returned when the layer0_prefetch query param is present and a response could not be found in the cache.\n */\nexports.LAYER0_UNCACHED_PREFETCH_STATUS = 412;\n/**\n * CDN-as-code configuration actions\n */\nexports.ACTIONS = {\n    setHeader: 'set-header',\n    updateHeader: 'update-header',\n    removeHeader: 'remove-header',\n    syntheticRes: 'synthetic-response',\n    updatePath: 'update-path',\n    proxy: 'proxy',\n    addCookie: 'add-cookie',\n    updateCookie: 'update-cookie',\n    removeCookie: 'remove-cookie',\n};\n/**\n * The backend for cloud functions\n */\nexports.BACKENDS = {\n    js: '__js__',\n    static: '__static__',\n    permanentStatic: '__permanent_static__',\n    imageOptimizer: '__image_optimizer__',\n};\n/**\n * The hostname used for the internal service running the user's application.\n */\nexports.JS_BACKEND_HOSTNAME = '127.0.0.1';\nexports.HTTP_METHODS = {\n    head: 'head',\n    get: 'get',\n    post: 'post',\n    delete: 'delete',\n    put: 'put',\n    patch: 'patch',\n    options: 'options',\n};\n/**\n * Common HTTP headers.\n */\nexports.HTTP_HEADERS = {\n    authorization: 'authorization',\n    acceptEncoding: 'accept-encoding',\n    cacheControl: 'cache-control',\n    contentEncoding: 'content-encoding',\n    contentLength: 'content-length',\n    contentType: 'content-type',\n    cookie: 'cookie',\n    host: 'host',\n    location: 'location',\n    serverTiming: 'server-timing',\n    setCookie: 'set-cookie',\n    userAgent: 'user-agent',\n    vary: 'vary',\n    via: 'via',\n    xForwardedFor: 'x-forwarded-for',\n    xRequestId: 'x-request-id',\n    xSwCacheControl: 'x-sw-cache-control',\n    x0Browser: 'x-0-browser',\n    x0CacheControl: 'x-0-cache-control',\n    x0CachingStatus: 'x-0-caching-status',\n    x0ClientIp: 'x-0-client-ip',\n    x0Components: 'x-0-components',\n    x0Destination: 'x-0-destination',\n    x0Device: 'x-0-device',\n    x0DeviceIsBot: 'x-0-device-is-bot',\n    x0GeoCity: 'x-0-geo-city',\n    x0GeoCountryCode: 'x-0-geo-country-code',\n    x0GeoLatitude: 'x-0-geo-latitude',\n    x0GeoLongitude: 'x-0-geo-longitude',\n    x0GeoPostalCode: 'x-0-geo-postal-code',\n    x0MatchedRoutes: 'x-0-matched-routes',\n    x0Protocol: 'x-0-protocol',\n    x0Route: 'x-0-route',\n    x0Status: 'x-0-status',\n    x0SurrogateKey: 'x-0-surrogate-key',\n    x0T: 'x-0-t',\n    x0UserT: 'x-0-user-t',\n    x0Vendor: 'x-0-vendor',\n    x0Version: 'x-0-version',\n};\n/**\n * Values for x-0-caching-status\n */\nexports.CACHING_STATUS = {\n    ok: 'ok',\n    private: 'private',\n    method: 'method',\n    bodyTooBig: 'body-too-big',\n    code: 'code',\n    setCookie: 'set-cookie',\n    noMaxAge: 'no-max-age',\n};\nexports.CACHEABLE_METHODS = new Set(['get', 'head']);\n/**\n * When present, this query parameter will cause Layer0 to return a 412 status\n * if a response could not be found in the cache.\n */\nexports.THROTTLED_QUERY_PARAM = 'layer0_prefetch';\n/**\n * Same value as above but DEPRECATED.\n */\nexports.PREFETCH_QUERY_PARAM = exports.THROTTLED_QUERY_PARAM;\n/**\n Labels the request so that devtools will display as prefetched\n */\nexports.DEVTOOLS_PREFETCH_QUERY_PARAM = 'layer0_dt_pf';\n/**\n * The name of the query parameter used to detect HEAD requests.\n */\nexports.HEAD_QUERY_PARAM = 'layer0_head';\n/**\n * The name of the query parameter used for the body of POST requests, which is used for the cache key\n */\nexports.POST_BODY_QUERY_PARAM = 'pref_layer0_body';\n/**\n * The name of the query parameter used for the method of requests, which is used for the cache key\n */\nexports.METHOD_QUERY_PARAM = 'pref_layer0_method';\n/**\n * Route Group name, which is used in router for fallback routes\n */\nexports.ROUTES_FALLBACK = 'fallback';\n/**\n * Route Group name, which is used in router for error page routes\n */\nexports.ROUTES_CATCH_GROUP = 'catch';\n/**\n * Route Group name, which is used in router for noindex routes\n */\nexports.ROUTES_NOINDEX_GROUP = 'noindex';\n/**\n * The path for the built-in image optimizer.\n */\nexports.LAYER0_IMAGE_OPTIMIZER_PATH = '/__layer0_image_optimizer';\n/**\n * Is current environment 'browser'\n */\nexports.IS_BROWSER = typeof window !== 'undefined';\n/**\n * Brotli encoding code.\n */\nexports.BROTLI_ENCODING = 'br';\n/**\n * Gzip encoding code.\n */\nexports.GZIP_ENCODING = 'gzip';\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"./constants\");\n/**\n * Used to determine if the app is running in the cloud.\n * @returns `true` when running in the cloud, `false` otherwise\n */\nfunction isCloud() {\n    return process.env[constants_1.LAYER0_ENV_VARIABLES.deploymentType] === constants_1.LAYER0_DEPLOYMENT_TYPE_AWS;\n}\nexports.isCloud = isCloud;\n/**\n * Returns true when running locally, either in dev or production mode\n */\nfunction isLocal() {\n    return process.env.LAYER0_LOCAL === 'true';\n}\nexports.isLocal = isLocal;\n/**\n * Used to determine if the app is running on a production build.\n * @returns `true` when running a production build, either locally or in the cloud; `false` otherwise\n */\nfunction isProductionBuild() {\n    return process.env.NODE_ENV === 'production';\n}\nexports.isProductionBuild = isProductionBuild;\n/**\n * Used to determine if the app is running in `layer0 run` development environment\n * @returns `true` when running with `layer0 run`without production flag, `false` otherwise\n */\nfunction isLayer0RunDev() {\n    return !isCloud() && !isProductionBuild();\n}\nexports.isLayer0RunDev = isLayer0RunDev;\n/**\n * Determines whether or not we are running in a browser\n * @returns `true` when running in a browser, otherwise false\n */\nfunction isBrowser() {\n    return typeof window !== 'undefined';\n}\nexports.isBrowser = isBrowser;\n", "'use strict';\nmodule.exports = path => {\n\tconst isExtendedLengthPath = /^\\\\\\\\\\?\\\\/.test(path);\n\tconst hasNonAscii = /[^\\u0000-\\u0080]+/.test(path); // eslint-disable-line no-control-regex\n\n\tif (isExtendedLengthPath || hasNonAscii) {\n\t\treturn path;\n\t}\n\n\treturn path.replace(/\\\\/g, '/');\n};\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst slash_1 = __importDefault(require(\"slash\"));\n/**\n * Loads a module at runtime, ensuring that it won't be bundled by webpack. This function\n * also ensures proper behavior on windows, *nix, and macos filesystems, even if the module\n * path is derived from a file path with backslashes. This function will return undefined if\n * the module could not be loaded.\n * @param modulePath The path to the module to load\n * @param options.ignoreErrors Will return undefined if the module fails to load\n */\nfunction nonWebpackRequire(modulePath, { ignoreErrors = false } = {}) {\n    try {\n        return eval('require')(slash_1.default(modulePath));\n    }\n    catch (e) {\n        if (ignoreErrors) {\n            return undefined;\n        }\n        else {\n            throw e;\n        }\n    }\n}\nexports.default = nonWebpackRequire;\n", "\"use strict\";\n/**\n * This module provides a context that can be used to store request\n * state. For example, accumulating timing metrics from various layers\n * during the life of the request.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst environment_1 = require(\"./environment\");\nconst nonWebpackRequire_1 = __importDefault(require(\"./utils/nonWebpackRequire\"));\nconst CONTEXT = 'layer0';\nlet clsNamespace;\n/**\n * Runs the specified callback within the specified context\n * @param cb\n */\nfunction withContext(cb) {\n    if (environment_1.isLocal()) {\n        return createClsNamespace().runAndReturn(cb);\n    }\n    else {\n        global.__layer0_timings__ = new SingletonContext();\n        return cb();\n    }\n}\nexports.withContext = withContext;\n/**\n * Returns the current context.\n */\nfunction getContext() {\n    return global.__layer0_timings__ || getClsNamespace();\n}\n/**\n * Creates a new CLS-hooked namespace\n */\nfunction createClsNamespace() {\n    const cls = nonWebpackRequire_1.default('cls-hooked');\n    if (!clsNamespace) {\n        clsNamespace = cls.createNamespace(CONTEXT);\n    }\n    return clsNamespace;\n}\n/**\n * Gets the current CLS-hooked namespace\n */\nfunction getClsNamespace() {\n    return nonWebpackRequire_1.default('cls-hooked').getNamespace(CONTEXT);\n}\n/**\n * Gets a value from the current context\n * @param key The name of the variable to get\n * @param defaultValue A default value to set and return if no value is found.\n */\nfunction get(key, defaultValue) {\n    try {\n        const context = getContext();\n        let value = context.get(key);\n        if (value == null) {\n            value = defaultValue;\n            context.set(key, defaultValue);\n        }\n        return value;\n    }\n    catch (e) {\n        return defaultValue;\n    }\n}\nexports.get = get;\n/**\n * Sets a value on the current context\n * @param key The variable to set\n * @param value The value to store\n */\nfunction set(key, value) {\n    try {\n        getContext().set(key, value);\n    }\n    catch (e) {\n        throw new Error('set must be called within withContext');\n    }\n}\nexports.set = set;\n/**\n *\n */\nclass SingletonContext {\n    constructor() {\n        this.values = {};\n    }\n    get(key) {\n        return this.values[key];\n    }\n    set(key, value) {\n        this.values[key] = value;\n    }\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"./constants\");\nconst context_1 = require(\"./context\");\nexports.NOT_ENDED_VALUE = 'na';\nclass InternalTiming {\n    /**\n     * @param name The name of the timing component that will be reported in the `x-0-user-t` header\n     */\n    constructor(name, internal = true) {\n        /**\n         * The number of milliseconds elapsed\n         */\n        this.duration = 0;\n        /**\n         * Set to true if the timing has been ended\n         */\n        this.ended = false;\n        this.name = name;\n        const timings = internal ? internalTimings() : userTimings();\n        timings.push(this);\n    }\n    /**\n     * Starts the timing.\n     * @returns A self-reference, suitable for chaining\n     */\n    start() {\n        this.startTime = new Date();\n        this.ended = false;\n        return this;\n    }\n    /**\n     * Sets the discrete value for this timing\n     * @param discreteValue\n     * @returns A self-reference, suitable for chaining\n     */\n    set(discreteValue) {\n        this.discreteValue = discreteValue;\n        return this;\n    }\n    /**\n     * Ends the timing.\n     * @returns A self-reference, suitable for chaining\n     */\n    end() {\n        if (!this.startTime) {\n            console.warn(`Timing ${this.name} not started.`);\n            return this;\n        }\n        this.ended = true;\n        this.duration += new Date().getTime() - this.startTime.getTime();\n        return this;\n    }\n    /**\n     * Convenience method that is the same as `end`, but meant to indicate\n     * that the timing may be resumed later\n     */\n    pause() {\n        return this.end();\n    }\n    /**\n     * Convenience method that is the same as `start`, but meant to indicate\n     * that the timing has been paused.\n     */\n    resume() {\n        return this.start();\n    }\n    /**\n     * Gets the value of the timing for response headers. Will be 'na' if not started, otherwise\n     * the numeric duration in milliseconds.\n     */\n    get value() {\n        if (this.discreteValue != null) {\n            return this.discreteValue;\n        }\n        else {\n            return this.ended ? this.duration : exports.NOT_ENDED_VALUE;\n        }\n    }\n}\nexports.InternalTiming = InternalTiming;\n/**\n * A higher order function that wraps the provided function in a request context with user\n * and internal timings reset\n * @private\n * @param handler\n */\nfunction withTimings(handler) {\n    return (...args) => {\n        return context_1.withContext(() => {\n            return handler(...args);\n        });\n    };\n}\nexports.withTimings = withTimings;\n/**\n * Returns the value of the internal timing with the specified name\n * @private\n * @param name The name of an internal timing, for example \"ecc\"\n */\nfunction getInternalTiming(name) {\n    var _a;\n    return (_a = internalTimings().find(t => t.name === name)) === null || _a === void 0 ? void 0 : _a.value;\n}\nexports.getInternalTiming = getInternalTiming;\n/**\n * Returns the internal timings from the current request context\n * @private\n */\nfunction internalTimings() {\n    return context_1.get('internalTimings', []);\n}\n/**\n * Returns the user timings from the current request context\n * @private\n */\nfunction userTimings() {\n    return context_1.get('userTimings', []);\n}\n/**\n * Adds x-0-t, x-0-user-t, and server-timing headers to the response\n * @private\n * @param response\n */\nfunction addTimings(response) {\n    const userT = userTimings();\n    const internalT = internalTimings();\n    if (userT.length) {\n        response.setHeader(constants_1.HTTP_HEADERS.x0UserT, getTimingsResponseHeader(userT));\n        response.setHeader(constants_1.HTTP_HEADERS.serverTiming, appendServerTimings(response));\n    }\n    if (internalT.length) {\n        response.setHeader(constants_1.HTTP_HEADERS.x0T, getTimingsResponseHeader(internalT));\n    }\n}\nexports.addTimings = addTimings;\n/**\n * Gets the value of the x-0-user-t header.\n * @private\n */\nfunction getTimingsResponseHeader(timings) {\n    return timings.map(t => `${t.name}=${t.value}`).join(',');\n}\n/**\n * Returns the user timings in server-timing response header format\n * @private\n */\nfunction appendServerTimings(response) {\n    const existingHeader = response.getHeader(constants_1.HTTP_HEADERS.serverTiming);\n    const timings = userTimings().map(t => `${t.name};dur=${t.value}`);\n    if (Array.isArray(existingHeader)) {\n        timings.push(...existingHeader);\n    }\n    else if (existingHeader) {\n        timings.push(existingHeader);\n    }\n    return timings.join(', ');\n}\n/**\n * Allows you to track the performance of your code and asynchronous operations such as fetches.\n * Timings will be returned as a comma delimited list in the `x-0-user-t` header.\n *\n * ** Example **\n *\n * ```js\n * import Timing from '@layer0/core/timing'\n *\n * const timing = new Timing('fetch').start()\n * const result = await fetch('http://my-api.com/products/1')\n * timing.end() // will result in `x-0-user-t: fetch=(millis)` response header\n * ```\n *\n * If a timing is started but not finished by the time the response is sent, the value will be `na`.\n */\nclass Timing extends InternalTiming {\n    constructor(name) {\n        super(name, false);\n    }\n}\nexports.default = Timing;\n/**\n * Names for x-0-t components\n */\nvar InternalNames;\n(function (InternalNames) {\n    InternalNames[\"edgeCache\"] = \"ecc\";\n    InternalNames[\"transformRequest\"] = \"wa\";\n    InternalNames[\"transformResponse\"] = \"wz\";\n    InternalNames[\"routeMatching\"] = \"wr\";\n    InternalNames[\"proxying\"] = \"wp\";\n})(InternalNames = exports.InternalNames || (exports.InternalNames = {}));\n/**\n * Values for edgeCache component of x-0-t\n */\nvar CacheValue;\n(function (CacheValue) {\n    CacheValue[\"hit\"] = \"hit\";\n    CacheValue[\"pass\"] = \"pass\";\n    CacheValue[\"cached\"] = \"cached\";\n})(CacheValue = exports.CacheValue || (exports.CacheValue = {}));\n", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = rng;\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst rnds8Pool = new Uint8Array(256); // # of random values to pre-allocate\n\nlet poolPtr = rnds8Pool.length;\n\nfunction rng() {\n  if (poolPtr > rnds8Pool.length - 16) {\n    _crypto.default.randomFillSync(rnds8Pool);\n\n    poolPtr = 0;\n  }\n\n  return rnds8Pool.slice(poolPtr, poolPtr += 16);\n}", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _default = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regex = _interopRequireDefault(require(\"./regex.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && _regex.default.test(uuid);\n}\n\nvar _default = validate;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _validate = _interopRequireDefault(require(\"./validate.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  const uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!(0, _validate.default)(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nvar _default = stringify;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _rng = _interopRequireDefault(require(\"./rng.js\"));\n\nvar _stringify = _interopRequireDefault(require(\"./stringify.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\nlet _nodeId;\n\nlet _clockseq; // Previous uuid creation time\n\n\nlet _lastMSecs = 0;\nlet _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details\n\nfunction v1(options, buf, offset) {\n  let i = buf && offset || 0;\n  const b = buf || new Array(16);\n  options = options || {};\n  let node = options.node || _nodeId;\n  let clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n\n  if (node == null || clockseq == null) {\n    const seedBytes = options.random || (options.rng || _rng.default)();\n\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n\n\n  let msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n\n  let nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)\n\n  const dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression\n\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n\n\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  } // Per 4.2.1.2 Throw error if too many uuids are requested\n\n\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n\n  msecs += 12219292800000; // `time_low`\n\n  const tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff; // `time_mid`\n\n  const tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff; // `time_high_and_version`\n\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n\n  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n\n  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`\n\n  b[i++] = clockseq & 0xff; // `node`\n\n  for (let n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf || (0, _stringify.default)(b);\n}\n\nvar _default = v1;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _validate = _interopRequireDefault(require(\"./validate.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction parse(uuid) {\n  if (!(0, _validate.default)(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  let v;\n  const arr = new Uint8Array(16); // Parse ########-....-....-....-............\n\n  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;\n  arr[1] = v >>> 16 & 0xff;\n  arr[2] = v >>> 8 & 0xff;\n  arr[3] = v & 0xff; // Parse ........-####-....-....-............\n\n  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;\n  arr[5] = v & 0xff; // Parse ........-....-####-....-............\n\n  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;\n  arr[7] = v & 0xff; // Parse ........-....-....-####-............\n\n  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;\n  arr[9] = v & 0xff; // Parse ........-....-....-....-############\n  // (Use \"/\" to avoid 32-bit truncation when bit-shifting high-order bytes)\n\n  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;\n  arr[11] = v / 0x100000000 & 0xff;\n  arr[12] = v >>> 24 & 0xff;\n  arr[13] = v >>> 16 & 0xff;\n  arr[14] = v >>> 8 & 0xff;\n  arr[15] = v & 0xff;\n  return arr;\n}\n\nvar _default = parse;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = _default;\nexports.URL = exports.DNS = void 0;\n\nvar _stringify = _interopRequireDefault(require(\"./stringify.js\"));\n\nvar _parse = _interopRequireDefault(require(\"./parse.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction stringToBytes(str) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n\n  const bytes = [];\n\n  for (let i = 0; i < str.length; ++i) {\n    bytes.push(str.charCodeAt(i));\n  }\n\n  return bytes;\n}\n\nconst DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nexports.DNS = DNS;\nconst URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\nexports.URL = URL;\n\nfunction _default(name, version, hashfunc) {\n  function generateUUID(value, namespace, buf, offset) {\n    if (typeof value === 'string') {\n      value = stringToBytes(value);\n    }\n\n    if (typeof namespace === 'string') {\n      namespace = (0, _parse.default)(namespace);\n    }\n\n    if (namespace.length !== 16) {\n      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');\n    } // Compute hash of namespace and value, Per 4.3\n    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =\n    // hashfunc([...namespace, ... value])`\n\n\n    let bytes = new Uint8Array(16 + value.length);\n    bytes.set(namespace);\n    bytes.set(value, namespace.length);\n    bytes = hashfunc(bytes);\n    bytes[6] = bytes[6] & 0x0f | version;\n    bytes[8] = bytes[8] & 0x3f | 0x80;\n\n    if (buf) {\n      offset = offset || 0;\n\n      for (let i = 0; i < 16; ++i) {\n        buf[offset + i] = bytes[i];\n      }\n\n      return buf;\n    }\n\n    return (0, _stringify.default)(bytes);\n  } // Function#name is not settable on some platforms (#270)\n\n\n  try {\n    generateUUID.name = name; // eslint-disable-next-line no-empty\n  } catch (err) {} // For CommonJS default export support\n\n\n  generateUUID.DNS = DNS;\n  generateUUID.URL = URL;\n  return generateUUID;\n}", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction md5(bytes) {\n  if (Array.isArray(bytes)) {\n    bytes = Buffer.from(bytes);\n  } else if (typeof bytes === 'string') {\n    bytes = Buffer.from(bytes, 'utf8');\n  }\n\n  return _crypto.default.createHash('md5').update(bytes).digest();\n}\n\nvar _default = md5;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _v = _interopRequireDefault(require(\"./v35.js\"));\n\nvar _md = _interopRequireDefault(require(\"./md5.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst v3 = (0, _v.default)('v3', 0x30, _md.default);\nvar _default = v3;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _rng = _interopRequireDefault(require(\"./rng.js\"));\n\nvar _stringify = _interopRequireDefault(require(\"./stringify.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n\n  const rnds = options.random || (options.rng || _rng.default)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return (0, _stringify.default)(rnds);\n}\n\nvar _default = v4;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction sha1(bytes) {\n  if (Array.isArray(bytes)) {\n    bytes = Buffer.from(bytes);\n  } else if (typeof bytes === 'string') {\n    bytes = Buffer.from(bytes, 'utf8');\n  }\n\n  return _crypto.default.createHash('sha1').update(bytes).digest();\n}\n\nvar _default = sha1;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _v = _interopRequireDefault(require(\"./v35.js\"));\n\nvar _sha = _interopRequireDefault(require(\"./sha1.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst v5 = (0, _v.default)('v5', 0x50, _sha.default);\nvar _default = v5;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _default = '00000000-0000-0000-0000-000000000000';\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _validate = _interopRequireDefault(require(\"./validate.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction version(uuid) {\n  if (!(0, _validate.default)(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  return parseInt(uuid.substr(14, 1), 16);\n}\n\nvar _default = version;\nexports.default = _default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"v1\", {\n  enumerable: true,\n  get: function () {\n    return _v.default;\n  }\n});\nObject.defineProperty(exports, \"v3\", {\n  enumerable: true,\n  get: function () {\n    return _v2.default;\n  }\n});\nObject.defineProperty(exports, \"v4\", {\n  enumerable: true,\n  get: function () {\n    return _v3.default;\n  }\n});\nObject.defineProperty(exports, \"v5\", {\n  enumerable: true,\n  get: function () {\n    return _v4.default;\n  }\n});\nObject.defineProperty(exports, \"NIL\", {\n  enumerable: true,\n  get: function () {\n    return _nil.default;\n  }\n});\nObject.defineProperty(exports, \"version\", {\n  enumerable: true,\n  get: function () {\n    return _version.default;\n  }\n});\nObject.defineProperty(exports, \"validate\", {\n  enumerable: true,\n  get: function () {\n    return _validate.default;\n  }\n});\nObject.defineProperty(exports, \"stringify\", {\n  enumerable: true,\n  get: function () {\n    return _stringify.default;\n  }\n});\nObject.defineProperty(exports, \"parse\", {\n  enumerable: true,\n  get: function () {\n    return _parse.default;\n  }\n});\n\nvar _v = _interopRequireDefault(require(\"./v1.js\"));\n\nvar _v2 = _interopRequireDefault(require(\"./v3.js\"));\n\nvar _v3 = _interopRequireDefault(require(\"./v4.js\"));\n\nvar _v4 = _interopRequireDefault(require(\"./v5.js\"));\n\nvar _nil = _interopRequireDefault(require(\"./nil.js\"));\n\nvar _version = _interopRequireDefault(require(\"./version.js\"));\n\nvar _validate = _interopRequireDefault(require(\"./validate.js\"));\n\nvar _stringify = _interopRequireDefault(require(\"./stringify.js\"));\n\nvar _parse = _interopRequireDefault(require(\"./parse.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst url_1 = __importDefault(require(\"url\"));\nconst querystring_1 = __importDefault(require(\"querystring\"));\n/**\n * @private\n * Having a no-op BaseResponseWriter makes it easy for us to stub out the writer\n * when introspecing the router.  This is needed to implement Router.getPrefetchableRoutes\n */\nclass BaseResponseWriter {\n    constructor(req, res, route) { }\n    cache(options) { }\n    redirect(to, options) { }\n    /**\n     * Translates redirect params into normalized version that solves backward compatibility\n     * issues and also takes into account query parameters that may be included in the query\n     * string itself.\n     *\n     * @param to string to where we are redirecting the request; may have query string\n     * @param options options with which we are redirecting the request\n     */\n    _readRedirectParams(to, options) {\n        const { statusCode = 302, query = {} } = \n        // Retro-compatibility, second argument used to be statusCode\n        typeof options === 'number' ? { statusCode: options } : options;\n        // Parse `to` param to extract query strings from it.\n        let toQuery = {};\n        const parsedTo = url_1.default.parse(to);\n        // istanbul ignore next - ?. gives istanbul indigestion\n        if (parsedTo === null || parsedTo === void 0 ? void 0 : parsedTo.search) {\n            to = to.substr(0, to.length - parsedTo.search.length);\n            // @ts-ignore: whenever search is truthy query is at least an empty string\n            toQuery = querystring_1.default.parse(parsedTo.query);\n        }\n        return {\n            to,\n            statusCode,\n            query: {\n                ...toQuery,\n                ...query,\n            },\n        };\n    }\n    proxy(backend, options) { }\n    render(cb) { }\n    stream(backend) { }\n    serveStatic(path, options) { }\n    updatePath(destination) { }\n    rewrite(destination, pattern) { }\n    setRequestHeader(name, value) { }\n    updateRequestHeader(name, match, replace) { }\n    removeRequestHeader(name) { }\n    setUpstreamResponseHeader(name, value) { }\n    updateUpstreamResponseHeader(name, match, replace) { }\n    removeUpstreamResponseHeader(name) { }\n    /*\n     * JWTs are only verified on the edge, not locally or on the user lambda\n     * implementation here is empty in ResponseWriter as here, and overwritten\n     * with some bejaviour in EdgeResponseWriter\n     */\n    verifyJwt(options) { }\n    setResponseHeader(name, value) { }\n    updateResponseHeader(name, match, replace) { }\n    removeResponseHeader(name) { }\n    addResponseCookie(name, value, options) { }\n    updateResponseCookie(name, match, replace) { }\n    removeResponseCookie(name) { }\n    addUpstreamResponseCookie(name, value, options) { }\n    updateUpstreamResponseCookie(name, match, replace) { }\n    removeUpstreamResponseCookie(name) { }\n    send(content, statusCode, statusMessage) { }\n    compute(callback) { }\n    serviceWorker(path) { }\n    allowCors(options) { }\n    appShell(indexHtmlPath) { }\n    renderWithApp(options) { }\n}\nexports.BaseResponseWriter = BaseResponseWriter;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*\nNote: this file contains functions that are needed in both the browser and the server.  These were originally\nin Route.ts, but extracted in order to keep Route.ts and it's depedencies from being pulled into the browser bundle.\n*/\nconst identity = (x) => x;\n/**\n * Compares criteria object with request object and returns Boolean.\n *\n * The comparison of keys is case-sensitive by default but an optional `criteriaObjKeyNameFn`\n * parameter can be passed to force case-insensitive comparison.\n *\n * @param criteriaObj Object that contains the criteria ([key]: regex | null)\n * @param requestObj Request object that contains ([key]: string | [key]: string[] | undefined)\n * @param criteriaObjKeyNameFn Optional function to process criteria key names; by default set to `identity`\n *\n * @returns Boolean\n * true when all conditions are matching\n * false if one of the conditions failed\n */\nfunction matchCriteriaRegexObjectWithRequestObject(criteriaObj, requestObj, criteriaObjKeyNameFn = identity) {\n    let params = {};\n    return (Object.entries(criteriaObj).every(([name, regex]) => {\n        const value = requestObj[criteriaObjKeyNameFn(name)];\n        // When regex is null we match that the value *does not* exist (the undefined case).\n        // When regex is string, we convert it to regex matching the whole string.\n        // When regex is a matching key (ex: ':id') and the value is a string, we extract that into\n        // matcher params\n        if (regex === null) {\n            return value === undefined;\n        }\n        else if (typeof regex === 'string') {\n            if (typeof value === 'string' && isParamMatcher(regex)) {\n                const paramName = paramMatcherToParam(regex);\n                params[paramName] = value;\n                return true;\n            }\n            regex = new RegExp(`^${regex}$`, 'i');\n        }\n        return testRegExp(regex, value);\n    }) && params);\n}\nexports.matchCriteriaRegexObjectWithRequestObject = matchCriteriaRegexObjectWithRequestObject;\n/**\n * Tests to see if source object deeply matches the criteria object\n *\n * @param source Object\n * @param criteria Object\n *\n * @returns boolean\n */\nfunction deepMatchObject(source, criteria) {\n    return Object.entries(criteria).every(([key, criteriaValue]) => {\n        const sourceValue = source[key];\n        if (!sourceValue)\n            return false;\n        if (criteriaValue instanceof RegExp) {\n            return testRegExp(criteriaValue, sourceValue);\n        }\n        else if (typeof criteriaValue === 'object' && criteriaValue !== null) {\n            return deepMatchObject(sourceValue, criteriaValue);\n        }\n        else {\n            return sourceValue == criteriaValue;\n        }\n    });\n}\nexports.deepMatchObject = deepMatchObject;\n/**\n * Returns true if the value is a matcher that is used to extract\n * request params, like ':id' or ':path'\n * @param value\n */\nfunction isParamMatcher(value) {\n    return typeof value === 'string' && /^:\\w+$/.test(value);\n}\nexports.isParamMatcher = isParamMatcher;\n/**\n * Transform a route param matcher to the param name\n * ex: ':id' -> 'id'\n * @param value\n */\nfunction paramMatcherToParam(value) {\n    return value.slice(1);\n}\nexports.paramMatcherToParam = paramMatcherToParam;\n/**\n * Ensures that the regular expression will be tested anew, without changing its internal state.\n *\n * Notes:\n * - Sometimes users use global for RegExp definitions. In those cases `.test` changes the internal\n * state and leads to different requests on subsequent calls (usually flip-flopping between\n * subsequent requests)\n *\n * @private\n * @param regexp Regular expression\n * @param value Value to test or array of values to test\n */\nfunction testRegExp(regexp, value) {\n    if (value == null) {\n        return false;\n    }\n    if (regexp.global) {\n        regexp = new RegExp(regexp);\n    }\n    if (Array.isArray(value)) {\n        return value.some(v => regexp.test(v));\n    }\n    else {\n        return regexp.test(value);\n    }\n}\nexports.testRegExp = testRegExp;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Lightweight port of lodash.mapValues\n * https://lodash.com/docs/4.17.15#mapValues\n * @param obj\n * @param callback\n */\nfunction mapValues(obj, callback) {\n    const result = {};\n    for (let [key, value] of Object.entries(obj)) {\n        result[key] = callback(value, key);\n    }\n    return result;\n}\nexports.default = mapValues;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst universalRouteUtils_1 = require(\"./universalRouteUtils\");\nconst mapValues_1 = __importDefault(require(\"../utils/mapValues\"));\n/**\n * A serializable array of route descriptors to be passed to the browser.\n * @private\n */\nclass CacheManifest {\n    constructor(entries) {\n        this.entries = entries || [];\n    }\n    /**\n     * Returns a list of entries in this CacheManifest where both the browser and\n     * edge cache times are defined, and greater than 0\n     */\n    get cacheableEntries() {\n        return this.entries.filter(CacheManifest.isEntryCacheable);\n    }\n    /**\n     * Returns a list of routes (as RegExp) that are cacheable SPA routes\n     */\n    get spaRoutes() {\n        return this.cacheableEntries\n            .filter(({ cacheOptions }) => cacheOptions.browser && cacheOptions.browser.spa)\n            .map(({ route }) => new RegExp(route, 'i'));\n    }\n    /**\n     * Returns true if the URL should be prefetched, based on the matched route's `cacheOptions`\n     * @param url The URL to test\n     */\n    shouldPrefetch(url) {\n        let doPrefetch = false;\n        this.entries.some(entry => {\n            const matches = CacheManifest.entryMatches(entry, url);\n            if (matches) {\n                doPrefetch =\n                    CacheManifest.isEntryCacheable(entry) || !!entry.cacheOptions.prefetchUpstreamRequests;\n                // if it's prefetchable, or if it matches a stop route, then no need to continue checking:\n                return doPrefetch || entry.returnsResponse;\n            }\n            return false;\n        });\n        return doPrefetch;\n    }\n    /**\n     * Returns true if the entry matches the URL's path, query params, and/or protocol\n     * @param entry The entry to test\n     * @param url URL to check against the entry\n     */\n    static entryMatches(entry, url) {\n        return (new RegExp(entry.route, 'i').test(url.pathname) &&\n            universalRouteUtils_1.matchCriteriaRegexObjectWithRequestObject(mapValues_1.default(entry.query || {}, value => (value ? new RegExp(value, 'i') : null)), Object.fromEntries(Array.from(url.searchParams.entries()))) &&\n            (entry.protocol ? new RegExp(entry.protocol, 'i').test(url.protocol) : true));\n    }\n    /**\n     * Returns true if the given entry has its `cacheOptions` set so that the route\n     * is cacheable by the edge and the browser.\n     * @param entry The entry to test\n     */\n    static isEntryCacheable({ cacheOptions }) {\n        return !!(cacheOptions.browser &&\n            (cacheOptions.browser.serviceWorkerSeconds || 0) > 0 &&\n            cacheOptions.edge &&\n            (cacheOptions.edge.maxAgeSeconds || 0) > 0);\n    }\n    /**\n     * Creates a new `CacheManifest` object from the provided serialized entries\n     */\n    static fromEntries(entries) {\n        return new CacheManifest(entries);\n    }\n    /**\n     * Serializes the list so that it can be passed to the browser\n     */\n    toJSON() {\n        return JSON.stringify(this.entries);\n    }\n}\nexports.default = CacheManifest;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst BaseResponseWriter_1 = require(\"./BaseResponseWriter\");\nconst CacheManifest_1 = __importDefault(require(\"./CacheManifest\"));\nconst mapValues_1 = __importDefault(require(\"../utils/mapValues\"));\n/**\n * Generates a new `CacheManifest` object from the rules given in the provided `Router`\n */\nfunction cacheManifestFromRouter(router) {\n    const manifest = new CacheManifest_1.default();\n    const propToString = (regexOrString) => {\n        if (regexOrString === undefined)\n            return undefined;\n        return regexOrString instanceof RegExp ? regexOrString.source : regexOrString;\n    };\n    for (let route of router.routeGroups.getRoutes()) {\n        const writer = new StubWriter();\n        // @ts-ignore Typescript doesn't like that we're passing in the base class here -\n        // but we keep ResponseWriter on the handler method for documentation purposes\n        route.handler(writer);\n        const entry = {\n            criteriaPath: route.criteria.path,\n            route: route.toRegexString(),\n            method: propToString(route.criteria.method),\n            protocol: propToString(route.criteria.protocol),\n            cacheOptions: writer.cacheOptions,\n            returnsResponse: writer.returnsResponse,\n        };\n        if (route.criteria.query) {\n            // @ts-ignore The lodash response is a Dictionary which confuses TS\n            entry.query = mapValues_1.default(route.criteria.query, (value) => value ? value.source : null);\n        }\n        // Because service worker cannot match on headers and cookies we ignore them\n        // during the creation of cache manifest. This is problematic but it's\n        // less problematic than pretending to not ignore them and creating\n        // routes that are too \"greedy\" (they can never match on headers/cookies\n        // so overall the condition is always weaker and thus matches more than\n        // it should)\n        //\n        // An example of the issues this causes arises when users try to block some\n        // traffic in the router (e.g. from certain countries) The blocking is\n        // based on the geo location headers that are injected into the request\n        // by the edge so aren't even theoretically available for evaluation\n        // in the browser. This leads to service worker matching *all* requests\n        // to something that has no caching options (it only has the blocking code)\n        // leading to service worker rejecting to cache anything, contrary to what\n        // the rest of the router states.\n        if (route.criteria.headers || route.criteria.cookies) {\n            continue;\n        }\n        manifest.entries.push(entry);\n    }\n    return manifest;\n}\nexports.default = cacheManifestFromRouter;\n/**\n * Helper class used to generate manifest entries from a Router\n * @private\n */\nclass StubWriter extends BaseResponseWriter_1.BaseResponseWriter {\n    constructor() {\n        super(...arguments);\n        this.response = {};\n        this.request = {};\n        this.cacheOptions = {};\n        this.returnsResponse = false;\n        this.doesReturnResponse = () => (this.returnsResponse = true);\n        this.cache = (options) => {\n            this.cacheOptions = options;\n        };\n        this.send = this.doesReturnResponse;\n        this.compute = this.doesReturnResponse;\n        this.proxy = this.doesReturnResponse;\n        this.redirect = this.doesReturnResponse;\n        this.render = this.doesReturnResponse;\n        this.serveStatic = this.doesReturnResponse;\n        this.serviceWorker = this.doesReturnResponse;\n        this.renderWithApp = this.doesReturnResponse;\n        this.appShell = this.doesReturnResponse;\n        this.stream = this.doesReturnResponse;\n    }\n}\n", "const path = require('path')\n\nconst FAR_FUTURE_TTL = 60 * 60 * 24 * 365 * 10\n\nconst PUBLIC_CACHE_CONFIG = {\n  edge: {\n    maxAgeSeconds: FAR_FUTURE_TTL,\n  },\n  browser: false,\n}\n\nconst LAYER0_DEVTOOLS_ENABLED_COOKIE = 'layer0_devtools_enabled'\nconst LAYER0_DEVTOOLS_ENV_ENABLED_COOKIE = 'layer0_devtools_env_enabled'\n\nfunction isDevtoolEnabledByDefault() {\n  if (process.env.LAYER0_DEVTOOLS_ENABLED) {\n    return process.env.LAYER0_DEVTOOLS_ENABLED === 'true'\n  }\n  // LAYER0_DEVTOOLS_ENABLED cannot be set manually on Environment config\n  // because LAYER0_* is reserved for internal usage, which we will use when adding\n  // that feature explictely to LD interface.\n  // Meanwhile, the PREVIEW_LAYER0_DEVTOOLS_ENABLED can be set manually by anyone\n  if (process.env.PREVIEW_LAYER0_DEVTOOLS_ENABLED) {\n    return process.env.PREVIEW_LAYER0_DEVTOOLS_ENABLED === 'true'\n  }\n\n  // If neither of those are defined, we fallback on default behavior:\n  // it will be enabled on local and moovweb-edge(-dev).io domains\n  return null\n}\n\nmodule.exports = function addBuiltInRoutes({ router, local }) {\n  if (isDevtoolEnabledByDefault() !== null) {\n    router.match('/(.*)', ({ addResponseCookie }) => {\n      addResponseCookie(\n        LAYER0_DEVTOOLS_ENV_ENABLED_COOKIE,\n        `${isDevtoolEnabledByDefault()}; Path=/`\n      )\n    })\n  }\n  if (local) {\n    router\n      .get('/__layer0__/caching', writer => {\n        writer.send(JSON.stringify({ local, enabled: process.env.LAYER0_CACHE === 'true' }))\n      })\n      .post('/__layer0__/caching', writer => {\n        const q = writer.request.query\n        if (q) {\n          process.env.LAYER0_CACHE = q.enabled\n        }\n        writer.send('done')\n      })\n  }\n  router\n    .get('/__layer0__/devtools/enable', ({ redirect, addResponseCookie }) => {\n      addResponseCookie(LAYER0_DEVTOOLS_ENABLED_COOKIE, 'true; Path=/')\n      redirect('/')\n    })\n    .get('/__layer0__/devtools/disable', ({ redirect, addResponseCookie }) => {\n      addResponseCookie(LAYER0_DEVTOOLS_ENABLED_COOKIE, 'false; Path=/')\n      redirect('/')\n    })\n    .match('/__layer0__/devtools/:path*', ({ cache, serveStatic }) => {\n      cache(PUBLIC_CACHE_CONFIG)\n      serveStatic(path.join('node_modules', '@layer0', 'devtools', 'widget', ':path*'))\n    })\n}\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst cacheManifestFromRouter_1 = __importDefault(require(\"./cacheManifestFromRouter\"));\nconst environment_1 = require(\"../environment\");\nfunction addBuiltInRoutes(router) {\n    addCacheManifest(router);\n    try {\n        // Add @layer0/devtools built-in routes if the module is installed\n        require('@layer0/devtools/addBuiltInRoutes')({\n            router,\n            local: environment_1.isLocal(),\n        });\n    }\n    catch (e) {\n        // istanbul ignore if\n        if (e.code !== 'MODULE_NOT_FOUND') {\n            throw e;\n        }\n    }\n}\nexports.default = addBuiltInRoutes;\n/**\n * Adds /__layer0__/cache-manifest.js, which contains:\n *\n * ```\n *  self.__LAYER0_CACHE_MANIFEST__ = {\n *    \"/some/route\": {\n *      browser: {\n *        serviceWorkerSeconds: (number)\n *      },\n *      edge: {\n *        maxAgeSeconds: (number)\n *      }\n *    }\n *  }\n * ```\n *\n * @private\n * @param router\n */\nfunction addCacheManifest(router) {\n    router.match('/__layer0__/cache-manifest.js', ({ cache, setResponseHeader, send, allowCors }) => {\n        cache({\n            edge: {\n                maxAgeSeconds: 60 * 60 * 24 * 365,\n            },\n            browser: {\n                maxAgeSeconds: 60 * 60,\n            },\n        });\n        setResponseHeader('content-type', 'text/javascript');\n        allowCors();\n        send(() => `self.__LAYER0_CACHE_MANIFEST__=${cacheManifestFromRouter_1.default(router).toJSON()}`);\n    });\n}\n", "'use strict';\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Set of methods that are to be intercepted and made noop\n * outside of the immediate mode (which is in effect only\n * during compute on serverless)\n *\n * @private\n */\nconst conditionallyExecutedMethods = new Set([\n    'cache',\n    'setRequestHeader',\n    'updateRequestHeader',\n    'removeRequestHeader',\n    'setResponseHeader',\n    'updateResponseHeader',\n    'removeResponseHeader',\n    'setUpstreamResponseHeader',\n    'updateUpstreamResponseHeader',\n    'removeUpstreamResponseHeader',\n    'addResponseCookie',\n    'updateResponseCookie',\n    'removeResponseCookie',\n    'addUpstreamResponseCookie',\n    'updateUpstreamResponseCookie',\n    'removeUpstreamResponseCookie',\n]);\n/**\n * Response writer proxy used then core router is not on the edge.\n *\n * Notes:\n * - We need this to avoid running header and other transformations on\n * both edge and in the cloud. We do this by overriding the ResponseWriter\n * header transformation methods so that they are either a noop when\n * running outside of immediate mode or immediately executing them.\n *\n * @param writer ResponseWriter to which we are proxying the requests\n *\n * @private\n */\nconst create = (writer) => {\n    const wrapComputeConditionedFunction = (target, property) => {\n        // We cannot use closures but rather functions so that we can bind them.\n        return async function (...args) {\n            if (!target.runningImmediately) {\n                return;\n            }\n            return await target[property](...args);\n        }.bind(target);\n    };\n    return new Proxy(writer, {\n        get: (target, property) => {\n            if (property === 'serveStatic') {\n                return wrapServeStatic(target, target.serveStatic);\n            }\n            else if (conditionallyExecutedMethods.has(property.toString())) {\n                return wrapComputeConditionedFunction(target, property);\n            }\n            else {\n                return target[property];\n            }\n        },\n    });\n};\nexports.default = {\n    create,\n};\n/**\n * Overrides the default behavior of serveStatic when running behind the edge to\n * skip trying to pull the file from S3 and just running the onNotFound function\n * because the edge has already tried and failed to pull the file from S3.\n * @param _path\n * @param options\n */\nfunction wrapServeStatic(res, originalMethod) {\n    return async (path, options = {}) => {\n        // @ts-ignore We want to leave runningImmediately private\n        if (res.runningImmediately) {\n            return originalMethod.call(res, path, options);\n        }\n        else if (options.onNotFound) {\n            // @ts-ignore We want to leave runImmediately private\n            res.setCreateResponseAction(() => res.runImmediately(() => options.onNotFound(res)));\n        }\n        else {\n            throw new Error('Should not get to serveStatic without onNotFound when running behind the edge.');\n        }\n    };\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * `get` function instead of importing lodash.\n *\n * Note that this function is not entirely equivalent to lodash's but it uses far less space in the bundle.\n */\nfunction get(object, path) {\n    let value = object;\n    const components = path.split('.');\n    for (let component of components) {\n        if (typeof value === 'undefined') {\n            return undefined;\n        }\n        value = value[component];\n    }\n    return value;\n}\nexports.default = get;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst get_1 = __importDefault(require(\"./get\"));\n/**\n * `has` function instead of importing lodash.\n *\n * Note that this function is not entirely equivalent to lodash's but it uses far less space in the bundle.\n */\nfunction has(object, path) {\n    return !!get_1.default(object, path);\n}\nexports.default = has;\n", "'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn target.propertyIsEnumerable(symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst os_1 = require(\"os\");\nconst constants_1 = require(\"../constants\");\nconst environment_1 = require(\"../environment\");\nconst nonWebpackRequire_1 = __importDefault(require(\"./nonWebpackRequire\"));\n// config.backends[x] domainOrIp schema\nconst domainOrIpSchema = {\n    $id: '/domainOrIpSchema',\n    type: 'string',\n};\n// config.backends[x] object schema\nconst backendObjectSchema = {\n    $id: '/backendObjectSchema',\n    type: 'object',\n    properties: {\n        domainOrIp: {\n            $ref: domainOrIpSchema.$id,\n        },\n        port: {\n            type: 'number',\n            // We allow all ports but we will always use HTTPS protocol no matter the port.\n            minimum: 1,\n            maximum: 65535,\n        },\n        hostHeader: {\n            type: 'string',\n        },\n        disableCheckCert: {\n            type: 'boolean',\n        },\n        firstByteTimeout: {\n            type: 'number',\n        },\n        basePath: {\n            type: 'string',\n        },\n    },\n    additionalProperties: false,\n    required: ['domainOrIp'],\n};\n// config.backends schema\nconst backendSchema = {\n    $id: '/backendSchema',\n    type: 'object',\n    patternProperties: {\n        '^.*$': {\n            oneOf: [{ $ref: domainOrIpSchema.$id }, { $ref: backendObjectSchema.$id }],\n        },\n    },\n};\n// layer0.config.js schema\nconst layer0FileConfigurationSchema = {\n    $id: '/layer0FileConfigurationSchema',\n    type: 'object',\n    properties: {\n        name: { type: 'string' },\n        team: { type: 'string' },\n        prerenderConcurrency: { type: 'number' },\n        production: { type: 'boolean' },\n        routes: { type: 'string' },\n        server: {\n            type: 'object',\n            required: ['path'],\n            properties: { path: { type: 'string' }, export: { type: 'string' } },\n        },\n        includeFiles: {\n            type: 'object',\n        },\n        sources: {\n            type: 'array',\n            items: {\n                type: 'string',\n            },\n        },\n        backends: {\n            $ref: backendSchema.$id,\n        },\n        includeNodeModules: { type: 'boolean' },\n        connector: {\n            type: 'string',\n        },\n    },\n    additionalProperties: false,\n    required: [],\n};\n/**\n * An object used to validate an layer0 config.\n *\n * Example:\n * ```js\n * Validator.validateLayer0FileConfiguration(config)\n * ```\n */\nclass Validator {\n    /**\n     * Validates `layer0.config.js`. If the config is validated, it is returned; otherwise,\n     * an error is thrown.\n     * @param config Loaded layer0 configuration\n     * @returns The validated config\n     */\n    static validateLayer0FileConfiguration(config) {\n        if (environment_1.isCloud())\n            return config;\n        // Ajv is really big, so we don't bother validating in the cloud - I've we've gotten this far, let 'er rip, baby!\n        const Ajv = nonWebpackRequire_1.default('ajv');\n        if (config.connector) {\n            try {\n                const configSchema = require(`${config.connector}/configSchema`);\n                // If a configuration schema exists for the connector, merge into the default schema\n                Object.assign(layer0FileConfigurationSchema.properties, configSchema);\n            }\n            catch {\n                // No config schema for connector, nothing to do here\n            }\n        }\n        const ajv = new Ajv({\n            allErrors: true,\n            schemas: [\n                layer0FileConfigurationSchema,\n                backendSchema,\n                backendObjectSchema,\n                domainOrIpSchema,\n            ],\n        });\n        let errors = [];\n        // the type cast on the following line is needed to get coverage to 100%.  In theory getSchema can return undefined, but it won't since we are creating the schema ourselves.\n        const layer0SchemaValidator = ajv.getSchema(layer0FileConfigurationSchema.$id);\n        if (config.backends && config.backends.moov != null) {\n            // Don't allow providing moov backend in layer0.config.js\n            errors.push({\n                message: 'is a reserved backend name',\n                // eslint-disable-next-line quotes\n                dataPath: \".backends['moov']\",\n            });\n        }\n        // Don't allow providing static backend in layer0.config.js\n        if (config.backends && config.backends[constants_1.BACKENDS.static]) {\n            errors.push({\n                message: 'is a reserved backend name',\n                // eslint-disable-next-line quotes\n                dataPath: `.backends.${constants_1.BACKENDS.static}`,\n            });\n        }\n        // Don't allow providing js backend in layer0.config.js\n        if (config.backends && config.backends[constants_1.BACKENDS.js]) {\n            errors.push({\n                message: 'is a reserved backend name',\n                // eslint-disable-next-line quotes\n                dataPath: `.backends.${constants_1.BACKENDS.js}`,\n            });\n        }\n        // Run schema validation\n        if (!layer0SchemaValidator(config) && layer0SchemaValidator.errors) {\n            errors = [...errors, ...layer0SchemaValidator.errors];\n        }\n        // If errors length is not 0 throw error\n        if (errors.length) {\n            const errorsString = errors\n                .map((err, i) => {\n                let eString = `${i + 1}) config${err.dataPath}: ${err.message}`;\n                // @ts-ignore\n                if (err.keyword === 'additionalProperties') {\n                    // @ts-ignore\n                    eString += ` '${err.params.additionalProperty}'`;\n                }\n                return eString;\n            })\n                .join(os_1.EOL);\n            throw new Error(`Layer0 configuration validation failed with errors: ${os_1.EOL}${errorsString}`);\n        }\n        return config;\n    }\n}\nexports.default = Validator;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst get_1 = __importDefault(require(\"./utils/get\"));\nconst has_1 = __importDefault(require(\"./utils/has\"));\nconst deepmerge_1 = __importDefault(require(\"deepmerge\"));\nconst fs_1 = require(\"fs\");\nconst path_1 = require(\"path\");\nconst constants_1 = require(\"./constants\");\nconst Validator_1 = __importDefault(require(\"./utils/Validator\"));\nconst nonWebpackRequire_1 = __importDefault(require(\"./utils/nonWebpackRequire\"));\n/**\n * An object containing the config settings. This class is internal, but an instance\n * can be obtained using.\n *\n * ```js\n * import config from '@layer0/core/config'\n * ```\n *\n * @internal\n */\nclass Config {\n    constructor() {\n        this.defaults = {\n            production: true,\n            backends: {},\n            includeNodeModules: false,\n            routes: ['routes.js', 'routes.ts', 'routes.cjs'].find(file => fs_1.existsSync(path_1.join(process.cwd(), file))) || 'routes.js',\n        };\n    }\n    /**\n     * Get configuration by key. Will throw an error if no value is configured\n     * @param key The key to grab from the config.\n     * @param fallback A value to return if a value is not configured\n     */\n    get(key, fallback) {\n        if (this.has(key)) {\n            return get_1.default(this.values, key);\n        }\n        else if (typeof fallback !== 'undefined') {\n            return fallback;\n        }\n        else {\n            throw new Error(`Layer0 configuration key: \"${key}\" is not defined`);\n        }\n    }\n    /**\n     * Returns true if a value has been configured for a specific key, otherwise false.\n     * @param key The key to test.\n     */\n    has(key) {\n        if (!this.values)\n            this.loadLayer0Config();\n        return has_1.default(this.values, key);\n    }\n    /**\n     * Returns all config values\n     */\n    get all() {\n        if (!this.values)\n            this.loadLayer0Config();\n        return this.values;\n    }\n    /**\n     * Loads Layer0 config and sets the current configuration.\n     */\n    loadLayer0Config() {\n        const file = this.loadFromFile();\n        const env = this.loadFromEnv();\n        this.values = deepmerge_1.default.all([{}, this.defaults, file, env]);\n    }\n    /**\n     * Load configuration from file\n     * @private\n     */\n    loadFromFile() {\n        const configAbsPath = [\n            path_1.join(process.cwd(), constants_1.LAYER0_CONFIG_FILE),\n            path_1.join(process.cwd(), constants_1.LAYER0_CONFIG_FILE.replace('.js', '.cjs')),\n        ].find(fs_1.existsSync);\n        if (configAbsPath) {\n            try {\n                const fileConfig = nonWebpackRequire_1.default(configAbsPath);\n                return Validator_1.default.validateLayer0FileConfiguration(fileConfig);\n            }\n            catch (e) {\n                throw new Error(`Failed to load ${configAbsPath}: ${e.message}`);\n            }\n        }\n        return {};\n    }\n    /**\n     * Load configuration from env var\n     * @private\n     */\n    loadFromEnv() {\n        if (process.env[constants_1.LAYER0_ENV_VARIABLES.config]) {\n            try {\n                return JSON.parse(process.env[constants_1.LAYER0_ENV_VARIABLES.config]);\n            }\n            catch (e) {\n                throw new Error(`Layer0 configuration variable: ${constants_1.LAYER0_ENV_VARIABLES.config}, is not parsable as json`);\n            }\n        }\n        return {};\n    }\n}\n/**\n * Create a Config instance.\n */\nexports.default = new Config();\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Converts a JavaScript Regexp instance to a string compatible with edge.\n * See https://docs.fastly.com/en/guides/vcl-regular-expression-cheat-sheet\n * @param regex\n */\nfunction toEdgeRegex(regex) {\n    return `${regex.ignoreCase ? '(?i)' : ''}${regex.source}`.replace(/\\\\\\//g, '/');\n}\nexports.default = toEdgeRegex;\n/**\n * Reverse transformation. Mostly used for unit tests.\n * @param edgeRegex\n */\nfunction fromEdgeRegex(edgeRegex) {\n    const ignoreCase = edgeRegex.indexOf('(?i)') === 0;\n    if (ignoreCase) {\n        edgeRegex = edgeRegex.slice('(?i)'.length);\n    }\n    return new RegExp(edgeRegex.replace(/\\//g, '/'), ignoreCase ? 'i' : '');\n}\nexports.fromEdgeRegex = fromEdgeRegex;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Converts an HTTP method name to RegExp that it matches in case-insensitive manner.\n *\n * Notes:\n * - We use this in both cloud router and edge router to ensure that we can identify\n * explicit POST matching (which in turn we need to only turn on POST caching when\n * explicitly configured)\n *\n * @param method\n * @private\n */\nfunction toHttpMethodMatchRegex(method) {\n    return new RegExp(`^${method}$`, 'i');\n}\nexports.default = toHttpMethodMatchRegex;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst toEdgeRegex_1 = __importDefault(require(\"./toEdgeRegex\"));\n/**\n * Returns either null or regex even if input is string matcher.\n *\n * @param potentialRegex\n * @private\n */\nfunction convertStringMatcherToRegex(potentialRegex) {\n    let regex;\n    if (potentialRegex === null) {\n        regex = null;\n    }\n    else if (typeof potentialRegex === 'string') {\n        regex = toEdgeRegex_1.default(new RegExp(`^${potentialRegex}$`, 'i'));\n    }\n    else {\n        regex = toEdgeRegex_1.default(potentialRegex);\n    }\n    return regex;\n}\nexports.default = convertStringMatcherToRegex;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Binds params to path.\n *\n * Example:\n * ```js\n * bindParamsToPath('/:foo/:bar*', { foo: 'p1', bar: 'p2/p3' })\n * ```\n * Output: `/p1/p2/p3`\n *\n * @param path The path, with param substitutions in braces `{}`.\n * @param params An object with keys matching the params in braces.\n * @returns A string with the params substituted with their values.\n */\nexports.default = (path, params) => {\n    let p = path;\n    // We allow edge interpolation params which begin with `${` but we no longer\n    // allow old path options that only begin with `{`.\n    if (/(^|[^$]){/.test(path)) {\n        throw new Error(`{variable} syntax in the path option is no longer supported, use :variable instead (${path})`);\n    }\n    for (let paramName in params) {\n        let value = params[paramName];\n        if (Array.isArray(value)) {\n            value = value.join('/');\n        }\n        // Here we decide *not* to use path-to-regexp `compile()` function\n        // as bindParamsToPath is used by other string which are not paths.\n        // For example it is used to interpolate setHeader values, which can be a CORS header like\n        // 'https://www.domain.com/:path'. The ':' behind https is not a valid path-to-regexp expression.\n        // p = p.replace(new RegExp(`:${paramName}(\\\\?|\\\\*|\\\\(.*\\\\)[?*]?)?`, 'g'), value)\n        p = p.replace(new RegExp(`:${paramName}(\\\\([^)]*\\\\))?[?*+]?`, 'g'), value === undefined ? '' : value);\n    }\n    // For optional matchers (:path* and :path?), path may not be defined in params\n    // after matching a route but should still be replaced by a blank value\n    //\n    // ex: pathToRegexp.match('/public/:param?')('/').params returns {}\n    //     so bindParamsToPath('/public/:param?', {}) should return '/public/'\n    //\n    p = p.replace(/:\\w+(\\*|\\+|\\?)?/, '');\n    // We un-escape '?' character that needed to be escape from path-to-regexp expression\n    // to *not* be considered as optional parameter matcher\n    p = p.replace('\\\\?', '?');\n    p = p\n        .replace(/\\/+/g, '/') // finally dedupe /'s that result from missing optional parameters\n        .replace(/^([^:]+:)\\//gi, '$1//'); // but don't replace http://domain with http:/domain\n    return p;\n};\n", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\" } = options;\n  const defaultPattern = `[^${escapeString(options.delimiter || \"/#?\")}]+?`;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || defaultPattern,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? defaultPattern : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {}\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {}\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {}\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            route += `((?:${token.pattern})${token.modifier})`;\n          } else {\n            route += `(${token.pattern})${token.modifier}`;\n          }\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst bindParamsToPath_1 = __importDefault(require(\"./bindParamsToPath\"));\nconst path_to_regexp_1 = require(\"path-to-regexp\");\n/**\n * Replaces named parameters in the specified path with back references so\n * that the edge can create a path using the matched params with a regex replace in VCL.\n *\n * **Note** this method can return a replacement that, when applied, can result in duplicated '/' characters,\n * which must be collapsed.  For example, if the route pattern is /:locale?/products and the url is '/products',\n * where the optional parameter is not provided, url.replace(pattern, replacement) will result in '//products'\n *\n * @param matcher A route-parser route\n * @param path The request path\n * @returns A path with params replaced by back references\n */\nfunction convertParamsToBackReferences(source, dest) {\n    if (source == null)\n        return dest;\n    const sourceTokens = getBackReferences(source);\n    return bindParamsToPath_1.default(dest, sourceTokens);\n}\nexports.default = convertParamsToBackReferences;\nfunction getBackReferences(path) {\n    if (!path)\n        return {};\n    // In case path is an absolute path\n    const absolutePathMatch = path.match(/https?:\\/\\/[^/]+(.*)/);\n    if (absolutePathMatch) {\n        path = `/${absolutePathMatch[1]}`;\n    }\n    // Back reference counting starts from 1\n    let backReferenceCounter = 1;\n    const references = {};\n    path_to_regexp_1.parse(path).forEach(token => {\n        if (typeof token !== 'string') {\n            references[token.name] = `\\\\${backReferenceCounter++}`;\n        }\n    });\n    return references;\n}\nexports.getBackReferences = getBackReferences;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * `isEmpty` function instead of importing lodash.\n *\n * Note that this function is not entirely equivalent to lodash's but it uses far less space in the bundle.\n */\nfunction isEmpty(value) {\n    if (!value) {\n        return true;\n    }\n    if (typeof value.length === 'number') {\n        return !value.length;\n    }\n    if (typeof value === 'object' && Object.keys(value).length) {\n        return false;\n    }\n    return true;\n}\nexports.default = isEmpty;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/* istanbul ignore file - For some reason the constructor can't get 100% coverage on the super call */\n/**\n * To be thrown when failing to connect to a backend.\n */\nclass BackendFetchError extends Error {\n    /**\n     * @param cause The root error emitted by http/https.request\n     */\n    constructor(cause) {\n        super(cause.message);\n        this.type = 'BackendFetchError';\n        this.cause = cause;\n    }\n}\nexports.default = BackendFetchError;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Used to create URL instance with just a path\n */\nconst PLACEHOLDER_HOSTNAME = '__';\nfunction mergeQueryString(requestUrl, targetRedirectOrPath) {\n    // `https://${PLACEHOLDER_HOSTNAME}` is temporarily inserted to make the `URL` object work\n    // with relative path, but is removed from the returned value right after.\n    const requestSearchParams = new URL(requestUrl, `https://${PLACEHOLDER_HOSTNAME}`).searchParams;\n    const targetUrl = new URL(targetRedirectOrPath, `https://${PLACEHOLDER_HOSTNAME}`);\n    // Apply query string from request to the target, except if they are already set explicitly on the target\n    requestSearchParams.forEach((value, key) => {\n        if (!targetUrl.searchParams.get(key)) {\n            targetUrl.searchParams.set(key, value);\n        }\n    });\n    // Keep the target as initially intended, absolute or relative path\n    return targetUrl.hostname === PLACEHOLDER_HOSTNAME\n        ? `${targetUrl.pathname}${targetUrl.search}`\n        : targetUrl.toString();\n}\nexports.default = mergeQueryString;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst url_1 = require(\"url\");\nconst https_1 = __importDefault(require(\"https\"));\nconst http_1 = __importDefault(require(\"http\"));\nconst path_1 = require(\"path\");\nconst BackendFetchError_1 = __importDefault(require(\"../errors/BackendFetchError\"));\nconst mergeQueryString_1 = __importDefault(require(\"./mergeQueryString\"));\nconst constants_1 = require(\"../constants\");\n/**\n * Array of response headers that will not be passed over directly from the proxied resource\n *\n * Notes:\n * - transfer-encoding: as it poisons the response which will be formed\n * based on its own transfer-encoding rather than the one received from the Lambda.\n *\n * - content-length: as the actual constant may be changed by buffer proxy\n * (e.g. on moov_debug=true)\n * @private\n */\nconst IGNORE_RESPONSE_HEADERS = ['transfer-encoding', 'content-length'];\n/**\n * @private\n */\nclass Backend {\n    constructor(config) {\n        this.config = config;\n    }\n    static setImpl(implementation) {\n        impl = implementation;\n    }\n    static create(config) {\n        return new impl(config);\n    }\n    /**\n     * Sends a request using the proxy.\n     * @param req The request being sent.\n     * @param res The response for the request.\n     */\n    async fetch(req, res, options) {\n        const { path, headers } = options || {};\n        // Create url for proxy with query params added if existing\n        const url = this.getProxyTarget(req, path);\n        const requestOptions = this.getProxyRequestOptions(url, req, headers, options === null || options === void 0 ? void 0 : options.removeEmptySearchParamValues);\n        return new Promise((resolve, reject) => {\n            const lib = url.protocol === 'https:' ? https_1.default : http_1.default;\n            const upstreamReq = lib.request(requestOptions, upstreamRes => {\n                let buf = [];\n                upstreamRes\n                    .on('data', (chunk) => buf.push(chunk))\n                    .on('end', () => {\n                    /* istanbul ignore else */\n                    if (upstreamRes.complete) {\n                        Object.entries(upstreamRes.headers)\n                            .filter(([name]) => !IGNORE_RESPONSE_HEADERS.includes(name.toLowerCase()))\n                            .forEach(([name, value]) => {\n                            try {\n                                res.setHeader(name, value);\n                            }\n                            catch (e) {\n                                console.warn(`Could not relay upstream response header ${name} with value ${value}`, e);\n                            }\n                        });\n                        res.statusCode = upstreamRes.statusCode;\n                        res.statusMessage = upstreamRes.statusMessage;\n                        res.body = Buffer.concat(buf);\n                        /* istanbul ignore if */\n                        if (process.env.DEBUG === 'true') {\n                            console.log('proxy', `[${res.statusCode} ${res.statusMessage}]`, url);\n                        }\n                        resolve(undefined);\n                    }\n                })\n                    .on('error', \n                /* istanbul ignore next */ e => {\n                    reject(new BackendFetchError_1.default(e));\n                })\n                    // Closing the connection before the response is complete\n                    // has different behaviours depending on NodeJs version\n                    // - node 12: triggers a 'close' event on the Request and Response, and an 'end' event on Response in between\n                    // - node 14: triggers a 'close' event on the Request and Response, but no 'end' event on Response anymore\n                    // - node 16: triggers a 'close' event on the Request and Response and an \"aborted\" error on Response in between\n                    // See playground at https://runkit.com/adrien-k/aborted-res-error\n                    //\n                    // We take the most compatible approach, although in v16 and above this should be caught by the 'error' event.\n                    /* istanbul ignore next */\n                    .on('close', \n                /* istanbul ignore next */ () => {\n                    if (!upstreamRes.complete) {\n                        reject(new BackendFetchError_1.default(new Error('The connection was terminated while the message was still being sent')));\n                    }\n                });\n            });\n            upstreamReq.on('error', e => reject(new BackendFetchError_1.default(e)));\n            upstreamReq.end(req.body);\n        });\n    }\n    /**\n     * Returns proxy configuration for http-proxy\n     * @returns proxy target url\n     */\n    getProxyTarget(req, path) {\n        let url = path ? mergeQueryString_1.default(req.url, path) : req.url;\n        const { domainOrIp, basePath, port } = this.config;\n        if (basePath) {\n            url = path_1.join(basePath, url);\n        }\n        /* istanbul ignore next */\n        if (domainOrIp) {\n            const protocol = domainOrIp.match(/^127.0.0.1(:\\d+)?$/) ? 'http' : 'https';\n            const domain = `${domainOrIp}${port ? `:${port}` : ''}`;\n            url = `${protocol}://${path_1.join(domain, url)}`;\n        }\n        const parsed = url_1.parse(url, true);\n        // Force insecure protocol if header is present\n        if (req.getHeader(constants_1.HTTP_HEADERS.x0Protocol) === 'http') {\n            parsed.protocol = 'http:';\n        }\n        return parsed;\n    }\n    /**\n     * Returns true if the URL points to the local JS backend, otherwise false.\n     * @param url\n     * @returns\n     */\n    isLocal(url) {\n        return url.hostname === constants_1.JS_BACKEND_HOSTNAME;\n    }\n    /**\n     * Returns proxy configuration object for node-fetch\n     * @param url\n     * @param req\n     * @param headers Additional request headers to include\n     * @param removeEmptySearchParamValues If true, search param values that are empty are removed so \"?foo=\" becomes \"?foo\".\n     */\n    getProxyRequestOptions(url, req, headers, removeEmptySearchParamValues) {\n        let agent = null;\n        if (this.config.disableCheckCert && url.protocol === 'https:') {\n            // For self signed cert fix on local development S3 bucket\n            agent = new https_1.default.Agent({ rejectUnauthorized: false });\n        }\n        const upstreamHeaders = {\n            ...req.headers,\n            ...headers,\n            host: this.config.hostHeader || req.headers.host,\n        };\n        if (this.isLocal(url)) {\n            // Some libraries, like [is-https](https://github.com/unjs/is-https#behaviour), rely on x-forwarded-proto\n            // to determine if the source request was made securely. This is notably used by Vue Storefront 2. Before\n            // we added this header, API requests made by Vue Storefront 2 from the cloud would attempt to reenter Layer0\n            // using an http POST, which would be redirected to an https GET, which would cause an infinite loop and soaring lambda costs.\n            // Note that we only add x-forwarded-proto for local requests, which never happen over TLS. For remote requests, TLS is used\n            // when the downstream request used TLS. We've chosen to do this in order to avoid altering the public behavior of Layer0, which\n            // has never sent x-forwarded-proto to origins.\n            upstreamHeaders['x-forwarded-proto'] = req.secure ? 'https' : 'http';\n        }\n        let path = url.path;\n        if (removeEmptySearchParamValues === true && path) {\n            path = path.replace(/=(?=&|$)/gm, '');\n        }\n        return {\n            ...url,\n            path,\n            method: req.method,\n            timeout: this.config.firstByteTimeout || 0,\n            agent,\n            body: req.body,\n            headers: upstreamHeaders,\n        };\n    }\n}\nexports.default = Backend;\nlet impl = Backend;\n", "/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(';')\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var index = pair.indexOf('=')\n\n    // skip things that don't look like key=value\n    if (index < 0) {\n      continue;\n    }\n\n    var key = pair.substring(0, index).trim()\n\n    // only assign once\n    if (undefined == obj[key]) {\n      var val = pair.substring(index + 1, pair.length).trim()\n\n      // quoted values\n      if (val[0] === '\"') {\n        val = val.slice(1, -1)\n      }\n\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n\n    if (isNaN(maxAge) || !isFinite(maxAge)) {\n      throw new TypeError('option maxAge is invalid')\n    }\n\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      case 'none':\n        str += '; SameSite=None';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Identity function instead of importing lodash.\n *\n * @param x Any object\n * @returns The same object\n */\nfunction identity(x) {\n    return x;\n}\nexports.default = identity;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst cookie_1 = __importDefault(require(\"cookie\"));\nconst querystring_1 = require(\"querystring\");\nconst identity_1 = __importDefault(require(\"../utils/identity\"));\n/**\n * @private\n * Emulates the edge by interpolating header values\n *\n * Note: This code must be kept in sync with the interpolateParams: values from ECL compiler\n *\n * Supported interpolation strings are:\n *  - ${method}: the request method GET/PUT/POST/etc...\n *  - ${path}: the return path without query parameters\n *  - ${url}: the original unmodified request url\n *  - ${req:<request header name>}: a request header value\n *  - ${req:cookie:<request cookie name>}: a request cookie value\n *  - ${res:<response header name>}: a response header value\n *\n * @param req The request\n * @param res The response\n * @param value The string or array of strings to interpolate\n */\nfunction interpolateParams(req, res, value) {\n    if (typeof value === 'string') {\n        return interpolateParam(req, res, value);\n    }\n    if (!Array.isArray(value)) {\n        // Skip any non-string and non-string array values\n        return value;\n    }\n    const results = [];\n    value.forEach(v => {\n        results.push(interpolateParams(req, res, v));\n    });\n    return results;\n}\nexports.default = interpolateParams;\n/**\n * @private\n * Interpolates a single string value\n *\n *  NOTE: We emulate the Fastly Edge closely, but there are known difference. E.g. if you have header='hi ${req:cookie:test}' and there is no\n *        cookie name 'test' Fastly will return header='hi (null)' but if you have header='${req:cookie:test}' Fastly will drop the header.\n *        This interpolator just returns '' for not found values.\n * @param req The request\n * @param res The response\n * @param value a string to interpolate\n */\nfunction interpolateParam(req, res, value) {\n    // We can have multiple replacements per value, so we need to loop through all the possible cases\n    // Use '--backslashdollar--' so we do not interpret '\\${' in the results.\n    // Use '--separator--' so we keep the '${' in the results of split().\n    const segments = value\n        .replace(/\\\\\\${/g, '--backslashdollar--')\n        .replace(/\\${/g, '--separator--${')\n        .split('--separator--');\n    // Parse cookies once at the top of the function as an optimization\n    let cookies = {};\n    if (req === null || req === void 0 ? void 0 : req.headers.cookie) {\n        // Pass in the 'do nothing' decode function to return the cookie value without decoding it\n        cookies = cookie_1.default.parse(req.headers.cookie, { decode: identity_1.default });\n    }\n    // Parse query parameters once at the top of the function as an optimization\n    let qs = {};\n    if (req === null || req === void 0 ? void 0 : req.url) {\n        const queryParameterIndex = req.url.indexOf('?');\n        if (queryParameterIndex >= 0) {\n            const queryParameters = req.url.substring(queryParameterIndex + 1);\n            qs = querystring_1.parse(queryParameters);\n        }\n    }\n    const interpolatedResults = [];\n    const requestPrefixLength = '${req:'.length;\n    const queryPrefixLength = '${query:'.length;\n    segments.forEach(segment => {\n        if (req) {\n            segment = segment.replace(/\\${method}/, req.method);\n            segment = segment.replace(/\\${path}/, req.path);\n            segment = segment.replace(/\\${url}/, req.url);\n            // ${query:paramName} returns the found query parameter\n            const startQueryParameterIndex = segment.search(/\\${query:/);\n            if (startQueryParameterIndex >= 0) {\n                let queryParameterName = segment.substring(startQueryParameterIndex + queryPrefixLength);\n                const endQueryParameterIndex = queryParameterName.indexOf('}');\n                if (endQueryParameterIndex <= 0) {\n                    throw new Error(`Cannot interpolate substring \"${segment}\" of value \"${value}\" (1)`);\n                }\n                queryParameterName = queryParameterName.substring(0, endQueryParameterIndex);\n                // When there are multiple matches for the query parameter's name, we emulate\n                // the edge's behavior and return the first match only.\n                let queryReplacementString = qs[queryParameterName] || '';\n                if (Array.isArray(queryReplacementString)) {\n                    queryReplacementString = queryReplacementString[0];\n                }\n                segment = segment.replace(/\\${query:.*?}/, queryReplacementString);\n            }\n            const startRequestIndex = segment.search(/\\${req:/);\n            if (startRequestIndex >= 0) {\n                let requestHeaderName = segment.substring(startRequestIndex + requestPrefixLength);\n                const endRequestIndex = requestHeaderName.indexOf('}');\n                if (endRequestIndex <= 0) {\n                    throw new Error(`Cannot interpolate substring \"${segment}\" of value \"${value}\" (2)`);\n                }\n                requestHeaderName = requestHeaderName.substring(0, endRequestIndex);\n                let replacementString = '';\n                // req:cookie:<key> injects the value of cookie named <key> or an empty string if <key> not found\n                if (requestHeaderName.indexOf('cookie:') === 0) {\n                    const cookieName = requestHeaderName.split(':')[1];\n                    replacementString = cookies[cookieName] || '';\n                    // req:param:<name> injects the value of named parameter <name> or an empty string if <name> not found\n                }\n                else if (requestHeaderName.indexOf('param:') === 0) {\n                    const paramName = requestHeaderName.split(':')[1];\n                    if (req.params && req.params[paramName]) {\n                        replacementString = String(req.params[paramName]);\n                    }\n                    // req:<header>\n                }\n                else {\n                    // Use an empty string if the request header is not found\n                    replacementString = req.headers[requestHeaderName] || '';\n                }\n                segment = segment.replace(/\\${req:.*?}/, replacementString);\n            }\n        }\n        const startResponseIndex = segment.search(/\\${res:/);\n        if (startResponseIndex >= 0) {\n            if (!res) {\n                throw new Error(`Cannot interpolate response parameter \"${segment}\" during receive phase`);\n            }\n            let responseHeaderName = segment.substring(startResponseIndex + requestPrefixLength);\n            const endResponseIndex = responseHeaderName.indexOf('}');\n            if (endResponseIndex <= 0) {\n                throw new Error(`Cannot interpolate substring \"${segment}\" of value \"${value}\" (3)`);\n            }\n            responseHeaderName = responseHeaderName.substring(0, endResponseIndex);\n            segment = segment.replace(/\\${res:.*?}/, res.getHeader(responseHeaderName) || '');\n        }\n        // If no replacement was done, we assume the <key> in ${<key>} was not valid and throw an error\n        if (segment.search(/\\${/) >= 0) {\n            throw new Error(`Cannot interpolate substring \"${segment}\" of \"${value}\" (4)`);\n        }\n        interpolatedResults.push(segment);\n    });\n    return interpolatedResults.join('').replace(/--backslashdollar--/g, '${');\n}\n", "'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n", "'use strict';\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nmodule.exports = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) return false;\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n", "var common   = exports,\n    url      = require('url'),\n    extend   = require('util')._extend,\n    required = require('requires-port');\n\nvar upgradeHeader = /(^|,)\\s*upgrade\\s*($|,)/i,\n    isSSL = /^https|wss/;\n\n/**\n * Simple Regex for testing if protocol is https\n */\ncommon.isSSL = isSSL;\n/**\n * Copies the right headers from `options` and `req` to\n * `outgoing` which is then used to fire the proxied\n * request.\n *\n * Examples:\n *\n *    common.setupOutgoing(outgoing, options, req)\n *    // => { host: ..., hostname: ...}\n *\n * @param {Object} Outgoing Base object to be filled with required properties\n * @param {Object} Options Config object passed to the proxy\n * @param {ClientRequest} Req Request Object\n * @param {String} Forward String to select forward or target\n *\u00A0\n * @return {Object} Outgoing Object with all required properties set\n *\n * @api private\n */\n\ncommon.setupOutgoing = function(outgoing, options, req, forward) {\n  outgoing.port = options[forward || 'target'].port ||\n                  (isSSL.test(options[forward || 'target'].protocol) ? 443 : 80);\n\n  ['host', 'hostname', 'socketPath', 'pfx', 'key',\n    'passphrase', 'cert', 'ca', 'ciphers', 'secureProtocol'].forEach(\n    function(e) { outgoing[e] = options[forward || 'target'][e]; }\n  );\n\n  outgoing.method = options.method || req.method;\n  outgoing.headers = extend({}, req.headers);\n\n  if (options.headers){\n    extend(outgoing.headers, options.headers);\n  }\n\n  if (options.auth) {\n    outgoing.auth = options.auth;\n  }\n  \n  if (options.ca) {\n      outgoing.ca = options.ca;\n  }\n\n  if (isSSL.test(options[forward || 'target'].protocol)) {\n    outgoing.rejectUnauthorized = (typeof options.secure === \"undefined\") ? true : options.secure;\n  }\n\n\n  outgoing.agent = options.agent || false;\n  outgoing.localAddress = options.localAddress;\n\n  //\n  // Remark: If we are false and not upgrading, set the connection: close. This is the right thing to do\n  // as node core doesn't handle this COMPLETELY properly yet.\n  //\n  if (!outgoing.agent) {\n    outgoing.headers = outgoing.headers || {};\n    if (typeof outgoing.headers.connection !== 'string'\n        || !upgradeHeader.test(outgoing.headers.connection)\n       ) { outgoing.headers.connection = 'close'; }\n  }\n\n\n  // the final path is target path + relative path requested by user:\n  var target = options[forward || 'target'];\n  var targetPath = target && options.prependPath !== false\n    ? (target.path || '')\n    : '';\n\n  //\n  // Remark: Can we somehow not use url.parse as a perf optimization?\n  //\n  var outgoingPath = !options.toProxy\n    ? (url.parse(req.url).path || '')\n    : req.url;\n\n  //\n  // Remark: ignorePath will just straight up ignore whatever the request's\n  // path is. This can be labeled as FOOT-GUN material if you do not know what\n  // you are doing and are using conflicting options.\n  //\n  outgoingPath = !options.ignorePath ? outgoingPath : '';\n\n  outgoing.path = common.urlJoin(targetPath, outgoingPath);\n\n  if (options.changeOrigin) {\n    outgoing.headers.host =\n      required(outgoing.port, options[forward || 'target'].protocol) && !hasPort(outgoing.host)\n        ? outgoing.host + ':' + outgoing.port\n        : outgoing.host;\n  }\n  return outgoing;\n};\n\n/**\n * Set the proper configuration for sockets,\n * set no delay and set keep alive, also set\n * the timeout to 0.\n *\n * Examples:\n *\n *    common.setupSocket(socket)\n *    // => Socket\n *\n * @param {Socket} Socket instance to setup\n *\u00A0\n * @return {Socket} Return the configured socket.\n *\n * @api private\n */\n\ncommon.setupSocket = function(socket) {\n  socket.setTimeout(0);\n  socket.setNoDelay(true);\n\n  socket.setKeepAlive(true, 0);\n\n  return socket;\n};\n\n/**\n * Get the port number from the host. Or guess it based on the connection type.\n *\n * @param {Request} req Incoming HTTP request.\n *\n * @return {String} The port number.\n *\n * @api private\n */\ncommon.getPort = function(req) {\n  var res = req.headers.host ? req.headers.host.match(/:(\\d+)/) : '';\n\n  return res ?\n    res[1] :\n    common.hasEncryptedConnection(req) ? '443' : '80';\n};\n\n/**\n * Check if the request has an encrypted connection.\n *\n * @param {Request} req Incoming HTTP request.\n *\n * @return {Boolean} Whether the connection is encrypted or not.\n *\n * @api private\n */\ncommon.hasEncryptedConnection = function(req) {\n  return Boolean(req.connection.encrypted || req.connection.pair);\n};\n\n/**\n * OS-agnostic join (doesn't break on URLs like path.join does on Windows)>\n *\n * @return {String} The generated path.\n *\n * @api private\n */\n\ncommon.urlJoin = function() {\n    //\n    // We do not want to mess with the query string. All we want to touch is the path.\n    //\n  var args = Array.prototype.slice.call(arguments),\n      lastIndex = args.length - 1,\n      last = args[lastIndex],\n      lastSegs = last.split('?'),\n      retSegs;\n\n  args[lastIndex] = lastSegs.shift();\n\n  //\n  // Join all strings, but remove empty strings so we don't get extra slashes from\n  // joining e.g. ['', 'am']\n  //\n  retSegs = [\n    args.filter(Boolean).join('/')\n        .replace(/\\/+/g, '/')\n        .replace('http:/', 'http://')\n        .replace('https:/', 'https://')\n  ];\n\n  // Only join the query string if it exists so we don't have trailing a '?'\n  // on every request\n\n  // Handle case where there could be multiple ? in the URL.\n  retSegs.push.apply(retSegs, lastSegs);\n\n  return retSegs.join('?')\n};\n\n/**\n * Rewrites or removes the domain of a cookie header\n *\n * @param {String|Array} Header\n * @param {Object} Config, mapping of domain to rewritten domain.\n *                 '*' key to match any domain, null value to remove the domain.\n *\n * @api private\n */\ncommon.rewriteCookieProperty = function rewriteCookieProperty(header, config, property) {\n  if (Array.isArray(header)) {\n    return header.map(function (headerElement) {\n      return rewriteCookieProperty(headerElement, config, property);\n    });\n  }\n  return header.replace(new RegExp(\"(;\\\\s*\" + property + \"=)([^;]+)\", 'i'), function(match, prefix, previousValue) {\n    var newValue;\n    if (previousValue in config) {\n      newValue = config[previousValue];\n    } else if ('*' in config) {\n      newValue = config['*'];\n    } else {\n      //no match, return previous value\n      return match;\n    }\n    if (newValue) {\n      //replace value\n      return prefix + newValue;\n    } else {\n      //remove value\n      return '';\n    }\n  });\n};\n\n/**\n * Check the host and see if it potentially has a port in it (keep it simple)\n *\n * @returns {Boolean} Whether we have one or not\n *\n * @api private\n */\nfunction hasPort(host) {\n  return !!~host.indexOf(':');\n};\n", "var url    = require('url'),\n    common = require('../common');\n\n\nvar redirectRegex = /^201|30(1|2|7|8)$/;\n\n/*!\n * Array of passes.\n *\n * A `pass` is just a function that is executed on `req, res, options`\n * so that you can easily add new checks while still keeping the base\n * flexible.\n */\n\nmodule.exports = { // <--\n\n  /**\n   * If is a HTTP 1.0 request, remove chunk headers\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {proxyResponse} Res Response object from the proxy request\n   *\n   * @api private\n   */\n  removeChunked: function removeChunked(req, res, proxyRes) {\n    if (req.httpVersion === '1.0') {\n      delete proxyRes.headers['transfer-encoding'];\n    }\n  },\n\n  /**\n   * If is a HTTP 1.0 request, set the correct connection header\n   * or if connection header not present, then use `keep-alive`\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {proxyResponse} Res Response object from the proxy request\n   *\n   * @api private\n   */\n  setConnection: function setConnection(req, res, proxyRes) {\n    if (req.httpVersion === '1.0') {\n      proxyRes.headers.connection = req.headers.connection || 'close';\n    } else if (req.httpVersion !== '2.0' && !proxyRes.headers.connection) {\n      proxyRes.headers.connection = req.headers.connection || 'keep-alive';\n    }\n  },\n\n  setRedirectHostRewrite: function setRedirectHostRewrite(req, res, proxyRes, options) {\n    if ((options.hostRewrite || options.autoRewrite || options.protocolRewrite)\n        && proxyRes.headers['location']\n        && redirectRegex.test(proxyRes.statusCode)) {\n      var target = url.parse(options.target);\n      var u = url.parse(proxyRes.headers['location']);\n\n      // make sure the redirected host matches the target host before rewriting\n      if (target.host != u.host) {\n        return;\n      }\n\n      if (options.hostRewrite) {\n        u.host = options.hostRewrite;\n      } else if (options.autoRewrite) {\n        u.host = req.headers['host'];\n      }\n      if (options.protocolRewrite) {\n        u.protocol = options.protocolRewrite;\n      }\n\n      proxyRes.headers['location'] = u.format();\n    }\n  },\n  /**\n   * Copy headers from proxyResponse to response\n   * set each header in response object.\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {proxyResponse} Res Response object from the proxy request\n   * @param {Object} Options options.cookieDomainRewrite: Config to rewrite cookie domain\n   *\n   * @api private\n   */\n  writeHeaders: function writeHeaders(req, res, proxyRes, options) {\n    var rewriteCookieDomainConfig = options.cookieDomainRewrite,\n        rewriteCookiePathConfig = options.cookiePathRewrite,\n        preserveHeaderKeyCase = options.preserveHeaderKeyCase,\n        rawHeaderKeyMap,\n        setHeader = function(key, header) {\n          if (header == undefined) return;\n          if (rewriteCookieDomainConfig && key.toLowerCase() === 'set-cookie') {\n            header = common.rewriteCookieProperty(header, rewriteCookieDomainConfig, 'domain');\n          }\n          if (rewriteCookiePathConfig && key.toLowerCase() === 'set-cookie') {\n            header = common.rewriteCookieProperty(header, rewriteCookiePathConfig, 'path');\n          }\n          res.setHeader(String(key).trim(), header);\n        };\n\n    if (typeof rewriteCookieDomainConfig === 'string') { //also test for ''\n      rewriteCookieDomainConfig = { '*': rewriteCookieDomainConfig };\n    }\n\n    if (typeof rewriteCookiePathConfig === 'string') { //also test for ''\n      rewriteCookiePathConfig = { '*': rewriteCookiePathConfig };\n    }\n\n    // message.rawHeaders is added in: v0.11.6\n    // https://nodejs.org/api/http.html#http_message_rawheaders\n    if (preserveHeaderKeyCase && proxyRes.rawHeaders != undefined) {\n      rawHeaderKeyMap = {};\n      for (var i = 0; i < proxyRes.rawHeaders.length; i += 2) {\n        var key = proxyRes.rawHeaders[i];\n        rawHeaderKeyMap[key.toLowerCase()] = key;\n      }\n    }\n\n    Object.keys(proxyRes.headers).forEach(function(key) {\n      var header = proxyRes.headers[key];\n      if (preserveHeaderKeyCase && rawHeaderKeyMap) {\n        key = rawHeaderKeyMap[key] || key;\n      }\n      setHeader(key, header);\n    });\n  },\n\n  /**\n   * Set the statusCode from the proxyResponse\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {proxyResponse} Res Response object from the proxy request\n   *\n   * @api private\n   */\n  writeStatusCode: function writeStatusCode(req, res, proxyRes) {\n    // From Node.js docs: response.writeHead(statusCode[, statusMessage][, headers])\n    if(proxyRes.statusMessage) {\n      res.statusCode = proxyRes.statusCode;\n      res.statusMessage = proxyRes.statusMessage;\n    } else {\n      res.statusCode = proxyRes.statusCode;\n    }\n  }\n\n};\n", "/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n", "\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.slice(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n", "/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n", "'use strict';\nmodule.exports = (flag, argv) => {\n\targv = argv || process.argv;\n\tconst prefix = flag.startsWith('-') ? '' : (flag.length === 1 ? '-' : '--');\n\tconst pos = argv.indexOf(prefix + flag);\n\tconst terminatorPos = argv.indexOf('--');\n\treturn pos !== -1 && (terminatorPos === -1 ? true : pos < terminatorPos);\n};\n", "'use strict';\nconst os = require('os');\nconst hasFlag = require('has-flag');\n\nconst env = process.env;\n\nlet forceColor;\nif (hasFlag('no-color') ||\n\thasFlag('no-colors') ||\n\thasFlag('color=false')) {\n\tforceColor = false;\n} else if (hasFlag('color') ||\n\thasFlag('colors') ||\n\thasFlag('color=true') ||\n\thasFlag('color=always')) {\n\tforceColor = true;\n}\nif ('FORCE_COLOR' in env) {\n\tforceColor = env.FORCE_COLOR.length === 0 || parseInt(env.FORCE_COLOR, 10) !== 0;\n}\n\nfunction translateLevel(level) {\n\tif (level === 0) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\tlevel,\n\t\thasBasic: true,\n\t\thas256: level >= 2,\n\t\thas16m: level >= 3\n\t};\n}\n\nfunction supportsColor(stream) {\n\tif (forceColor === false) {\n\t\treturn 0;\n\t}\n\n\tif (hasFlag('color=16m') ||\n\t\thasFlag('color=full') ||\n\t\thasFlag('color=truecolor')) {\n\t\treturn 3;\n\t}\n\n\tif (hasFlag('color=256')) {\n\t\treturn 2;\n\t}\n\n\tif (stream && !stream.isTTY && forceColor !== true) {\n\t\treturn 0;\n\t}\n\n\tconst min = forceColor ? 1 : 0;\n\n\tif (process.platform === 'win32') {\n\t\t// Node.js 7.5.0 is the first version of Node.js to include a patch to\n\t\t// libuv that enables 256 color output on Windows. Anything earlier and it\n\t\t// won't work. However, here we target Node.js 8 at minimum as it is an LTS\n\t\t// release, and Node.js 7 is not. Windows 10 build 10586 is the first Windows\n\t\t// release that supports 256 colors. Windows 10 build 14931 is the first release\n\t\t// that supports 16m/TrueColor.\n\t\tconst osRelease = os.release().split('.');\n\t\tif (\n\t\t\tNumber(process.versions.node.split('.')[0]) >= 8 &&\n\t\t\tNumber(osRelease[0]) >= 10 &&\n\t\t\tNumber(osRelease[2]) >= 10586\n\t\t) {\n\t\t\treturn Number(osRelease[2]) >= 14931 ? 3 : 2;\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tif ('CI' in env) {\n\t\tif (['TRAVIS', 'CIRCLECI', 'APPVEYOR', 'GITLAB_CI'].some(sign => sign in env) || env.CI_NAME === 'codeship') {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn min;\n\t}\n\n\tif ('TEAMCITY_VERSION' in env) {\n\t\treturn /^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(env.TEAMCITY_VERSION) ? 1 : 0;\n\t}\n\n\tif (env.COLORTERM === 'truecolor') {\n\t\treturn 3;\n\t}\n\n\tif ('TERM_PROGRAM' in env) {\n\t\tconst version = parseInt((env.TERM_PROGRAM_VERSION || '').split('.')[0], 10);\n\n\t\tswitch (env.TERM_PROGRAM) {\n\t\t\tcase 'iTerm.app':\n\t\t\t\treturn version >= 3 ? 3 : 2;\n\t\t\tcase 'Apple_Terminal':\n\t\t\t\treturn 2;\n\t\t\t// No default\n\t\t}\n\t}\n\n\tif (/-256(color)?$/i.test(env.TERM)) {\n\t\treturn 2;\n\t}\n\n\tif (/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)) {\n\t\treturn 1;\n\t}\n\n\tif ('COLORTERM' in env) {\n\t\treturn 1;\n\t}\n\n\tif (env.TERM === 'dumb') {\n\t\treturn min;\n\t}\n\n\treturn min;\n}\n\nfunction getSupportLevel(stream) {\n\tconst level = supportsColor(stream);\n\treturn translateLevel(level);\n}\n\nmodule.exports = {\n\tsupportsColor: getSupportLevel,\n\tstdout: getSupportLevel(process.stdout),\n\tstderr: getSupportLevel(process.stderr)\n};\n", "/**\n * Module dependencies.\n */\n\nconst tty = require('tty');\nconst util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n */\n\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.destroy = util.deprecate(\n\t() => {},\n\t'Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.'\n);\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\ntry {\n\t// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)\n\t// eslint-disable-next-line import/no-extraneous-dependencies\n\tconst supportsColor = require('supports-color');\n\n\tif (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {\n\t\texports.colors = [\n\t\t\t20,\n\t\t\t21,\n\t\t\t26,\n\t\t\t27,\n\t\t\t32,\n\t\t\t33,\n\t\t\t38,\n\t\t\t39,\n\t\t\t40,\n\t\t\t41,\n\t\t\t42,\n\t\t\t43,\n\t\t\t44,\n\t\t\t45,\n\t\t\t56,\n\t\t\t57,\n\t\t\t62,\n\t\t\t63,\n\t\t\t68,\n\t\t\t69,\n\t\t\t74,\n\t\t\t75,\n\t\t\t76,\n\t\t\t77,\n\t\t\t78,\n\t\t\t79,\n\t\t\t80,\n\t\t\t81,\n\t\t\t92,\n\t\t\t93,\n\t\t\t98,\n\t\t\t99,\n\t\t\t112,\n\t\t\t113,\n\t\t\t128,\n\t\t\t129,\n\t\t\t134,\n\t\t\t135,\n\t\t\t148,\n\t\t\t149,\n\t\t\t160,\n\t\t\t161,\n\t\t\t162,\n\t\t\t163,\n\t\t\t164,\n\t\t\t165,\n\t\t\t166,\n\t\t\t167,\n\t\t\t168,\n\t\t\t169,\n\t\t\t170,\n\t\t\t171,\n\t\t\t172,\n\t\t\t173,\n\t\t\t178,\n\t\t\t179,\n\t\t\t184,\n\t\t\t185,\n\t\t\t196,\n\t\t\t197,\n\t\t\t198,\n\t\t\t199,\n\t\t\t200,\n\t\t\t201,\n\t\t\t202,\n\t\t\t203,\n\t\t\t204,\n\t\t\t205,\n\t\t\t206,\n\t\t\t207,\n\t\t\t208,\n\t\t\t209,\n\t\t\t214,\n\t\t\t215,\n\t\t\t220,\n\t\t\t221\n\t\t];\n\t}\n} catch (error) {\n\t// Swallow - we only care if `supports-color` is available; it doesn't have to be.\n}\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(key => {\n\treturn /^debug_/i.test(key);\n}).reduce((obj, key) => {\n\t// Camel-case\n\tconst prop = key\n\t\t.substring(6)\n\t\t.toLowerCase()\n\t\t.replace(/_([a-z])/g, (_, k) => {\n\t\t\treturn k.toUpperCase();\n\t\t});\n\n\t// Coerce string value into JS value\n\tlet val = process.env[key];\n\tif (/^(yes|on|true|enabled)$/i.test(val)) {\n\t\tval = true;\n\t} else if (/^(no|off|false|disabled)$/i.test(val)) {\n\t\tval = false;\n\t} else if (val === 'null') {\n\t\tval = null;\n\t} else {\n\t\tval = Number(val);\n\t}\n\n\tobj[prop] = val;\n\treturn obj;\n}, {});\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n\treturn 'colors' in exports.inspectOpts ?\n\t\tBoolean(exports.inspectOpts.colors) :\n\t\ttty.isatty(process.stderr.fd);\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\tconst {namespace: name, useColors} = this;\n\n\tif (useColors) {\n\t\tconst c = this.color;\n\t\tconst colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c);\n\t\tconst prefix = `  ${colorCode};1m${name} \\u001B[0m`;\n\n\t\targs[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n\t\targs.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\\u001B[0m');\n\t} else {\n\t\targs[0] = getDate() + name + ' ' + args[0];\n\t}\n}\n\nfunction getDate() {\n\tif (exports.inspectOpts.hideDate) {\n\t\treturn '';\n\t}\n\treturn new Date().toISOString() + ' ';\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\n\nfunction log(...args) {\n\treturn process.stderr.write(util.format(...args) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\tif (namespaces) {\n\t\tprocess.env.DEBUG = namespaces;\n\t} else {\n\t\t// If you set a process.env field to null or undefined, it gets cast to the\n\t\t// string 'null' or 'undefined'. Just delete instead.\n\t\tdelete process.env.DEBUG;\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n\treturn process.env.DEBUG;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n\tdebug.inspectOpts = {};\n\n\tconst keys = Object.keys(exports.inspectOpts);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tdebug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nformatters.o = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts)\n\t\t.split('\\n')\n\t\t.map(str => str.trim())\n\t\t.join(' ');\n};\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n */\n\nformatters.O = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts);\n};\n", "/**\n * Detect Electron renderer / nwjs process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {\n\tmodule.exports = require('./browser.js');\n} else {\n\tmodule.exports = require('./node.js');\n}\n", "var debug;\n\nmodule.exports = function () {\n  if (!debug) {\n    try {\n      /* eslint global-require: off */\n      debug = require(\"debug\")(\"follow-redirects\");\n    }\n    catch (error) { /* */ }\n    if (typeof debug !== \"function\") {\n      debug = function () { /* */ };\n    }\n  }\n  debug.apply(null, arguments);\n};\n", "var url = require(\"url\");\nvar URL = url.URL;\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar Writable = require(\"stream\").Writable;\nvar assert = require(\"assert\");\nvar debug = require(\"./debug\");\n\n// Create handlers that pass events from native requests\nvar events = [\"abort\", \"aborted\", \"connect\", \"error\", \"socket\", \"timeout\"];\nvar eventHandlers = Object.create(null);\nevents.forEach(function (event) {\n  eventHandlers[event] = function (arg1, arg2, arg3) {\n    this._redirectable.emit(event, arg1, arg2, arg3);\n  };\n});\n\n// Error types with codes\nvar RedirectionError = createErrorType(\n  \"ERR_FR_REDIRECTION_FAILURE\",\n  \"Redirected request failed\"\n);\nvar TooManyRedirectsError = createErrorType(\n  \"ERR_FR_TOO_MANY_REDIRECTS\",\n  \"Maximum number of redirects exceeded\"\n);\nvar MaxBodyLengthExceededError = createErrorType(\n  \"ERR_FR_MAX_BODY_LENGTH_EXCEEDED\",\n  \"Request body larger than maxBodyLength limit\"\n);\nvar WriteAfterEndError = createErrorType(\n  \"ERR_STREAM_WRITE_AFTER_END\",\n  \"write after end\"\n);\n\n// An HTTP(S) request that can be redirected\nfunction RedirectableRequest(options, responseCallback) {\n  // Initialize the request\n  Writable.call(this);\n  this._sanitizeOptions(options);\n  this._options = options;\n  this._ended = false;\n  this._ending = false;\n  this._redirectCount = 0;\n  this._redirects = [];\n  this._requestBodyLength = 0;\n  this._requestBodyBuffers = [];\n\n  // Attach a callback if passed\n  if (responseCallback) {\n    this.on(\"response\", responseCallback);\n  }\n\n  // React to responses of native requests\n  var self = this;\n  this._onNativeResponse = function (response) {\n    self._processResponse(response);\n  };\n\n  // Perform the first request\n  this._performRequest();\n}\nRedirectableRequest.prototype = Object.create(Writable.prototype);\n\nRedirectableRequest.prototype.abort = function () {\n  abortRequest(this._currentRequest);\n  this.emit(\"abort\");\n};\n\n// Writes buffered data to the current native request\nRedirectableRequest.prototype.write = function (data, encoding, callback) {\n  // Writing is not allowed if end has been called\n  if (this._ending) {\n    throw new WriteAfterEndError();\n  }\n\n  // Validate input and shift parameters if necessary\n  if (!(typeof data === \"string\" || typeof data === \"object\" && (\"length\" in data))) {\n    throw new TypeError(\"data should be a string, Buffer or Uint8Array\");\n  }\n  if (typeof encoding === \"function\") {\n    callback = encoding;\n    encoding = null;\n  }\n\n  // Ignore empty buffers, since writing them doesn't invoke the callback\n  // https://github.com/nodejs/node/issues/22066\n  if (data.length === 0) {\n    if (callback) {\n      callback();\n    }\n    return;\n  }\n  // Only write when we don't exceed the maximum body length\n  if (this._requestBodyLength + data.length <= this._options.maxBodyLength) {\n    this._requestBodyLength += data.length;\n    this._requestBodyBuffers.push({ data: data, encoding: encoding });\n    this._currentRequest.write(data, encoding, callback);\n  }\n  // Error when we exceed the maximum body length\n  else {\n    this.emit(\"error\", new MaxBodyLengthExceededError());\n    this.abort();\n  }\n};\n\n// Ends the current native request\nRedirectableRequest.prototype.end = function (data, encoding, callback) {\n  // Shift parameters if necessary\n  if (typeof data === \"function\") {\n    callback = data;\n    data = encoding = null;\n  }\n  else if (typeof encoding === \"function\") {\n    callback = encoding;\n    encoding = null;\n  }\n\n  // Write data if needed and end\n  if (!data) {\n    this._ended = this._ending = true;\n    this._currentRequest.end(null, null, callback);\n  }\n  else {\n    var self = this;\n    var currentRequest = this._currentRequest;\n    this.write(data, encoding, function () {\n      self._ended = true;\n      currentRequest.end(null, null, callback);\n    });\n    this._ending = true;\n  }\n};\n\n// Sets a header value on the current native request\nRedirectableRequest.prototype.setHeader = function (name, value) {\n  this._options.headers[name] = value;\n  this._currentRequest.setHeader(name, value);\n};\n\n// Clears a header value on the current native request\nRedirectableRequest.prototype.removeHeader = function (name) {\n  delete this._options.headers[name];\n  this._currentRequest.removeHeader(name);\n};\n\n// Global timeout for all underlying requests\nRedirectableRequest.prototype.setTimeout = function (msecs, callback) {\n  var self = this;\n\n  // Destroys the socket on timeout\n  function destroyOnTimeout(socket) {\n    socket.setTimeout(msecs);\n    socket.removeListener(\"timeout\", socket.destroy);\n    socket.addListener(\"timeout\", socket.destroy);\n  }\n\n  // Sets up a timer to trigger a timeout event\n  function startTimer(socket) {\n    if (self._timeout) {\n      clearTimeout(self._timeout);\n    }\n    self._timeout = setTimeout(function () {\n      self.emit(\"timeout\");\n      clearTimer();\n    }, msecs);\n    destroyOnTimeout(socket);\n  }\n\n  // Stops a timeout from triggering\n  function clearTimer() {\n    // Clear the timeout\n    if (self._timeout) {\n      clearTimeout(self._timeout);\n      self._timeout = null;\n    }\n\n    // Clean up all attached listeners\n    self.removeListener(\"abort\", clearTimer);\n    self.removeListener(\"error\", clearTimer);\n    self.removeListener(\"response\", clearTimer);\n    if (callback) {\n      self.removeListener(\"timeout\", callback);\n    }\n    if (!self.socket) {\n      self._currentRequest.removeListener(\"socket\", startTimer);\n    }\n  }\n\n  // Attach callback if passed\n  if (callback) {\n    this.on(\"timeout\", callback);\n  }\n\n  // Start the timer if or when the socket is opened\n  if (this.socket) {\n    startTimer(this.socket);\n  }\n  else {\n    this._currentRequest.once(\"socket\", startTimer);\n  }\n\n  // Clean up on events\n  this.on(\"socket\", destroyOnTimeout);\n  this.on(\"abort\", clearTimer);\n  this.on(\"error\", clearTimer);\n  this.on(\"response\", clearTimer);\n\n  return this;\n};\n\n// Proxy all other public ClientRequest methods\n[\n  \"flushHeaders\", \"getHeader\",\n  \"setNoDelay\", \"setSocketKeepAlive\",\n].forEach(function (method) {\n  RedirectableRequest.prototype[method] = function (a, b) {\n    return this._currentRequest[method](a, b);\n  };\n});\n\n// Proxy all public ClientRequest properties\n[\"aborted\", \"connection\", \"socket\"].forEach(function (property) {\n  Object.defineProperty(RedirectableRequest.prototype, property, {\n    get: function () { return this._currentRequest[property]; },\n  });\n});\n\nRedirectableRequest.prototype._sanitizeOptions = function (options) {\n  // Ensure headers are always present\n  if (!options.headers) {\n    options.headers = {};\n  }\n\n  // Since http.request treats host as an alias of hostname,\n  // but the url module interprets host as hostname plus port,\n  // eliminate the host property to avoid confusion.\n  if (options.host) {\n    // Use hostname if set, because it has precedence\n    if (!options.hostname) {\n      options.hostname = options.host;\n    }\n    delete options.host;\n  }\n\n  // Complete the URL object when necessary\n  if (!options.pathname && options.path) {\n    var searchPos = options.path.indexOf(\"?\");\n    if (searchPos < 0) {\n      options.pathname = options.path;\n    }\n    else {\n      options.pathname = options.path.substring(0, searchPos);\n      options.search = options.path.substring(searchPos);\n    }\n  }\n};\n\n\n// Executes the next native request (initial or redirect)\nRedirectableRequest.prototype._performRequest = function () {\n  // Load the native protocol\n  var protocol = this._options.protocol;\n  var nativeProtocol = this._options.nativeProtocols[protocol];\n  if (!nativeProtocol) {\n    this.emit(\"error\", new TypeError(\"Unsupported protocol \" + protocol));\n    return;\n  }\n\n  // If specified, use the agent corresponding to the protocol\n  // (HTTP and HTTPS use different types of agents)\n  if (this._options.agents) {\n    var scheme = protocol.slice(0, -1);\n    this._options.agent = this._options.agents[scheme];\n  }\n\n  // Create the native request and set up its event handlers\n  var request = this._currentRequest =\n        nativeProtocol.request(this._options, this._onNativeResponse);\n  request._redirectable = this;\n  for (var event of events) {\n    request.on(event, eventHandlers[event]);\n  }\n\n  // RFC7230\u00A75.3.1: When making a request directly to an origin server, [\u2026]\n  // a client MUST send only the absolute path [\u2026] as the request-target.\n  this._currentUrl = /^\\//.test(this._options.path) ?\n    url.format(this._options) :\n    // When making a request to a proxy, [\u2026]\n    // a client MUST send the target URI in absolute-form [\u2026].\n    this._currentUrl = this._options.path;\n\n  // End a redirected request\n  // (The first request must be ended explicitly with RedirectableRequest#end)\n  if (this._isRedirect) {\n    // Write the request entity and end\n    var i = 0;\n    var self = this;\n    var buffers = this._requestBodyBuffers;\n    (function writeNext(error) {\n      // Only write if this request has not been redirected yet\n      /* istanbul ignore else */\n      if (request === self._currentRequest) {\n        // Report any write errors\n        /* istanbul ignore if */\n        if (error) {\n          self.emit(\"error\", error);\n        }\n        // Write the next buffer if there are still left\n        else if (i < buffers.length) {\n          var buffer = buffers[i++];\n          /* istanbul ignore else */\n          if (!request.finished) {\n            request.write(buffer.data, buffer.encoding, writeNext);\n          }\n        }\n        // End the request if `end` has been called on us\n        else if (self._ended) {\n          request.end();\n        }\n      }\n    }());\n  }\n};\n\n// Processes a response from the current native request\nRedirectableRequest.prototype._processResponse = function (response) {\n  // Store the redirected response\n  var statusCode = response.statusCode;\n  if (this._options.trackRedirects) {\n    this._redirects.push({\n      url: this._currentUrl,\n      headers: response.headers,\n      statusCode: statusCode,\n    });\n  }\n\n  // RFC7231\u00A76.4: The 3xx (Redirection) class of status code indicates\n  // that further action needs to be taken by the user agent in order to\n  // fulfill the request. If a Location header field is provided,\n  // the user agent MAY automatically redirect its request to the URI\n  // referenced by the Location field value,\n  // even if the specific status code is not understood.\n\n  // If the response is not a redirect; return it as-is\n  var location = response.headers.location;\n  if (!location || this._options.followRedirects === false ||\n      statusCode < 300 || statusCode >= 400) {\n    response.responseUrl = this._currentUrl;\n    response.redirects = this._redirects;\n    this.emit(\"response\", response);\n\n    // Clean up\n    this._requestBodyBuffers = [];\n    return;\n  }\n\n  // The response is a redirect, so abort the current request\n  abortRequest(this._currentRequest);\n  // Discard the remainder of the response to avoid waiting for data\n  response.destroy();\n\n  // RFC7231\u00A76.4: A client SHOULD detect and intervene\n  // in cyclical redirections (i.e., \"infinite\" redirection loops).\n  if (++this._redirectCount > this._options.maxRedirects) {\n    this.emit(\"error\", new TooManyRedirectsError());\n    return;\n  }\n\n  // Store the request headers if applicable\n  var requestHeaders;\n  var beforeRedirect = this._options.beforeRedirect;\n  if (beforeRedirect) {\n    requestHeaders = Object.assign({\n      // The Host header was set by nativeProtocol.request\n      Host: response.req.getHeader(\"host\"),\n    }, this._options.headers);\n  }\n\n  // RFC7231\u00A76.4: Automatic redirection needs to done with\n  // care for methods not known to be safe, [\u2026]\n  // RFC7231\u00A76.4.2\u20133: For historical reasons, a user agent MAY change\n  // the request method from POST to GET for the subsequent request.\n  var method = this._options.method;\n  if ((statusCode === 301 || statusCode === 302) && this._options.method === \"POST\" ||\n      // RFC7231\u00A76.4.4: The 303 (See Other) status code indicates that\n      // the server is redirecting the user agent to a different resource [\u2026]\n      // A user agent can perform a retrieval request targeting that URI\n      // (a GET or HEAD request if using HTTP) [\u2026]\n      (statusCode === 303) && !/^(?:GET|HEAD)$/.test(this._options.method)) {\n    this._options.method = \"GET\";\n    // Drop a possible entity and headers related to it\n    this._requestBodyBuffers = [];\n    removeMatchingHeaders(/^content-/i, this._options.headers);\n  }\n\n  // Drop the Host header, as the redirect might lead to a different host\n  var currentHostHeader = removeMatchingHeaders(/^host$/i, this._options.headers);\n\n  // If the redirect is relative, carry over the host of the last request\n  var currentUrlParts = url.parse(this._currentUrl);\n  var currentHost = currentHostHeader || currentUrlParts.host;\n  var currentUrl = /^\\w+:/.test(location) ? this._currentUrl :\n    url.format(Object.assign(currentUrlParts, { host: currentHost }));\n\n  // Determine the URL of the redirection\n  var redirectUrl;\n  try {\n    redirectUrl = url.resolve(currentUrl, location);\n  }\n  catch (cause) {\n    this.emit(\"error\", new RedirectionError(cause));\n    return;\n  }\n\n  // Create the redirected request\n  debug(\"redirecting to\", redirectUrl);\n  this._isRedirect = true;\n  var redirectUrlParts = url.parse(redirectUrl);\n  Object.assign(this._options, redirectUrlParts);\n\n  // Drop confidential headers when redirecting to a less secure protocol\n  // or to a different domain that is not a superdomain\n  if (redirectUrlParts.protocol !== currentUrlParts.protocol &&\n     redirectUrlParts.protocol !== \"https:\" ||\n     redirectUrlParts.host !== currentHost &&\n     !isSubdomain(redirectUrlParts.host, currentHost)) {\n    removeMatchingHeaders(/^(?:authorization|cookie)$/i, this._options.headers);\n  }\n\n  // Evaluate the beforeRedirect callback\n  if (typeof beforeRedirect === \"function\") {\n    var responseDetails = {\n      headers: response.headers,\n      statusCode: statusCode,\n    };\n    var requestDetails = {\n      url: currentUrl,\n      method: method,\n      headers: requestHeaders,\n    };\n    try {\n      beforeRedirect(this._options, responseDetails, requestDetails);\n    }\n    catch (err) {\n      this.emit(\"error\", err);\n      return;\n    }\n    this._sanitizeOptions(this._options);\n  }\n\n  // Perform the redirected request\n  try {\n    this._performRequest();\n  }\n  catch (cause) {\n    this.emit(\"error\", new RedirectionError(cause));\n  }\n};\n\n// Wraps the key/value object of protocols with redirect functionality\nfunction wrap(protocols) {\n  // Default settings\n  var exports = {\n    maxRedirects: 21,\n    maxBodyLength: 10 * 1024 * 1024,\n  };\n\n  // Wrap each protocol\n  var nativeProtocols = {};\n  Object.keys(protocols).forEach(function (scheme) {\n    var protocol = scheme + \":\";\n    var nativeProtocol = nativeProtocols[protocol] = protocols[scheme];\n    var wrappedProtocol = exports[scheme] = Object.create(nativeProtocol);\n\n    // Executes a request, following redirects\n    function request(input, options, callback) {\n      // Parse parameters\n      if (typeof input === \"string\") {\n        var urlStr = input;\n        try {\n          input = urlToOptions(new URL(urlStr));\n        }\n        catch (err) {\n          /* istanbul ignore next */\n          input = url.parse(urlStr);\n        }\n      }\n      else if (URL && (input instanceof URL)) {\n        input = urlToOptions(input);\n      }\n      else {\n        callback = options;\n        options = input;\n        input = { protocol: protocol };\n      }\n      if (typeof options === \"function\") {\n        callback = options;\n        options = null;\n      }\n\n      // Set defaults\n      options = Object.assign({\n        maxRedirects: exports.maxRedirects,\n        maxBodyLength: exports.maxBodyLength,\n      }, input, options);\n      options.nativeProtocols = nativeProtocols;\n\n      assert.equal(options.protocol, protocol, \"protocol mismatch\");\n      debug(\"options\", options);\n      return new RedirectableRequest(options, callback);\n    }\n\n    // Executes a GET request, following redirects\n    function get(input, options, callback) {\n      var wrappedRequest = wrappedProtocol.request(input, options, callback);\n      wrappedRequest.end();\n      return wrappedRequest;\n    }\n\n    // Expose the properties on the wrapped protocol\n    Object.defineProperties(wrappedProtocol, {\n      request: { value: request, configurable: true, enumerable: true, writable: true },\n      get: { value: get, configurable: true, enumerable: true, writable: true },\n    });\n  });\n  return exports;\n}\n\n/* istanbul ignore next */\nfunction noop() { /* empty */ }\n\n// from https://github.com/nodejs/node/blob/master/lib/internal/url.js\nfunction urlToOptions(urlObject) {\n  var options = {\n    protocol: urlObject.protocol,\n    hostname: urlObject.hostname.startsWith(\"[\") ?\n      /* istanbul ignore next */\n      urlObject.hostname.slice(1, -1) :\n      urlObject.hostname,\n    hash: urlObject.hash,\n    search: urlObject.search,\n    pathname: urlObject.pathname,\n    path: urlObject.pathname + urlObject.search,\n    href: urlObject.href,\n  };\n  if (urlObject.port !== \"\") {\n    options.port = Number(urlObject.port);\n  }\n  return options;\n}\n\nfunction removeMatchingHeaders(regex, headers) {\n  var lastValue;\n  for (var header in headers) {\n    if (regex.test(header)) {\n      lastValue = headers[header];\n      delete headers[header];\n    }\n  }\n  return (lastValue === null || typeof lastValue === \"undefined\") ?\n    undefined : String(lastValue).trim();\n}\n\nfunction createErrorType(code, defaultMessage) {\n  function CustomError(cause) {\n    Error.captureStackTrace(this, this.constructor);\n    if (!cause) {\n      this.message = defaultMessage;\n    }\n    else {\n      this.message = defaultMessage + \": \" + cause.message;\n      this.cause = cause;\n    }\n  }\n  CustomError.prototype = new Error();\n  CustomError.prototype.constructor = CustomError;\n  CustomError.prototype.name = \"Error [\" + code + \"]\";\n  CustomError.prototype.code = code;\n  return CustomError;\n}\n\nfunction abortRequest(request) {\n  for (var event of events) {\n    request.removeListener(event, eventHandlers[event]);\n  }\n  request.on(\"error\", noop);\n  request.abort();\n}\n\nfunction isSubdomain(subdomain, domain) {\n  const dot = subdomain.length - domain.length - 1;\n  return dot > 0 && subdomain[dot] === \".\" && subdomain.endsWith(domain);\n}\n\n// Exports\nmodule.exports = wrap({ http: http, https: https });\nmodule.exports.wrap = wrap;\n", "var httpNative   = require('http'),\n    httpsNative  = require('https'),\n    web_o  = require('./web-outgoing'),\n    common = require('../common'),\n    followRedirects = require('follow-redirects');\n\nweb_o = Object.keys(web_o).map(function(pass) {\n  return web_o[pass];\n});\n\nvar nativeAgents = { http: httpNative, https: httpsNative };\n\n/*!\n * Array of passes.\n *\n * A `pass` is just a function that is executed on `req, res, options`\n * so that you can easily add new checks while still keeping the base\n * flexible.\n */\n\n\nmodule.exports = {\n\n  /**\n   * Sets `content-length` to '0' if request is of DELETE type.\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {Object} Options Config object passed to the proxy\n   *\n   * @api private\n   */\n\n  deleteLength: function deleteLength(req, res, options) {\n    if((req.method === 'DELETE' || req.method === 'OPTIONS')\n       && !req.headers['content-length']) {\n      req.headers['content-length'] = '0';\n      delete req.headers['transfer-encoding'];\n    }\n  },\n\n  /**\n   * Sets timeout in request socket if it was specified in options.\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {Object} Options Config object passed to the proxy\n   *\n   * @api private\n   */\n\n  timeout: function timeout(req, res, options) {\n    if(options.timeout) {\n      req.socket.setTimeout(options.timeout);\n    }\n  },\n\n  /**\n   * Sets `x-forwarded-*` headers if specified in config.\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {Object} Options Config object passed to the proxy\n   *\n   * @api private\n   */\n\n  XHeaders: function XHeaders(req, res, options) {\n    if(!options.xfwd) return;\n\n    var encrypted = req.isSpdy || common.hasEncryptedConnection(req);\n    var values = {\n      for  : req.connection.remoteAddress || req.socket.remoteAddress,\n      port : common.getPort(req),\n      proto: encrypted ? 'https' : 'http'\n    };\n\n    ['for', 'port', 'proto'].forEach(function(header) {\n      req.headers['x-forwarded-' + header] =\n        (req.headers['x-forwarded-' + header] || '') +\n        (req.headers['x-forwarded-' + header] ? ',' : '') +\n        values[header];\n    });\n\n    req.headers['x-forwarded-host'] = req.headers['x-forwarded-host'] || req.headers['host'] || '';\n  },\n\n  /**\n   * Does the actual proxying. If `forward` is enabled fires up\n   * a ForwardStream, same happens for ProxyStream. The request\n   * just dies otherwise.\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {IncomingMessage} Res Response object\n   * @param {Object} Options Config object passed to the proxy\n   *\n   * @api private\n   */\n\n  stream: function stream(req, res, options, _, server, clb) {\n\n    // And we begin!\n    server.emit('start', req, res, options.target || options.forward);\n\n    var agents = options.followRedirects ? followRedirects : nativeAgents;\n    var http = agents.http;\n    var https = agents.https;\n\n    if(options.forward) {\n      // If forward enable, so just pipe the request\n      var forwardReq = (options.forward.protocol === 'https:' ? https : http).request(\n        common.setupOutgoing(options.ssl || {}, options, req, 'forward')\n      );\n\n      // error handler (e.g. ECONNRESET, ECONNREFUSED)\n      // Handle errors on incoming request as well as it makes sense to\n      var forwardError = createErrorHandler(forwardReq, options.forward);\n      req.on('error', forwardError);\n      forwardReq.on('error', forwardError);\n\n      (options.buffer || req).pipe(forwardReq);\n      if(!options.target) { return res.end(); }\n    }\n\n    // Request initalization\n    var proxyReq = (options.target.protocol === 'https:' ? https : http).request(\n      common.setupOutgoing(options.ssl || {}, options, req)\n    );\n\n    // Enable developers to modify the proxyReq before headers are sent\n    proxyReq.on('socket', function(socket) {\n      if(server && !proxyReq.getHeader('expect')) {\n        server.emit('proxyReq', proxyReq, req, res, options);\n      }\n    });\n\n    // allow outgoing socket to timeout so that we could\n    // show an error page at the initial request\n    if(options.proxyTimeout) {\n      proxyReq.setTimeout(options.proxyTimeout, function() {\n         proxyReq.abort();\n      });\n    }\n\n    // Ensure we abort proxy if request is aborted\n    req.on('aborted', function () {\n      proxyReq.abort();\n    });\n\n    // handle errors in proxy and incoming request, just like for forward proxy\n    var proxyError = createErrorHandler(proxyReq, options.target);\n    req.on('error', proxyError);\n    proxyReq.on('error', proxyError);\n\n    function createErrorHandler(proxyReq, url) {\n      return function proxyError(err) {\n        if (req.socket.destroyed && err.code === 'ECONNRESET') {\n          server.emit('econnreset', err, req, res, url);\n          return proxyReq.abort();\n        }\n\n        if (clb) {\n          clb(err, req, res, url);\n        } else {\n          server.emit('error', err, req, res, url);\n        }\n      }\n    }\n\n    (options.buffer || req).pipe(proxyReq);\n\n    proxyReq.on('response', function(proxyRes) {\n      if(server) { server.emit('proxyRes', proxyRes, req, res); }\n\n      if(!res.headersSent && !options.selfHandleResponse) {\n        for(var i=0; i < web_o.length; i++) {\n          if(web_o[i](req, res, proxyRes, options)) { break; }\n        }\n      }\n\n      if (!res.finished) {\n        // Allow us to listen when the proxy has completed\n        proxyRes.on('end', function () {\n          if (server) server.emit('end', req, res, proxyRes);\n        });\n        // We pipe to the response unless its expected to be handled by the user\n        if (!options.selfHandleResponse) proxyRes.pipe(res);\n      } else {\n        if (server) server.emit('end', req, res, proxyRes);\n      }\n    });\n  }\n\n};\n", "var http   = require('http'),\n    https  = require('https'),\n    common = require('../common');\n\n/*!\n * Array of passes.\n *\n * A `pass` is just a function that is executed on `req, socket, options`\n * so that you can easily add new checks while still keeping the base\n * flexible.\n */\n\n/*\n * Websockets Passes\n *\n */\n\n\nmodule.exports = {\n  /**\n   * WebSocket requests must have the `GET` method and\n   * the `upgrade:websocket` header\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {Socket} Websocket\n   *\n   * @api private\n   */\n\n  checkMethodAndHeader : function checkMethodAndHeader(req, socket) {\n    if (req.method !== 'GET' || !req.headers.upgrade) {\n      socket.destroy();\n      return true;\n    }\n\n    if (req.headers.upgrade.toLowerCase() !== 'websocket') {\n      socket.destroy();\n      return true;\n    }\n  },\n\n  /**\n   * Sets `x-forwarded-*` headers if specified in config.\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {Socket} Websocket\n   * @param {Object} Options Config object passed to the proxy\n   *\n   * @api private\n   */\n\n  XHeaders : function XHeaders(req, socket, options) {\n    if(!options.xfwd) return;\n\n    var values = {\n      for  : req.connection.remoteAddress || req.socket.remoteAddress,\n      port : common.getPort(req),\n      proto: common.hasEncryptedConnection(req) ? 'wss' : 'ws'\n    };\n\n    ['for', 'port', 'proto'].forEach(function(header) {\n      req.headers['x-forwarded-' + header] =\n        (req.headers['x-forwarded-' + header] || '') +\n        (req.headers['x-forwarded-' + header] ? ',' : '') +\n        values[header];\n    });\n  },\n\n  /**\n   * Does the actual proxying. Make the request and upgrade it\n   * send the Switching Protocols request and pipe the sockets.\n   *\n   * @param {ClientRequest} Req Request object\n   *\u00A0@param {Socket} Websocket\n   * @param {Object} Options Config object passed to the proxy\n   *\n   * @api private\n   */\n  stream : function stream(req, socket, options, head, server, clb) {\n\n    var createHttpHeader = function(line, headers) {\n      return Object.keys(headers).reduce(function (head, key) {\n        var value = headers[key];\n\n        if (!Array.isArray(value)) {\n          head.push(key + ': ' + value);\n          return head;\n        }\n\n        for (var i = 0; i < value.length; i++) {\n          head.push(key + ': ' + value[i]);\n        }\n        return head;\n      }, [line])\n      .join('\\r\\n') + '\\r\\n\\r\\n';\n    }\n\n    common.setupSocket(socket);\n\n    if (head && head.length) socket.unshift(head);\n\n\n    var proxyReq = (common.isSSL.test(options.target.protocol) ? https : http).request(\n      common.setupOutgoing(options.ssl || {}, options, req)\n    );\n\n    // Enable developers to modify the proxyReq before headers are sent\n    if (server) { server.emit('proxyReqWs', proxyReq, req, socket, options, head); }\n\n    // Error Handler\n    proxyReq.on('error', onOutgoingError);\n    proxyReq.on('response', function (res) {\n      // if upgrade event isn't going to happen, close the socket\n      if (!res.upgrade) {\n        socket.write(createHttpHeader('HTTP/' + res.httpVersion + ' ' + res.statusCode + ' ' + res.statusMessage, res.headers));\n        res.pipe(socket);\n      }\n    });\n\n    proxyReq.on('upgrade', function(proxyRes, proxySocket, proxyHead) {\n      proxySocket.on('error', onOutgoingError);\n\n      // Allow us to listen when the websocket has completed\n      proxySocket.on('end', function () {\n        server.emit('close', proxyRes, proxySocket, proxyHead);\n      });\n\n      // The pipe below will end proxySocket if socket closes cleanly, but not\n      // if it errors (eg, vanishes from the net and starts returning\n      // EHOSTUNREACH). We need to do that explicitly.\n      socket.on('error', function () {\n        proxySocket.end();\n      });\n\n      common.setupSocket(proxySocket);\n\n      if (proxyHead && proxyHead.length) proxySocket.unshift(proxyHead);\n\n      //\n      // Remark: Handle writing the headers to the socket when switching protocols\n      // Also handles when a header is an array\n      //\n      socket.write(createHttpHeader('HTTP/1.1 101 Switching Protocols', proxyRes.headers));\n\n      proxySocket.pipe(socket).pipe(proxySocket);\n\n      server.emit('open', proxySocket);\n      server.emit('proxySocket', proxySocket);  //DEPRECATED.\n    });\n\n    return proxyReq.end(); // XXX: CHECK IF THIS IS THIS CORRECT\n\n    function onOutgoingError(err) {\n      if (clb) {\n        clb(err, req, socket);\n      } else {\n        server.emit('error', err, req, socket);\n      }\n      socket.end();\n    }\n  }\n};\n", "var httpProxy = module.exports,\n    extend    = require('util')._extend,\n    parse_url = require('url').parse,\n    EE3       = require('eventemitter3'),\n    http      = require('http'),\n    https     = require('https'),\n    web       = require('./passes/web-incoming'),\n    ws        = require('./passes/ws-incoming');\n\nhttpProxy.Server = ProxyServer;\n\n/**\n * Returns a function that creates the loader for\n * either `ws` or `web`'s  passes.\n *\n * Examples:\n *\n *    httpProxy.createRightProxy('ws')\n *    // => [Function]\n *\n * @param {String} Type Either 'ws' or 'web'\n *\u00A0\n * @return {Function} Loader Function that when called returns an iterator for the right passes\n *\n * @api private\n */\n\nfunction createRightProxy(type) {\n\n  return function(options) {\n    return function(req, res /*, [head], [opts] */) {\n      var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n          args = [].slice.call(arguments),\n          cntr = args.length - 1,\n          head, cbl;\n\n      /* optional args parse begin */\n      if(typeof args[cntr] === 'function') {\n        cbl = args[cntr];\n\n        cntr--;\n      }\n\n      var requestOptions = options;\n      if(\n        !(args[cntr] instanceof Buffer) &&\n        args[cntr] !== res\n      ) {\n        //Copy global options\n        requestOptions = extend({}, options);\n        //Overwrite with request options\n        extend(requestOptions, args[cntr]);\n\n        cntr--;\n      }\n\n      if(args[cntr] instanceof Buffer) {\n        head = args[cntr];\n      }\n\n      /* optional args parse end */\n\n      ['target', 'forward'].forEach(function(e) {\n        if (typeof requestOptions[e] === 'string')\n          requestOptions[e] = parse_url(requestOptions[e]);\n      });\n\n      if (!requestOptions.target && !requestOptions.forward) {\n        return this.emit('error', new Error('Must provide a proper URL as target'));\n      }\n\n      for(var i=0; i < passes.length; i++) {\n        /**\n         * Call of passes functions\n         * pass(req, res, options, head)\n         *\n         * In WebSockets case the `res` variable\n         * refer to the connection socket\n         * pass(req, socket, options, head)\n         */\n        if(passes[i](req, res, requestOptions, head, this, cbl)) { // passes can return a truthy value to halt the loop\n          break;\n        }\n      }\n    };\n  };\n}\nhttpProxy.createRightProxy = createRightProxy;\n\nfunction ProxyServer(options) {\n  EE3.call(this);\n\n  options = options || {};\n  options.prependPath = options.prependPath === false ? false : true;\n\n  this.web = this.proxyRequest           = createRightProxy('web')(options);\n  this.ws  = this.proxyWebsocketRequest  = createRightProxy('ws')(options);\n  this.options = options;\n\n  this.webPasses = Object.keys(web).map(function(pass) {\n    return web[pass];\n  });\n\n  this.wsPasses = Object.keys(ws).map(function(pass) {\n    return ws[pass];\n  });\n\n  this.on('error', this.onError, this);\n\n}\n\nrequire('util').inherits(ProxyServer, EE3);\n\nProxyServer.prototype.onError = function (err) {\n  //\n  // Remark: Replicate node core behavior using EE3\n  // so we force people to handle their own errors\n  //\n  if(this.listeners('error').length === 1) {\n    throw err;\n  }\n};\n\nProxyServer.prototype.listen = function(port, hostname) {\n  var self    = this,\n      closure = function(req, res) { self.web(req, res); };\n\n  this._server  = this.options.ssl ?\n    https.createServer(this.options.ssl, closure) :\n    http.createServer(closure);\n\n  if(this.options.ws) {\n    this._server.on('upgrade', function(req, socket, head) { self.ws(req, socket, head); });\n  }\n\n  this._server.listen(port, hostname);\n\n  return this;\n};\n\nProxyServer.prototype.close = function(callback) {\n  var self = this;\n  if (this._server) {\n    this._server.close(done);\n  }\n\n  // Wrap callback to nullify server after all open connections are closed.\n  function done() {\n    self._server = null;\n    if (callback) {\n      callback.apply(null, arguments);\n    }\n  };\n};\n\nProxyServer.prototype.before = function(type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n  var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n      i = false;\n\n  passes.forEach(function(v, idx) {\n    if(v.name === passName) i = idx;\n  })\n\n  if(i === false) throw new Error('No such pass');\n\n  passes.splice(i, 0, callback);\n};\nProxyServer.prototype.after = function(type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n  var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n      i = false;\n\n  passes.forEach(function(v, idx) {\n    if(v.name === passName) i = idx;\n  })\n\n  if(i === false) throw new Error('No such pass');\n\n  passes.splice(i++, 0, callback);\n};\n", " // Use explicit /index.js to help browserify negociation in require '/lib/http-proxy' (!)\nvar ProxyServer = require('./http-proxy/index.js').Server;\n\n\n/**\n * Creates the proxy server.\n *\n * Examples:\n *\n *    httpProxy.createProxyServer({ .. }, 8000)\n *    // => '{ web: [Function], ws: [Function] ... }'\n *\n * @param {Object} Options Config object passed to the proxy\n *\n * @return {Object} Proxy Proxy object with handlers for `ws` and `web` requests\n *\n * @api public\n */\n\n\nfunction createProxyServer(options) {\n  /*\n   *  `options` is needed and it must have the following layout:\n   *\n   *  {\n   *    target : <url string to be parsed with the url module>\n   *    forward: <url string to be parsed with the url module>\n   *    agent  : <object to be passed to http(s).request>\n   *    ssl    : <object to be passed to https.createServer()>\n   *    ws     : <true/false, if you want to proxy websockets>\n   *    xfwd   : <true/false, adds x-forward headers>\n   *    secure : <true/false, verify SSL certificate>\n   *    toProxy: <true/false, explicitly specify if we are proxying to another proxy>\n   *    prependPath: <true/false, Default: true - specify whether you want to prepend the target's path to the proxy path>\n   *    ignorePath: <true/false, Default: false - specify whether you want to ignore the proxy path of the incoming request>\n   *    localAddress : <Local interface string to bind for outgoing connections>\n   *    changeOrigin: <true/false, Default: false - changes the origin of the host header to the target URL>\n   *    preserveHeaderKeyCase: <true/false, Default: false - specify whether you want to keep letter case of response header key >\n   *    auth   : Basic authentication i.e. 'user:password' to compute an Authorization header.\n   *    hostRewrite: rewrites the location hostname on (201/301/302/307/308) redirects, Default: null.\n   *    autoRewrite: rewrites the location host/port on (201/301/302/307/308) redirects based on requested host/port. Default: false.\n   *    protocolRewrite: rewrites the location protocol on (201/301/302/307/308) redirects to 'http' or 'https'. Default: null.\n   *  }\n   *\n   *  NOTE: `options.ws` and `options.ssl` are optional.\n   *    `options.target and `options.forward` cannot be\n   *    both missing\n   *  }\n   */\n\n  return new ProxyServer(options);\n}\n\n\nProxyServer.createProxyServer = createProxyServer;\nProxyServer.createServer      = createProxyServer;\nProxyServer.createProxy       = createProxyServer;\n\n\n\n\n/**\n * Export the proxy \"Server\" as the main export.\n */\nmodule.exports = ProxyServer;\n\n", "/*!\n * Caron dimonio, con occhi di bragia\n * loro accennando, tutte le raccoglie;\n * batte col remo qualunque s\u2019adagia \n *\n * Charon the demon, with the eyes of glede,\n * Beckoning to them, collects them all together,\n * Beats with his oar whoever lags behind\n *          \n *          Dante - The Divine Comedy (Canto III)\n */\n\nmodule.exports = require('./lib/http-proxy');", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst http_proxy_1 = __importDefault(require(\"http-proxy\"));\nconst proxy = http_proxy_1.default.createProxyServer({\n    changeOrigin: true,\n});\n/**\n * Proxies the request to the specified backend as a stream.  This can be used for event streams\n * for hot module reloading.\n * @param req The downstream request\n * @param res The downstream response\n * @param backendConfig The backend config from `layer0.config.js`\n * @param errorHandler A function to call when an error occurs\n */\nfunction stream(req, res, backendConfig, errorHandler) {\n    const protocol = backendConfig.domainOrIp === '127.0.0.1' ? 'http' : 'https';\n    const config = {\n        target: {\n            protocol,\n            host: backendConfig.domainOrIp,\n            port: backendConfig.port,\n        },\n    };\n    // @ts-ignore\n    proxy.web(req, res, config, errorHandler || Function.prototype);\n}\nexports.default = stream;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * List of header regexes that will be matched against user provided header name.\n * The following headers are not allowed for user to modify in any way.\n *\n * * `x-0-platform` headers are generated and maintained by Layer0 platform to store intermediate state during request processing\n * * `x-0-version` header should only be manipulated by Layer0 platform\n * * `x-0-t` header should only be manipulated by Layer0 platform\n * * `x-0-components` header should only be manipulated by Layer0 platform\n * * `x-0-status` header should only be manipulated by Layer0 platform\n * * `x-0-lambda-name`  header should only be manipulated by Layer0 platform as otherwise it messes with reverse proxying. Removed by XBP\n * * `x-0-lambda-schedwule-timeout` header should only be manipulated by Layer0 platform as otherwise it messes with reverse proxying. Removed by XBP\n * * `x-0-received-at` header should only be manipulated by Layer0 platform as otherwise it messes with reverse proxying.\n * * `host` header should only be manipulated by Layer0 platform as otherwise it messes with reverse proxying\n * * `x-request-id` header is generated by Layer0 platform and used as unique identifier of requests\n * * `content-length` header cannot be manipulated apart from manipulating the body and we don't support that in the edge\n * * `via` header is used to prevent request loops in the platform\n */\nconst LAYER0_PROHIBITED_HEADER_NAMES = [\n    // Only allowed for platform to manipulate\n    /^x-0-platform/i,\n    // Blacklist for x-0-* headers\n    /^x-0-version$/i,\n    /^x-0-t$/i,\n    /^x-0-components$/i,\n    /^x-0-status$/i,\n    /^x-0-lambda-name$/i,\n    /^x-0-lambda-schedule-timeout$/i,\n    /^x-0-received-at$/i,\n    // Blacklist for non x-0-* headers\n    /^host$/i,\n    /^x-request-id$/i,\n    /^content-length$/i,\n    /^via$/i,\n];\n/**\n * List of cookie regexes that will be matched against user provided cookie name.\n * The following cookies are not allowed for user to modify in any way.\n *\n * * `layer0_*` cookies are created and maintained by Layer0 platform (e.g. `layer0_buckets` and `layer0_destination`)\n * * `layer0_devtools_*` cookies allow enabling/disabling the devtools on a per-user or per-environment basisc\n *    (cf. packages/devtools/src/addBuiltInRoutes.js)\n */\nconst LAYER0_PROHIBITED_COOKIE_NAMES = [/^layer0_/i];\nconst LAYER0_WHITELISTED_COOKIE_NAMES = [/^layer0_devtools/i];\n/**\n * Validate that prohibited header names are not overrideable by the user\n * @param name\n */\nconst validateProhibitedHeaderNames = (name) => {\n    if (LAYER0_PROHIBITED_HEADER_NAMES.find(prohibitedRegex => name.match(prohibitedRegex))) {\n        throw new Error(`Header \"${name}\" is reserved and cannot be modified`);\n    }\n};\n/**\n * Validate that prohibited cookie names are not overrideable by the user\n * @param name\n */\nconst validateProhibitedCookieNames = (name) => {\n    if (LAYER0_PROHIBITED_COOKIE_NAMES.find(prohibitedRegex => name.match(prohibitedRegex)) &&\n        !LAYER0_WHITELISTED_COOKIE_NAMES.find(whitelistRegexp => name.match(whitelistRegexp))) {\n        throw new Error(`Cookie \"${name}\" is reserved and cannot be modified`);\n    }\n};\n/**\n * Validate Set response header\n * @param name header name\n * @param value header value\n */\nexports.validateSetResponseHeader = (name /* value */) => {\n    validateProhibitedHeaderNames(name);\n};\n/**\n * Validate Update response header\n * @param name header name\n * @param match match pattern\n * @param replace replace value\n */\nexports.validateUpdateResponseHeader = (name /* match, replace */) => {\n    validateProhibitedHeaderNames(name);\n};\n/**\n * Validate Remove response header\n * @param name\n */\nexports.validateRemoveResponseHeader = (name) => {\n    validateProhibitedHeaderNames(name);\n};\n/**\n * Validate set request header\n * @param name header name\n * @param value header value\n */\nexports.validateSetRequestHeader = (name) => {\n    validateProhibitedHeaderNames(name);\n};\n/**\n * Validate Update request header\n * @param name header name\n * @param match match pattern\n * @param replace replace value\n */\nexports.validateUpdateRequestHeader = (name) => {\n    validateProhibitedHeaderNames(name);\n};\n/**\n * Validate Remove request header\n * @param name\n */\nexports.validateRemoveRequestHeader = (name) => {\n    validateProhibitedHeaderNames(name);\n};\n/**\n * Validate cookie name.\n * @param name\n */\nexports.validateCookieName = (name) => {\n    validateProhibitedCookieNames(name);\n};\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Converts null to an empty RouteCriteria and a string to a RouteCriteria with path.\n * @param criteria null, a route pattern, or an object that implements the RouteCriteria interface\n */\nfunction normalizeCriteria(criteria) {\n    if (criteria == null) {\n        return {};\n    }\n    else if (typeof criteria === 'string') {\n        return {\n            path: criteria,\n        };\n    }\n    else {\n        return criteria;\n    }\n}\nexports.default = normalizeCriteria;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst path_to_regexp_1 = require(\"path-to-regexp\");\n/**\n * Error class thrown by PathMatcher class.\n */\nclass PathMatcherError extends Error {\n    constructor(pattern) {\n        super(`Route pattern \"${pattern}\" contains invalid syntax. See https://docs.layer0.co/guides/routing#section_route_pattern_syntax`); // istanbul ignore next - this is a known issue with TypeScript\n        this.isUserError = true;\n    }\n}\nexports.PathMatcherError = PathMatcherError;\n/**\n * @private\n * A simple abstraction of path-to-regexp that makes the process of\n * extracting variables from requests paths repeatable across multiple use cases\n * such as matching a route and rewriting params.\n */\nclass PathMatcher {\n    /**\n     * A path param in path-to-regexp syntax\n     * @param pattern\n     */\n    constructor(pattern) {\n        this.pattern = pattern;\n    }\n    /**\n     * Returns key/value pairs if the path matches the pattern, otherwise undefined\n     * @param path\n     */\n    match(path) {\n        if (!this.matcher) {\n            try {\n                this.matcher = path_to_regexp_1.match(this.pattern, { decode: decodeURIComponent });\n            }\n            catch (e) {\n                throw new PathMatcherError(this.pattern);\n            }\n        }\n        PathMatcher.validatePattern(this.pattern);\n        const result = this.matcher(path);\n        return result ? result.params : undefined;\n    }\n    /**\n     * Validate the given pattern as acceptable. If it's not acceptable an exception is raised\n     * with sufficient information to fix the problem.\n     *\n     * Notes:\n     * - Partial splat patterns (e.g. `/partial-:splat*`) have both semantic and execution issues.\n     * Semantic issues lie in the fact that path-to-regexp will generate a surprisingly different\n     * regexp for partial splat vs full splat pattern (e.g. `/full/:splat*`) that will actually not\n     * match all the sub-paths that follow the partial prefix but rather only the rest of the path\n     * until the end of the string. Execution issues lie in the fact that such regexes have been\n     * observed to block Chrome, Node and other regular expression engines. To prevent issues with\n     * these patterns we do not support them but propose a reasonable alternative of splitting the\n     * splat into fixed and splat parameters.\n     */\n    static validatePattern(pattern) {\n        const partialSplatRouteMatch = pattern.match(this.PARTIAL_SPLAT_ROUTE);\n        if (partialSplatRouteMatch) {\n            const [_, prefix, splat] = partialSplatRouteMatch;\n            const alternativePattern = pattern.replace(`${prefix}${splat}`, `${prefix}:suffix/${splat}`);\n            throw new PathMatcherError(`Partial splat routes are not supported. Use \"${alternativePattern}\" instead of \"${pattern}\"`);\n        }\n        return true;\n    }\n}\nexports.default = PathMatcher;\n/**\n * Matches partial splat (e.g. `/partial-:splat*`) routes.\n */\nPathMatcher.PARTIAL_SPLAT_ROUTE = /(\\/[^:/]+)(:[^*/#?]+\\*)/;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction toLower(str) {\n    if (typeof str !== 'string') {\n        return '';\n    }\n    return str.toLowerCase();\n}\nexports.default = toLower;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"../constants\");\nconst universalRouteUtils_1 = require(\"./universalRouteUtils\");\nconst cookie_1 = require(\"cookie\");\nconst path_to_regexp_1 = require(\"path-to-regexp\");\nconst normalizeCriteria_1 = __importDefault(require(\"./normalizeCriteria\"));\nconst PathMatcher_1 = __importStar(require(\"./PathMatcher\"));\nconst querystring_1 = __importDefault(require(\"querystring\"));\nconst toEdgeRegex_1 = __importDefault(require(\"../utils/toEdgeRegex\"));\nconst toLower_1 = __importDefault(require(\"../utils/toLower\"));\n/**\n * @private\n */\nclass Route {\n    /**\n     * Creates a new Route\n     * @param criteria A string or an object with `path`, `headers`, and `method`.\n     * @param handler A route handler\n     * @param options A route options\n     */\n    constructor(criteria, handler, options) {\n        this.criteria = normalizeCriteria_1.default(criteria);\n        this.handler = handler;\n        this.options = options;\n        if (this.criteria.path) {\n            this.matcher = new PathMatcher_1.default(this.criteria.path);\n        }\n    }\n    /**\n     * Returns params if route matches the request's method, headers, cookies and path.\n     * @param req\n     * @return The path params if the route matches the current request, otherwise false\n     */\n    match(req) {\n        // Params are mostly extracted from path, but in they can also be extracted from query string, header, cookie, etc.\n        // although that would need to be implemented at EDGE too, which in general is not trivial.\n        // As of now, on EDGE, this is only implemented for query string params to inject in redirect()\n        const matchParamsFns = [\n            this.matchPath,\n            this.matchProtocol,\n            this.matchMethod,\n            this.matchHeaders,\n            this.matchQueryParams,\n            this.matchCookies,\n            this.matchBody,\n        ];\n        const mergedParams = {};\n        for (const matchParamsFn of matchParamsFns) {\n            const paramsOrBoolean = matchParamsFn.bind(this)(req);\n            if (!paramsOrBoolean) {\n                // One matcher failed, no need to go further\n                return false;\n            }\n            Object.assign(mergedParams, paramsOrBoolean);\n        }\n        // We wait until now before assigning params to the request so we are sure the route actually matched the request.\n        req.params = mergedParams;\n        return mergedParams;\n    }\n    /**\n     * Matches response. This is used for error routes and each route that contains response matcher is considered as\n     * a route for handling the error pages. Each error route must send a response.\n     * @param res Response\n     * @returns\n     */\n    matchResponse(res) {\n        return this.matchResponseStatus(res);\n    }\n    matchResponseStatus(res) {\n        var _a, _b, _c;\n        if ((_b = (_a = this.criteria) === null || _a === void 0 ? void 0 : _a.response) === null || _b === void 0 ? void 0 : _b.statusCode) {\n            return !!((_c = res.statusCode) === null || _c === void 0 ? void 0 : _c.toString().match(this.criteria.response.statusCode));\n        }\n        return false;\n    }\n    // Match criteria path to request url\n    matchPath(req) {\n        if (this.matcher) {\n            return this.matcher.match(req.path);\n        }\n        else {\n            return {}; // return a match with no params\n        }\n    }\n    // Match criteria method to request method\n    matchMethod(req) {\n        if (!this.criteria.method || !req.method) {\n            return true;\n        }\n        return new RegExp(this.criteria.method, 'i').test(req.method);\n    }\n    /**\n     * Run thru criteria headers and match with request headers.\n     *\n     * Header names are *not* case-sensitive and they are all lower-cased per Node behavior we pass `toLower` to matcher function.\n     *\n     * @param req Request object\n     */\n    matchHeaders(req) {\n        if (this.criteria.headers) {\n            return universalRouteUtils_1.matchCriteriaRegexObjectWithRequestObject(this.criteria.headers, req.headers, toLower_1.default);\n        }\n        return true;\n    }\n    /**\n     * Matches JSON body based on given criteria\n     *\n     * @param req Request object\n     *\n     * @returns Boolean\n     */\n    matchBody(req) {\n        if (this.criteria.body && this.criteria.body.parse == 'json' && req.body) {\n            let bodyObject;\n            try {\n                bodyObject = JSON.parse(req.body);\n            }\n            catch {\n                return false;\n            }\n            return universalRouteUtils_1.deepMatchObject(bodyObject, this.criteria.body.criteria);\n        }\n        return true;\n    }\n    /**\n     * Run thru criteria query and match with request query parameters.\n     *\n     * Query string names are case-sensitive so we use the default behaviour of\n     * `matchCriteriaRegexObjectWithRequestObject`.\n     *\n     * @param req Request object\n     */\n    matchQueryParams(req) {\n        if (this.criteria.query) {\n            // When there's no query params it means there's no way it's a match when criteria is set\n            if (!req.query) {\n                return false;\n            }\n            return universalRouteUtils_1.matchCriteriaRegexObjectWithRequestObject(this.criteria.query, req.query);\n        }\n        return true;\n    }\n    /**\n     * Run thru criteria cookies and match with request cookies.\n     *\n     * Cookie names are case-sensitive so we use the default behaviour of\n     * `matchCriteriaRegexObjectWithRequestObject`.\n     *\n     * @param req Request object\n     */\n    matchCookies(req) {\n        if (this.criteria.cookies) {\n            const cookieHeader = req.headers['cookie'];\n            if (cookieHeader == null) {\n                // When there is no cookie header, we return true only if all matchers\n                // on cookies are null meaning \"cookie not present\".\n                return Object.values(this.criteria.cookies).every(regex => regex === null);\n            }\n            const cookieValue = Array.isArray(cookieHeader) ? cookieHeader.join('; ') : cookieHeader;\n            const reqCookies = cookie_1.parse(cookieValue);\n            return universalRouteUtils_1.matchCriteriaRegexObjectWithRequestObject(this.criteria.cookies, reqCookies);\n        }\n        return true;\n    }\n    /**\n     * Match the protocol for the request. All routes have the implicit `https` protocol\n     * unless explicitly specified as something else.\n     *\n     * Because HTTP is a subset of HTTPS we make sure that when strings are used we match\n     * the whole value rather than just a part of it.\n     *\n     * @param req Request object\n     */\n    matchProtocol(req) {\n        const protocol = (req.headers && req.headers[constants_1.HTTP_HEADERS.x0Protocol]) || 'https';\n        let criteriaProtocolRegex;\n        if (typeof this.criteria.protocol === 'string') {\n            criteriaProtocolRegex = new RegExp(`^${this.criteria.protocol}$`, 'i');\n        }\n        else {\n            criteriaProtocolRegex = new RegExp(this.criteria.protocol || '^https$', 'i');\n        }\n        return universalRouteUtils_1.testRegExp(criteriaProtocolRegex, protocol);\n    }\n    toString() {\n        const { path, ...criteria } = this.criteria;\n        if (Object.keys(criteria).length) {\n            return JSON.stringify(this.criteria);\n        }\n        else if (path) {\n            return path;\n        }\n        else {\n            return 'fallback';\n        }\n    }\n    toRegex() {\n        return Route.toRegexp(this.criteria.path);\n    }\n    /**\n     * Returns criteria json\n     * This is consumed by cache metrics that will transform the route to be as similar as in routes file\n     */\n    toJson() {\n        var _a;\n        return JSON.stringify({ ...this.criteria, label: (_a = this.options) === null || _a === void 0 ? void 0 : _a.label }, (_, value) => {\n            // We have to convert regular expressions to string otherwise it will not be logged\n            if (value instanceof RegExp) {\n                return value.toString();\n            }\n            return value;\n        });\n    }\n    /**\n     * Returns a string with the regex representation of the route.\n     * @returns Regexp string representation of the route\n     */\n    toRegexString() {\n        return this.toRegex().source;\n    }\n    /**\n     * Returns a regex string compatible with the edge regular express parser\n     */\n    toEdgeRegexString() {\n        return Route.toEdgeRegexString(this.criteria.path);\n    }\n    /**\n     * Returns if the route should match response criteria.\n     *\n     * @returns\n     */\n    isRespRoute() {\n        return !!this.criteria.response;\n    }\n    static toRegexp(path) {\n        if (path) {\n            try {\n                return path_to_regexp_1.pathToRegexp(path);\n            }\n            catch (e) {\n                throw new PathMatcher_1.PathMatcherError(path);\n            }\n        }\n        else {\n            // For fallbacks we want everything matched so that we can replace everything if needed.\n            // We insist on total matching with `^` and `$` because some regex replacement algorithms\n            // have issues with correctly applying `.*` in completely greedy manner (e.g. Fastly's `regsuball`)\n            return /^.*$/;\n        }\n    }\n    static toEdgeRegexString(path) {\n        return toEdgeRegex_1.default(Route.toRegexp(path));\n    }\n    /**\n     * Generate a path-to-regexp comptible path that includes query strings\n     * In path-to-regexp, '?' is a special character so it needs to be escaped\n     *\n     * Note that we prevent querystring from escaping ':', which is used to inject\n     * matched params from the path\n     *\n     * @param path\n     * @param query\n     */\n    static pathWithQueryString(path, query) {\n        const queryString = querystring_1.default.stringify(query).replace(/%3A/g, ':');\n        return path + (queryString && `\\\\?${queryString}`);\n    }\n}\nexports.default = Route;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst zlib_1 = require(\"zlib\");\nconst constants_1 = require(\"../constants\");\n/**\n * If needed decodes the body in place from the response content-encoding.\n * Removes the content-encoding header and updates the content-length as the\n * decoded body has no encoding and will have a different length.\n * @param response\n * @returns True if decoding happened or wasn't needed, false otherwise\n */\nfunction decode(response) {\n    var _a;\n    const contentEncoding = (_a = response.getHeader(constants_1.HTTP_HEADERS.contentEncoding)) === null || _a === void 0 ? void 0 : _a.toLowerCase();\n    // When there is no encoding, then there is nothing to decode.\n    if (!contentEncoding) {\n        return true;\n    }\n    switch (contentEncoding) {\n        case constants_1.GZIP_ENCODING: {\n            if (!Buffer.isBuffer(response.body)) {\n                return false;\n            }\n            response.body = zlib_1.gunzipSync(response.body);\n            response.removeHeader(constants_1.HTTP_HEADERS.contentEncoding);\n            response.setHeader(constants_1.HTTP_HEADERS.contentLength, Buffer.byteLength(response.body));\n            return true;\n        }\n        case constants_1.BROTLI_ENCODING: {\n            if (!Buffer.isBuffer(response.body)) {\n                return false;\n            }\n            response.body = zlib_1.brotliDecompressSync(response.body);\n            response.removeHeader(constants_1.HTTP_HEADERS.contentEncoding);\n            response.setHeader(constants_1.HTTP_HEADERS.contentLength, Buffer.byteLength(response.body));\n            return true;\n        }\n        default: {\n            // We cannot decode the body for unsupported encodings.\n            return false;\n        }\n    }\n}\nexports.default = decode;\n", "'use strict'\nmodule.exports = function (Yallist) {\n  Yallist.prototype[Symbol.iterator] = function* () {\n    for (let walker = this.head; walker; walker = walker.next) {\n      yield walker.value\n    }\n  }\n}\n", "'use strict'\nmodule.exports = Yallist\n\nYallist.Node = Node\nYallist.create = Yallist\n\nfunction Yallist (list) {\n  var self = this\n  if (!(self instanceof Yallist)) {\n    self = new Yallist()\n  }\n\n  self.tail = null\n  self.head = null\n  self.length = 0\n\n  if (list && typeof list.forEach === 'function') {\n    list.forEach(function (item) {\n      self.push(item)\n    })\n  } else if (arguments.length > 0) {\n    for (var i = 0, l = arguments.length; i < l; i++) {\n      self.push(arguments[i])\n    }\n  }\n\n  return self\n}\n\nYallist.prototype.removeNode = function (node) {\n  if (node.list !== this) {\n    throw new Error('removing node which does not belong to this list')\n  }\n\n  var next = node.next\n  var prev = node.prev\n\n  if (next) {\n    next.prev = prev\n  }\n\n  if (prev) {\n    prev.next = next\n  }\n\n  if (node === this.head) {\n    this.head = next\n  }\n  if (node === this.tail) {\n    this.tail = prev\n  }\n\n  node.list.length--\n  node.next = null\n  node.prev = null\n  node.list = null\n\n  return next\n}\n\nYallist.prototype.unshiftNode = function (node) {\n  if (node === this.head) {\n    return\n  }\n\n  if (node.list) {\n    node.list.removeNode(node)\n  }\n\n  var head = this.head\n  node.list = this\n  node.next = head\n  if (head) {\n    head.prev = node\n  }\n\n  this.head = node\n  if (!this.tail) {\n    this.tail = node\n  }\n  this.length++\n}\n\nYallist.prototype.pushNode = function (node) {\n  if (node === this.tail) {\n    return\n  }\n\n  if (node.list) {\n    node.list.removeNode(node)\n  }\n\n  var tail = this.tail\n  node.list = this\n  node.prev = tail\n  if (tail) {\n    tail.next = node\n  }\n\n  this.tail = node\n  if (!this.head) {\n    this.head = node\n  }\n  this.length++\n}\n\nYallist.prototype.push = function () {\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    push(this, arguments[i])\n  }\n  return this.length\n}\n\nYallist.prototype.unshift = function () {\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    unshift(this, arguments[i])\n  }\n  return this.length\n}\n\nYallist.prototype.pop = function () {\n  if (!this.tail) {\n    return undefined\n  }\n\n  var res = this.tail.value\n  this.tail = this.tail.prev\n  if (this.tail) {\n    this.tail.next = null\n  } else {\n    this.head = null\n  }\n  this.length--\n  return res\n}\n\nYallist.prototype.shift = function () {\n  if (!this.head) {\n    return undefined\n  }\n\n  var res = this.head.value\n  this.head = this.head.next\n  if (this.head) {\n    this.head.prev = null\n  } else {\n    this.tail = null\n  }\n  this.length--\n  return res\n}\n\nYallist.prototype.forEach = function (fn, thisp) {\n  thisp = thisp || this\n  for (var walker = this.head, i = 0; walker !== null; i++) {\n    fn.call(thisp, walker.value, i, this)\n    walker = walker.next\n  }\n}\n\nYallist.prototype.forEachReverse = function (fn, thisp) {\n  thisp = thisp || this\n  for (var walker = this.tail, i = this.length - 1; walker !== null; i--) {\n    fn.call(thisp, walker.value, i, this)\n    walker = walker.prev\n  }\n}\n\nYallist.prototype.get = function (n) {\n  for (var i = 0, walker = this.head; walker !== null && i < n; i++) {\n    // abort out of the list early if we hit a cycle\n    walker = walker.next\n  }\n  if (i === n && walker !== null) {\n    return walker.value\n  }\n}\n\nYallist.prototype.getReverse = function (n) {\n  for (var i = 0, walker = this.tail; walker !== null && i < n; i++) {\n    // abort out of the list early if we hit a cycle\n    walker = walker.prev\n  }\n  if (i === n && walker !== null) {\n    return walker.value\n  }\n}\n\nYallist.prototype.map = function (fn, thisp) {\n  thisp = thisp || this\n  var res = new Yallist()\n  for (var walker = this.head; walker !== null;) {\n    res.push(fn.call(thisp, walker.value, this))\n    walker = walker.next\n  }\n  return res\n}\n\nYallist.prototype.mapReverse = function (fn, thisp) {\n  thisp = thisp || this\n  var res = new Yallist()\n  for (var walker = this.tail; walker !== null;) {\n    res.push(fn.call(thisp, walker.value, this))\n    walker = walker.prev\n  }\n  return res\n}\n\nYallist.prototype.reduce = function (fn, initial) {\n  var acc\n  var walker = this.head\n  if (arguments.length > 1) {\n    acc = initial\n  } else if (this.head) {\n    walker = this.head.next\n    acc = this.head.value\n  } else {\n    throw new TypeError('Reduce of empty list with no initial value')\n  }\n\n  for (var i = 0; walker !== null; i++) {\n    acc = fn(acc, walker.value, i)\n    walker = walker.next\n  }\n\n  return acc\n}\n\nYallist.prototype.reduceReverse = function (fn, initial) {\n  var acc\n  var walker = this.tail\n  if (arguments.length > 1) {\n    acc = initial\n  } else if (this.tail) {\n    walker = this.tail.prev\n    acc = this.tail.value\n  } else {\n    throw new TypeError('Reduce of empty list with no initial value')\n  }\n\n  for (var i = this.length - 1; walker !== null; i--) {\n    acc = fn(acc, walker.value, i)\n    walker = walker.prev\n  }\n\n  return acc\n}\n\nYallist.prototype.toArray = function () {\n  var arr = new Array(this.length)\n  for (var i = 0, walker = this.head; walker !== null; i++) {\n    arr[i] = walker.value\n    walker = walker.next\n  }\n  return arr\n}\n\nYallist.prototype.toArrayReverse = function () {\n  var arr = new Array(this.length)\n  for (var i = 0, walker = this.tail; walker !== null; i++) {\n    arr[i] = walker.value\n    walker = walker.prev\n  }\n  return arr\n}\n\nYallist.prototype.slice = function (from, to) {\n  to = to || this.length\n  if (to < 0) {\n    to += this.length\n  }\n  from = from || 0\n  if (from < 0) {\n    from += this.length\n  }\n  var ret = new Yallist()\n  if (to < from || to < 0) {\n    return ret\n  }\n  if (from < 0) {\n    from = 0\n  }\n  if (to > this.length) {\n    to = this.length\n  }\n  for (var i = 0, walker = this.head; walker !== null && i < from; i++) {\n    walker = walker.next\n  }\n  for (; walker !== null && i < to; i++, walker = walker.next) {\n    ret.push(walker.value)\n  }\n  return ret\n}\n\nYallist.prototype.sliceReverse = function (from, to) {\n  to = to || this.length\n  if (to < 0) {\n    to += this.length\n  }\n  from = from || 0\n  if (from < 0) {\n    from += this.length\n  }\n  var ret = new Yallist()\n  if (to < from || to < 0) {\n    return ret\n  }\n  if (from < 0) {\n    from = 0\n  }\n  if (to > this.length) {\n    to = this.length\n  }\n  for (var i = this.length, walker = this.tail; walker !== null && i > to; i--) {\n    walker = walker.prev\n  }\n  for (; walker !== null && i > from; i--, walker = walker.prev) {\n    ret.push(walker.value)\n  }\n  return ret\n}\n\nYallist.prototype.splice = function (start, deleteCount, ...nodes) {\n  if (start > this.length) {\n    start = this.length - 1\n  }\n  if (start < 0) {\n    start = this.length + start;\n  }\n\n  for (var i = 0, walker = this.head; walker !== null && i < start; i++) {\n    walker = walker.next\n  }\n\n  var ret = []\n  for (var i = 0; walker && i < deleteCount; i++) {\n    ret.push(walker.value)\n    walker = this.removeNode(walker)\n  }\n  if (walker === null) {\n    walker = this.tail\n  }\n\n  if (walker !== this.head && walker !== this.tail) {\n    walker = walker.prev\n  }\n\n  for (var i = 0; i < nodes.length; i++) {\n    walker = insert(this, walker, nodes[i])\n  }\n  return ret;\n}\n\nYallist.prototype.reverse = function () {\n  var head = this.head\n  var tail = this.tail\n  for (var walker = head; walker !== null; walker = walker.prev) {\n    var p = walker.prev\n    walker.prev = walker.next\n    walker.next = p\n  }\n  this.head = tail\n  this.tail = head\n  return this\n}\n\nfunction insert (self, node, value) {\n  var inserted = node === self.head ?\n    new Node(value, null, node, self) :\n    new Node(value, node, node.next, self)\n\n  if (inserted.next === null) {\n    self.tail = inserted\n  }\n  if (inserted.prev === null) {\n    self.head = inserted\n  }\n\n  self.length++\n\n  return inserted\n}\n\nfunction push (self, item) {\n  self.tail = new Node(item, self.tail, null, self)\n  if (!self.head) {\n    self.head = self.tail\n  }\n  self.length++\n}\n\nfunction unshift (self, item) {\n  self.head = new Node(item, null, self.head, self)\n  if (!self.tail) {\n    self.tail = self.head\n  }\n  self.length++\n}\n\nfunction Node (value, prev, next, list) {\n  if (!(this instanceof Node)) {\n    return new Node(value, prev, next, list)\n  }\n\n  this.list = list\n  this.value = value\n\n  if (prev) {\n    prev.next = this\n    this.prev = prev\n  } else {\n    this.prev = null\n  }\n\n  if (next) {\n    next.prev = this\n    this.next = next\n  } else {\n    this.next = null\n  }\n}\n\ntry {\n  // add if support for Symbol.iterator is present\n  require('./iterator.js')(Yallist)\n} catch (er) {}\n", "'use strict'\n\n// A linked list to keep track of recently-used-ness\nconst Yallist = require('yallist')\n\nconst MAX = Symbol('max')\nconst LENGTH = Symbol('length')\nconst LENGTH_CALCULATOR = Symbol('lengthCalculator')\nconst ALLOW_STALE = Symbol('allowStale')\nconst MAX_AGE = Symbol('maxAge')\nconst DISPOSE = Symbol('dispose')\nconst NO_DISPOSE_ON_SET = Symbol('noDisposeOnSet')\nconst LRU_LIST = Symbol('lruList')\nconst CACHE = Symbol('cache')\nconst UPDATE_AGE_ON_GET = Symbol('updateAgeOnGet')\n\nconst naiveLength = () => 1\n\n// lruList is a yallist where the head is the youngest\n// item, and the tail is the oldest.  the list contains the Hit\n// objects as the entries.\n// Each Hit object has a reference to its Yallist.Node.  This\n// never changes.\n//\n// cache is a Map (or PseudoMap) that matches the keys to\n// the Yallist.Node object.\nclass LRUCache {\n  constructor (options) {\n    if (typeof options === 'number')\n      options = { max: options }\n\n    if (!options)\n      options = {}\n\n    if (options.max && (typeof options.max !== 'number' || options.max < 0))\n      throw new TypeError('max must be a non-negative number')\n    // Kind of weird to have a default max of Infinity, but oh well.\n    const max = this[MAX] = options.max || Infinity\n\n    const lc = options.length || naiveLength\n    this[LENGTH_CALCULATOR] = (typeof lc !== 'function') ? naiveLength : lc\n    this[ALLOW_STALE] = options.stale || false\n    if (options.maxAge && typeof options.maxAge !== 'number')\n      throw new TypeError('maxAge must be a number')\n    this[MAX_AGE] = options.maxAge || 0\n    this[DISPOSE] = options.dispose\n    this[NO_DISPOSE_ON_SET] = options.noDisposeOnSet || false\n    this[UPDATE_AGE_ON_GET] = options.updateAgeOnGet || false\n    this.reset()\n  }\n\n  // resize the cache when the max changes.\n  set max (mL) {\n    if (typeof mL !== 'number' || mL < 0)\n      throw new TypeError('max must be a non-negative number')\n\n    this[MAX] = mL || Infinity\n    trim(this)\n  }\n  get max () {\n    return this[MAX]\n  }\n\n  set allowStale (allowStale) {\n    this[ALLOW_STALE] = !!allowStale\n  }\n  get allowStale () {\n    return this[ALLOW_STALE]\n  }\n\n  set maxAge (mA) {\n    if (typeof mA !== 'number')\n      throw new TypeError('maxAge must be a non-negative number')\n\n    this[MAX_AGE] = mA\n    trim(this)\n  }\n  get maxAge () {\n    return this[MAX_AGE]\n  }\n\n  // resize the cache when the lengthCalculator changes.\n  set lengthCalculator (lC) {\n    if (typeof lC !== 'function')\n      lC = naiveLength\n\n    if (lC !== this[LENGTH_CALCULATOR]) {\n      this[LENGTH_CALCULATOR] = lC\n      this[LENGTH] = 0\n      this[LRU_LIST].forEach(hit => {\n        hit.length = this[LENGTH_CALCULATOR](hit.value, hit.key)\n        this[LENGTH] += hit.length\n      })\n    }\n    trim(this)\n  }\n  get lengthCalculator () { return this[LENGTH_CALCULATOR] }\n\n  get length () { return this[LENGTH] }\n  get itemCount () { return this[LRU_LIST].length }\n\n  rforEach (fn, thisp) {\n    thisp = thisp || this\n    for (let walker = this[LRU_LIST].tail; walker !== null;) {\n      const prev = walker.prev\n      forEachStep(this, fn, walker, thisp)\n      walker = prev\n    }\n  }\n\n  forEach (fn, thisp) {\n    thisp = thisp || this\n    for (let walker = this[LRU_LIST].head; walker !== null;) {\n      const next = walker.next\n      forEachStep(this, fn, walker, thisp)\n      walker = next\n    }\n  }\n\n  keys () {\n    return this[LRU_LIST].toArray().map(k => k.key)\n  }\n\n  values () {\n    return this[LRU_LIST].toArray().map(k => k.value)\n  }\n\n  reset () {\n    if (this[DISPOSE] &&\n        this[LRU_LIST] &&\n        this[LRU_LIST].length) {\n      this[LRU_LIST].forEach(hit => this[DISPOSE](hit.key, hit.value))\n    }\n\n    this[CACHE] = new Map() // hash of items by key\n    this[LRU_LIST] = new Yallist() // list of items in order of use recency\n    this[LENGTH] = 0 // length of items in the list\n  }\n\n  dump () {\n    return this[LRU_LIST].map(hit =>\n      isStale(this, hit) ? false : {\n        k: hit.key,\n        v: hit.value,\n        e: hit.now + (hit.maxAge || 0)\n      }).toArray().filter(h => h)\n  }\n\n  dumpLru () {\n    return this[LRU_LIST]\n  }\n\n  set (key, value, maxAge) {\n    maxAge = maxAge || this[MAX_AGE]\n\n    if (maxAge && typeof maxAge !== 'number')\n      throw new TypeError('maxAge must be a number')\n\n    const now = maxAge ? Date.now() : 0\n    const len = this[LENGTH_CALCULATOR](value, key)\n\n    if (this[CACHE].has(key)) {\n      if (len > this[MAX]) {\n        del(this, this[CACHE].get(key))\n        return false\n      }\n\n      const node = this[CACHE].get(key)\n      const item = node.value\n\n      // dispose of the old one before overwriting\n      // split out into 2 ifs for better coverage tracking\n      if (this[DISPOSE]) {\n        if (!this[NO_DISPOSE_ON_SET])\n          this[DISPOSE](key, item.value)\n      }\n\n      item.now = now\n      item.maxAge = maxAge\n      item.value = value\n      this[LENGTH] += len - item.length\n      item.length = len\n      this.get(key)\n      trim(this)\n      return true\n    }\n\n    const hit = new Entry(key, value, len, now, maxAge)\n\n    // oversized objects fall out of cache automatically.\n    if (hit.length > this[MAX]) {\n      if (this[DISPOSE])\n        this[DISPOSE](key, value)\n\n      return false\n    }\n\n    this[LENGTH] += hit.length\n    this[LRU_LIST].unshift(hit)\n    this[CACHE].set(key, this[LRU_LIST].head)\n    trim(this)\n    return true\n  }\n\n  has (key) {\n    if (!this[CACHE].has(key)) return false\n    const hit = this[CACHE].get(key).value\n    return !isStale(this, hit)\n  }\n\n  get (key) {\n    return get(this, key, true)\n  }\n\n  peek (key) {\n    return get(this, key, false)\n  }\n\n  pop () {\n    const node = this[LRU_LIST].tail\n    if (!node)\n      return null\n\n    del(this, node)\n    return node.value\n  }\n\n  del (key) {\n    del(this, this[CACHE].get(key))\n  }\n\n  load (arr) {\n    // reset the cache\n    this.reset()\n\n    const now = Date.now()\n    // A previous serialized cache has the most recent items first\n    for (let l = arr.length - 1; l >= 0; l--) {\n      const hit = arr[l]\n      const expiresAt = hit.e || 0\n      if (expiresAt === 0)\n        // the item was created without expiration in a non aged cache\n        this.set(hit.k, hit.v)\n      else {\n        const maxAge = expiresAt - now\n        // dont add already expired items\n        if (maxAge > 0) {\n          this.set(hit.k, hit.v, maxAge)\n        }\n      }\n    }\n  }\n\n  prune () {\n    this[CACHE].forEach((value, key) => get(this, key, false))\n  }\n}\n\nconst get = (self, key, doUse) => {\n  const node = self[CACHE].get(key)\n  if (node) {\n    const hit = node.value\n    if (isStale(self, hit)) {\n      del(self, node)\n      if (!self[ALLOW_STALE])\n        return undefined\n    } else {\n      if (doUse) {\n        if (self[UPDATE_AGE_ON_GET])\n          node.value.now = Date.now()\n        self[LRU_LIST].unshiftNode(node)\n      }\n    }\n    return hit.value\n  }\n}\n\nconst isStale = (self, hit) => {\n  if (!hit || (!hit.maxAge && !self[MAX_AGE]))\n    return false\n\n  const diff = Date.now() - hit.now\n  return hit.maxAge ? diff > hit.maxAge\n    : self[MAX_AGE] && (diff > self[MAX_AGE])\n}\n\nconst trim = self => {\n  if (self[LENGTH] > self[MAX]) {\n    for (let walker = self[LRU_LIST].tail;\n      self[LENGTH] > self[MAX] && walker !== null;) {\n      // We know that we're about to delete this one, and also\n      // what the next least recently used key will be, so just\n      // go ahead and set it now.\n      const prev = walker.prev\n      del(self, walker)\n      walker = prev\n    }\n  }\n}\n\nconst del = (self, node) => {\n  if (node) {\n    const hit = node.value\n    if (self[DISPOSE])\n      self[DISPOSE](hit.key, hit.value)\n\n    self[LENGTH] -= hit.length\n    self[CACHE].delete(hit.key)\n    self[LRU_LIST].removeNode(node)\n  }\n}\n\nclass Entry {\n  constructor (key, value, length, now, maxAge) {\n    this.key = key\n    this.value = value\n    this.length = length\n    this.now = now\n    this.maxAge = maxAge || 0\n  }\n}\n\nconst forEachStep = (self, fn, node, thisp) => {\n  let hit = node.value\n  if (isStale(self, hit)) {\n    del(self, node)\n    if (!self[ALLOW_STALE])\n      hit = undefined\n  }\n  if (hit)\n    fn.call(thisp, hit.value, hit.key, self)\n}\n\nmodule.exports = LRUCache\n", "/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match `RegExp` flags from their coerced string values. */\nvar reFlags = /\\w*$/;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/** Used to identify `toStringTag` values supported by `_.clone`. */\nvar cloneableTags = {};\ncloneableTags[argsTag] = cloneableTags[arrayTag] =\ncloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =\ncloneableTags[boolTag] = cloneableTags[dateTag] =\ncloneableTags[float32Tag] = cloneableTags[float64Tag] =\ncloneableTags[int8Tag] = cloneableTags[int16Tag] =\ncloneableTags[int32Tag] = cloneableTags[mapTag] =\ncloneableTags[numberTag] = cloneableTags[objectTag] =\ncloneableTags[regexpTag] = cloneableTags[setTag] =\ncloneableTags[stringTag] = cloneableTags[symbolTag] =\ncloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =\ncloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;\ncloneableTags[errorTag] = cloneableTags[funcTag] =\ncloneableTags[weakMapTag] = false;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/**\n * Adds the key-value `pair` to `map`.\n *\n * @private\n * @param {Object} map The map to modify.\n * @param {Array} pair The key-value pair to add.\n * @returns {Object} Returns `map`.\n */\nfunction addMapEntry(map, pair) {\n  // Don't return `map.set` because it's not chainable in IE 11.\n  map.set(pair[0], pair[1]);\n  return map;\n}\n\n/**\n * Adds `value` to `set`.\n *\n * @private\n * @param {Object} set The set to modify.\n * @param {*} value The value to add.\n * @returns {Object} Returns `set`.\n */\nfunction addSetEntry(set, value) {\n  // Don't return `set.add` because it's not chainable in IE 11.\n  set.add(value);\n  return set;\n}\n\n/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/**\n * A specialized version of `_.reduce` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @param {*} [accumulator] The initial value.\n * @param {boolean} [initAccum] Specify using the first element of `array` as\n *  the initial value.\n * @returns {*} Returns the accumulated value.\n */\nfunction arrayReduce(array, iteratee, accumulator, initAccum) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  if (initAccum && length) {\n    accumulator = array[++index];\n  }\n  while (++index < length) {\n    accumulator = iteratee(accumulator, array[index], index, array);\n  }\n  return accumulator;\n}\n\n/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    Symbol = root.Symbol,\n    Uint8Array = root.Uint8Array,\n    getPrototype = overArg(Object.getPrototypeOf, Object),\n    objectCreate = Object.create,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols,\n    nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,\n    nativeKeys = overArg(Object.keys, Object);\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView'),\n    Map = getNative(root, 'Map'),\n    Promise = getNative(root, 'Promise'),\n    Set = getNative(root, 'Set'),\n    WeakMap = getNative(root, 'WeakMap'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  this.__data__ = new ListCache(entries);\n}\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n}\n\n/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  return this.__data__['delete'](key);\n}\n\n/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\n/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var cache = this.__data__;\n  if (cache instanceof ListCache) {\n    var pairs = cache.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      return this;\n    }\n    cache = this.__data__ = new MapCache(pairs);\n  }\n  cache.set(key, value);\n  return this;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  // Safari 9 makes `arguments.length` enumerable in strict mode.\n  var result = (isArray(value) || isArguments(value))\n    ? baseTimes(value.length, String)\n    : [];\n\n  var length = result.length,\n      skipIndexes = !!length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (key == 'length' || isIndex(key, length)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    object[key] = value;\n  }\n}\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.assign` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssign(object, source) {\n  return object && copyObject(source, keys(source), object);\n}\n\n/**\n * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n * traversed objects.\n *\n * @private\n * @param {*} value The value to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @param {boolean} [isFull] Specify a clone including symbols.\n * @param {Function} [customizer] The function to customize cloning.\n * @param {string} [key] The key of `value`.\n * @param {Object} [object] The parent object of `value`.\n * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n * @returns {*} Returns the cloned value.\n */\nfunction baseClone(value, isDeep, isFull, customizer, key, object, stack) {\n  var result;\n  if (customizer) {\n    result = object ? customizer(value, key, object, stack) : customizer(value);\n  }\n  if (result !== undefined) {\n    return result;\n  }\n  if (!isObject(value)) {\n    return value;\n  }\n  var isArr = isArray(value);\n  if (isArr) {\n    result = initCloneArray(value);\n    if (!isDeep) {\n      return copyArray(value, result);\n    }\n  } else {\n    var tag = getTag(value),\n        isFunc = tag == funcTag || tag == genTag;\n\n    if (isBuffer(value)) {\n      return cloneBuffer(value, isDeep);\n    }\n    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {\n      if (isHostObject(value)) {\n        return object ? value : {};\n      }\n      result = initCloneObject(isFunc ? {} : value);\n      if (!isDeep) {\n        return copySymbols(value, baseAssign(result, value));\n      }\n    } else {\n      if (!cloneableTags[tag]) {\n        return object ? value : {};\n      }\n      result = initCloneByTag(value, tag, baseClone, isDeep);\n    }\n  }\n  // Check for circular references and return its corresponding clone.\n  stack || (stack = new Stack);\n  var stacked = stack.get(value);\n  if (stacked) {\n    return stacked;\n  }\n  stack.set(value, result);\n\n  if (!isArr) {\n    var props = isFull ? getAllKeys(value) : keys(value);\n  }\n  arrayEach(props || value, function(subValue, key) {\n    if (props) {\n      key = subValue;\n      subValue = value[key];\n    }\n    // Recursively populate clone (susceptible to call stack limits).\n    assignValue(result, key, baseClone(subValue, isDeep, isFull, customizer, key, value, stack));\n  });\n  return result;\n}\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} prototype The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nfunction baseCreate(proto) {\n  return isObject(proto) ? objectCreate(proto) : {};\n}\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\n/**\n * The base implementation of `getTag`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  return objectToString.call(value);\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Creates a clone of  `buffer`.\n *\n * @private\n * @param {Buffer} buffer The buffer to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Buffer} Returns the cloned buffer.\n */\nfunction cloneBuffer(buffer, isDeep) {\n  if (isDeep) {\n    return buffer.slice();\n  }\n  var result = new buffer.constructor(buffer.length);\n  buffer.copy(result);\n  return result;\n}\n\n/**\n * Creates a clone of `arrayBuffer`.\n *\n * @private\n * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n * @returns {ArrayBuffer} Returns the cloned array buffer.\n */\nfunction cloneArrayBuffer(arrayBuffer) {\n  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);\n  new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n  return result;\n}\n\n/**\n * Creates a clone of `dataView`.\n *\n * @private\n * @param {Object} dataView The data view to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned data view.\n */\nfunction cloneDataView(dataView, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;\n  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\n/**\n * Creates a clone of `map`.\n *\n * @private\n * @param {Object} map The map to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned map.\n */\nfunction cloneMap(map, isDeep, cloneFunc) {\n  var array = isDeep ? cloneFunc(mapToArray(map), true) : mapToArray(map);\n  return arrayReduce(array, addMapEntry, new map.constructor);\n}\n\n/**\n * Creates a clone of `regexp`.\n *\n * @private\n * @param {Object} regexp The regexp to clone.\n * @returns {Object} Returns the cloned regexp.\n */\nfunction cloneRegExp(regexp) {\n  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));\n  result.lastIndex = regexp.lastIndex;\n  return result;\n}\n\n/**\n * Creates a clone of `set`.\n *\n * @private\n * @param {Object} set The set to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned set.\n */\nfunction cloneSet(set, isDeep, cloneFunc) {\n  var array = isDeep ? cloneFunc(setToArray(set), true) : setToArray(set);\n  return arrayReduce(array, addSetEntry, new set.constructor);\n}\n\n/**\n * Creates a clone of the `symbol` object.\n *\n * @private\n * @param {Object} symbol The symbol object to clone.\n * @returns {Object} Returns the cloned symbol object.\n */\nfunction cloneSymbol(symbol) {\n  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};\n}\n\n/**\n * Creates a clone of `typedArray`.\n *\n * @private\n * @param {Object} typedArray The typed array to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned typed array.\n */\nfunction cloneTypedArray(typedArray, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;\n  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);\n}\n\n/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction copyArray(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    assignValue(object, key, newValue === undefined ? source[key] : newValue);\n  }\n  return object;\n}\n\n/**\n * Copies own symbol properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbols(source, object) {\n  return copyObject(source, getSymbols(source), object);\n}\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Creates an array of the own enumerable symbol properties of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = nativeGetSymbols ? overArg(nativeGetSymbols, Object) : stubArray;\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11,\n// for data views in Edge < 14, and promises in Node.js.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = objectToString.call(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : undefined;\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\n/**\n * Initializes an array clone.\n *\n * @private\n * @param {Array} array The array to clone.\n * @returns {Array} Returns the initialized clone.\n */\nfunction initCloneArray(array) {\n  var length = array.length,\n      result = array.constructor(length);\n\n  // Add properties assigned by `RegExp#exec`.\n  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {\n    result.index = array.index;\n    result.input = array.input;\n  }\n  return result;\n}\n\n/**\n * Initializes an object clone.\n *\n * @private\n * @param {Object} object The object to clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneObject(object) {\n  return (typeof object.constructor == 'function' && !isPrototype(object))\n    ? baseCreate(getPrototype(object))\n    : {};\n}\n\n/**\n * Initializes an object clone based on its `toStringTag`.\n *\n * **Note:** This function only supports cloning values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to clone.\n * @param {string} tag The `toStringTag` of the object to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneByTag(object, tag, cloneFunc, isDeep) {\n  var Ctor = object.constructor;\n  switch (tag) {\n    case arrayBufferTag:\n      return cloneArrayBuffer(object);\n\n    case boolTag:\n    case dateTag:\n      return new Ctor(+object);\n\n    case dataViewTag:\n      return cloneDataView(object, isDeep);\n\n    case float32Tag: case float64Tag:\n    case int8Tag: case int16Tag: case int32Tag:\n    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:\n      return cloneTypedArray(object, isDeep);\n\n    case mapTag:\n      return cloneMap(object, isDeep, cloneFunc);\n\n    case numberTag:\n    case stringTag:\n      return new Ctor(object);\n\n    case regexpTag:\n      return cloneRegExp(object);\n\n    case setTag:\n      return cloneSet(object, isDeep, cloneFunc);\n\n    case symbolTag:\n      return cloneSymbol(object);\n  }\n}\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * This method is like `_.clone` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 1.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @returns {*} Returns the deep cloned value.\n * @see _.clone\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var deep = _.cloneDeep(objects);\n * console.log(deep[0] === objects[0]);\n * // => false\n */\nfunction cloneDeep(value) {\n  return baseClone(value, true, true);\n}\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\n/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\n/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = cloneDeep;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"../constants\");\nconst lru_cache_1 = __importDefault(require(\"lru-cache\"));\nconst lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\nlet cache;\n/**\n * Must have the LAYER0_CACHE environment variable set.\n */\nfunction isCacheEnabled() {\n    return process.env.LAYER0_CACHE === 'true';\n}\nexports.isCacheEnabled = isCacheEnabled;\n/**\n * Gets the singleton instance of the development response cache\n */\nfunction getCache() {\n    if (!cache) {\n        cache = new lru_cache_1.default();\n    }\n    return cache;\n}\nexports.getCache = getCache;\n/**\n * Evicts all entries from the cache\n */\nfunction clearCache() {\n    getCache().reset();\n}\nexports.clearCache = clearCache;\n/**\n * Returns the cached response for the specified key\n * @param key The cache key\n */\nfunction getCachedResponse(key) {\n    return getCache().get(key.toString());\n}\nexports.getCachedResponse = getCachedResponse;\n/**\n * Writes the response to the cache if x-0-cache-control has a non-zero max-age value.\n */\nfunction maybeCacheResponse({ response, cacheKey, context }) {\n    var _a;\n    const method = (_a = cacheKey.method) === null || _a === void 0 ? void 0 : _a.toLowerCase();\n    if (method && !constants_1.CACHEABLE_METHODS.has(method) && context.cacheRouteMethod !== method) {\n        // POSTs should only be cached when the route explicitly defines the method criteria as POST\n        response.setHeader(constants_1.HTTP_HEADERS.x0CachingStatus, constants_1.CACHING_STATUS.method);\n        return false;\n    }\n    else if (cacheKey.body && Buffer.from(cacheKey.body, 'utf8').length > 8000) {\n        // here we ensure that we're counting bytes by reading the string as utf8, which is a single byte per character\n        // The 8000 character limit is the maximum size fastly can read from the request body\n        response.setHeader(constants_1.HTTP_HEADERS.x0CachingStatus, constants_1.CACHING_STATUS.bodyTooBig);\n        return false;\n    }\n    else if (response.statusCode && response.statusCode >= 400) {\n        // we don't cache statuses 400 and above\n        response.setHeader(constants_1.HTTP_HEADERS.x0CachingStatus, constants_1.CACHING_STATUS.code);\n        return false;\n    }\n    else if (response.getHeader(constants_1.HTTP_HEADERS.setCookie)) {\n        // we don't cache responses with set-cookie headers as they may contain personal data\n        response.setHeader(constants_1.HTTP_HEADERS.x0CachingStatus, constants_1.CACHING_STATUS.setCookie);\n        return false;\n    }\n    const cacheParams = getCacheParams(response);\n    if (cacheParams.private && !context.forcePrivateCaching) {\n        response.setHeader(constants_1.HTTP_HEADERS.x0CachingStatus, constants_1.CACHING_STATUS.private);\n        return false;\n    }\n    else if (cacheParams.maxAge) {\n        getCache().set(cacheKey.toString(), convertToCachedResponse(response), cacheParams.maxAge * 1000);\n        response.setHeader(constants_1.HTTP_HEADERS.x0CachingStatus, constants_1.CACHING_STATUS.ok);\n        return true;\n    }\n    else {\n        response.setHeader(constants_1.HTTP_HEADERS.x0CachingStatus, constants_1.CACHING_STATUS.noMaxAge);\n        return false;\n    }\n}\nexports.maybeCacheResponse = maybeCacheResponse;\n/**\n * We have to deep clone parts of the\n * @param response HTTP response that we are caching\n */\nfunction convertToCachedResponse(response) {\n    return {\n        statusCode: response.statusCode,\n        statusMessage: response.statusMessage,\n        headers: lodash_clonedeep_1.default(response.getHeaders()),\n        body: response.body,\n    };\n}\n/**\n * Gets the effective caching settings for the response\n * @param response The current response\n */\nfunction getCacheParams(response) {\n    const defaults = {\n        private: false,\n        maxAge: 0,\n    };\n    return {\n        ...defaults,\n        ...getCacheParamsFromHeader(response.getHeader(constants_1.HTTP_HEADERS.cacheControl)),\n        ...getCacheParamsFromHeader(response.getHeader(constants_1.HTTP_HEADERS.x0CacheControl)),\n    };\n}\n/**\n * Extracts private and max-age/s-maxage from a cache-control header\n * @param cacheControl\n */\nfunction getCacheParamsFromHeader(cacheControl) {\n    const result = {};\n    if (cacheControl) {\n        if (!Array.isArray(cacheControl)) {\n            cacheControl = [cacheControl];\n        }\n        const values = {};\n        for (let header of cacheControl) {\n            const pairs = header.split(/,\\s*/).map(v => v.split(/=/));\n            for (let [name, value] of pairs) {\n                if (name && value) {\n                    values[name.toLowerCase()] = value;\n                }\n                if (name.toLowerCase() === 'private') {\n                    // private has no value\n                    result.private = true;\n                }\n            }\n            result.maxAge = parseInt(values['s-maxage'] || values['max-age'] || '0');\n        }\n    }\n    return result;\n}\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"../constants\");\nconst crypto_1 = __importDefault(require(\"crypto\"));\n/**\n * An actual cache key derived from a request per the user's CustomCacheKey specification\n */\nclass CacheKey {\n    constructor(request, customKey) {\n        var _a;\n        this.cookies = {};\n        const { host } = request.headers;\n        this.body = request.body;\n        this.method = (_a = request.method) === null || _a === void 0 ? void 0 : _a.toLowerCase();\n        this.query = this.excludeLayer0QueryParams(request.query || {});\n        this.pathname = new URL(request.url, `http://${host}`).pathname;\n        this.headers = this.getDefaultHeaders(request.headers);\n        if (customKey) {\n            for (let action of customKey.getActions()) {\n                action(this, request);\n            }\n        }\n    }\n    static create(request, customKey) {\n        return new CacheKey(request, customKey);\n    }\n    /**\n     * We always ignore layer0_* query params when computing the cache key so that things like layer0_prefetch don't cache bust\n     * @param query\n     */\n    excludeLayer0QueryParams(query) {\n        const result = {};\n        for (let name in query) {\n            if (!name.startsWith('layer0_')) {\n                result[name] = query[name];\n            }\n        }\n        return result;\n    }\n    /**\n     * Returns an array of values in the object sorted by the key\n     * We sort query params so that different orderings will result in a hit\n     * @param source Any object of key/value pairs, e.g. query, headers, cookies, etc...\n     */\n    toSortedArray(source) {\n        return Object.keys(source)\n            .sort()\n            .map(key => [key, source[key]]);\n    }\n    /**\n     * Returns the values of the request headers that are by default included in the caching key\n     *\n     * Notes:\n     * - Cache hash calculation has a connascence of algorithm with VCL moov_hash subroutine so if you\n     * are modifying it in any way, you have to modify VCL code generator in the same way. When in doubt\n     * the VCL cache hash calculation takes precendence as it is designed to serve production traffic\n     * and has been battle tested to do so reliably.\n     * - VCL cache hash includes some request/service properties that do no apply in local development:\n     * * build number does not exist for local development\n     * * flush timestamps for gradual flushing do not apply locally\n     */\n    getDefaultHeaders(headers) {\n        return {\n            [constants_1.HTTP_HEADERS.host]: headers[constants_1.HTTP_HEADERS.host],\n            [constants_1.HTTP_HEADERS.acceptEncoding]: headers[constants_1.HTTP_HEADERS.acceptEncoding],\n            [constants_1.HTTP_HEADERS.x0Destination]: headers[constants_1.HTTP_HEADERS.x0Destination],\n            [constants_1.HTTP_HEADERS.x0Protocol]: headers[constants_1.HTTP_HEADERS.x0Protocol],\n        };\n    }\n    toString() {\n        return JSON.stringify({\n            pathname: this.pathname,\n            method: this.method,\n            query: this.toSortedArray(this.query),\n            body: hash(this.body),\n            headers: this.toSortedArray(this.headers),\n            cookies: this.toSortedArray(this.cookies),\n        });\n    }\n}\nexports.default = CacheKey;\n/**\n * Returns the sha256 hash of the provided string as hex\n * @param data The data to hash\n */\nfunction hash(data) {\n    if (!data)\n        return null;\n    const hash = crypto_1.default.createHash('sha256');\n    hash.update(data);\n    return hash.digest('hex');\n}\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst nonWebpackRequire_1 = __importDefault(require(\"./nonWebpackRequire\"));\nlet logo;\nlet label;\nlet info = 'info', warn = 'warn', error = 'error';\ntry {\n    // We don't bundle chalk in the user lambda because it is a large module that is not required\n    // during runtime. Thus if it cannot be required we default to plain ASCII logo definitions.\n    const chalk = nonWebpackRequire_1.default('chalk');\n    const c1 = chalk.hex('D355A7');\n    label = chalk.grey(`Layer0`);\n    logo = chalk.bold(`Layer${c1('0')}`);\n    info = chalk.cyan(info);\n    warn = chalk.yellow(warn);\n    error = chalk.red(error);\n}\ncatch (e) {\n    logo = label = 'Layer0';\n}\nexports.infoLogLabel = `${label} ${info} -`;\nexports.warnLogLabel = `${label} ${warn} -`;\nexports.errorLogLabel = `${label} ${error} -`;\nexports.default = logo;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst fs_1 = __importDefault(require(\"fs\"));\nconst path_1 = require(\"path\");\nconst bindParamsToPath_1 = __importDefault(require(\"../utils/bindParamsToPath\"));\nconst config_1 = __importDefault(require(\"../config\"));\nconst Backend_1 = __importDefault(require(\"./Backend\"));\nconst interpolateParams_1 = __importDefault(require(\"./interpolateParams\"));\nconst stream_1 = __importDefault(require(\"./stream\"));\nconst constants_1 = require(\"../constants\");\nconst environment_1 = require(\"../environment\");\nconst validateWriter_1 = require(\"./validateWriter\");\nconst Route_1 = __importDefault(require(\"./Route\"));\nconst decode_1 = __importDefault(require(\"../utils/decode\"));\nconst Cache_1 = require(\"../cache/Cache\");\nconst CacheKey_1 = __importDefault(require(\"../cache/CacheKey\"));\nconst timing_1 = require(\"../timing\");\nconst PathMatcher_1 = __importDefault(require(\"./PathMatcher\"));\nconst nonWebpackRequire_1 = __importDefault(require(\"../utils/nonWebpackRequire\"));\nconst logo_1 = require(\"../utils/logo\");\nconst BaseResponseWriter_1 = require(\"./BaseResponseWriter\");\nconst lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\nconst mergeQueryString_1 = __importDefault(require(\"./mergeQueryString\"));\nconst slash_1 = __importDefault(require(\"slash\"));\n/**\n * The API that is provided to route callbacks.\n */\nclass ResponseWriter extends BaseResponseWriter_1.BaseResponseWriter {\n    /**\n     * @param req The request\n     * @param res The response\n     * @param route The route\n     * @param defaultBackend The default backend for proxy when none is provided\n     */\n    constructor(req, res, route, context) {\n        super(req, res, route);\n        this.params = {}; // Merged/All params\n        this.streaming = false;\n        // request/response phases\n        this.preCacheRequestActions = [];\n        this.postCacheRequestActions = [];\n        this.preCacheResponseActions = [];\n        this.postCacheResponseActions = [];\n        /**\n         * Helper function to simplify calling interpolateParams()\n         */\n        this.interpolateParams = (value) => {\n            return interpolateParams_1.default(this.request, this.response, value);\n        };\n        /**\n         * Redirects the browser to a new location.\n         * Query params from the original request are added to the redirect URL\n         *\n         * **Examples**\n         *\n         * ```\n         *  new Router()\n         *    .get('/p/:productId', ({ redirect }) => {\n         *      return redirect('/products/:productId', { statusCode: 301 })\n         *    })\n         *\n         *  // Extract id from route and apply as query string\n         *  new Router()\n         *    .get('/p/:productId', ({ redirect }) => {\n         *      return redirect('/product', { query: { id: ':productId' }})\n         *    })\n         *\n         *  // Extract id from query string and apply to route\n         *  new Router()\n         *    .get({ path: '/p', query: { id: ':id' } }, ({ redirect }) => {\n         *      return redirect('/product/:id')\n         *    })\n         * ```\n         *\n         * @param to The URL to which the browser will be redirected.\n         * @param options\n         * @param options.statusCode The HTTP status to return.  Defaults to 301\n         * @param options.query Key-value object of query strings to be added to the redirect url\n         */\n        this.redirect = (to, options = {}) => {\n            const { to: toPath, statusCode, query } = this._readRedirectParams(to, options);\n            const redirectLocation = mergeQueryString_1.default(this.request.url, bindParamsToPath_1.default(\n            // We do interpolation here while running in browser since URL works differently in browser and server.\n            // This works without interpolating here and doing it later in patchResWriteHead when running on server but\n            // not in browser (e.g in fiddle). This is because browser is encoding the URL in some cases where server doesn't.\n            //\n            // Example:\n            // Server: new URL('https://www.example.com${url}', 'http://foo.com').toString() == 'https://www.example.com${url}/'\n            // Browser: new URL('https://www.example.com${url}', 'http://foo.com').toString() == 'https://www.example.com%24%7Burl%7D/'\n            environment_1.isBrowser()\n                ? this.interpolateParams(Route_1.default.pathWithQueryString(toPath, query))\n                : Route_1.default.pathWithQueryString(toPath, query), this.request.params));\n            this.setResponseHeader(constants_1.HTTP_HEADERS.location, redirectLocation);\n            this.send('', statusCode);\n        };\n        /**\n         * Relays the request to the specified backend.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path/with/:variable', ({ proxy }) => {\n         *      proxy('legacy', { path: '/some/other/path/with/:variable' })\n         *    })\n         * ```\n         *\n         * In this example, we relay the request to the \"legacy\" backend. In this case, `layer0.config.js` must\n         * contain a definition for the `legacy` backend.  For example:\n         *\n         * ```\n         *  // layer0.config.js\n         *\n         *  module.exports = {\n         *    backends: {\n         *      legacy: {\n         *        domainOrIp: 'legacy.domain.com',\n         *        hostHeader: 'domain.com'\n         *      }\n         *    }\n         *  }\n         * ```\n         *\n         * @param backend The name of one of the backends in your `layer0.config.js` file.\n         * @param options\n         * @returns A promise the resolves once the response has been fetched from the upstream site.\n         */\n        this.proxy = async (backend, options) => {\n            const backendConfig = config_1.default.get(`backends.${backend}`);\n            await this.proxyHost(backendConfig, options);\n        };\n        /**\n         * Calls the provided callback to send a response.\n         * @param cb Render callback function\n         * @deprecated\n         */\n        this.render = (cb) => {\n            console.warn(`${logo_1.warnLogLabel} Warning ResponseWriter#render is deprecated.`);\n            cb(this.request, this.proxy, this.request.params);\n        };\n        /**\n         * Renders a result in Layer0's serverless cloud using your application. Use this method\n         * to respond with an SSR or API result from your application.\n         * @param options Options for transforming the request sent to your app and the response received from it.\n         */\n        this.renderWithApp = (options) => this.proxy(constants_1.BACKENDS.js, options);\n        /**\n         * Streams the result from a backend.  Can only be used in development for things\n         * like hot-module reloading.\n         * @param backend The name of the backend to connect to\n         * @private\n         */\n        this.stream = (backend) => {\n            if (process.env.NODE_ENV === 'production') {\n                throw new Error('stream can only be used in development');\n            }\n            let backendConfig = normalizeBackendConfig(config_1.default.get(`backends.${backend}`));\n            this.response.setHeader(constants_1.HTTP_HEADERS.contentType, 'text/event-stream');\n            this.streaming = true;\n            stream_1.default(this.request, this.response, backendConfig, Function.prototype);\n            this.setCreateResponseAction(() => Promise.resolve()); // to prevent the router from continuing on to the next route\n        };\n        /**\n         * Proxies the response from a given host\n         * @private\n         * @param backendConfig The backend config\n         * @param options\n         */\n        this.proxyHost = async (backendConfig, { path, transformRequest, transformResponse, headers, removeEmptySearchParamValues, } = {}) => {\n            backendConfig = normalizeBackendConfig(backendConfig);\n            const backend = Backend_1.default.create(backendConfig);\n            let pathString;\n            if (typeof path === 'function') {\n                pathString = path();\n            }\n            else {\n                pathString = path;\n            }\n            pathString = pathString ? bindParamsToPath_1.default(pathString, this.request.params) : pathString;\n            await this.setCreateResponseAction(async () => {\n                try {\n                    if (transformRequest) {\n                        const transformRequestTime = new timing_1.InternalTiming(timing_1.InternalNames.transformRequest).start();\n                        try {\n                            await this.runImmediately(() => transformRequest(this.request));\n                        }\n                        finally {\n                            transformRequestTime.end();\n                        }\n                    }\n                    const fetchTime = new timing_1.InternalTiming(timing_1.InternalNames.proxying).start();\n                    try {\n                        await backend.fetch(this.request, this.response, {\n                            path: pathString || this.request.url,\n                            disableCheckCert: backendConfig.disableCheckCert,\n                            headers,\n                            removeEmptySearchParamValues,\n                        });\n                    }\n                    finally {\n                        fetchTime.end();\n                    }\n                    if (transformResponse) {\n                        const transformResponseTime = new timing_1.InternalTiming(timing_1.InternalNames.transformResponse).start();\n                        try {\n                            decode_1.default(this.response);\n                            await this.runImmediately(() => transformResponse(this.response, this.request));\n                        }\n                        finally {\n                            transformResponseTime.end();\n                        }\n                    }\n                }\n                catch (e) {\n                    if (e.type === 'BackendFetchError') {\n                        // will get here when there is a connection error with the backend\n                        console.error(`${logo_1.errorLogLabel} Could not connect to backend ${backendConfig.domainOrIp}:`, e.message);\n                        this.response.statusCode = 503;\n                    }\n                    else {\n                        console.error(`${logo_1.errorLogLabel} Error in ResponseWriter:`, e.message, e.stack);\n                        this.response.statusCode = 500;\n                    }\n                }\n            });\n        };\n        /**\n         * Rewrites the request path.\n         *\n         * Example:\n         *\n         * ```js\n         *  router.get('/products/:id', ({ updatePath }) => {\n         *    updatePath('/p/:id')\n         *  })\n         * ```\n         *\n         * @param destination a new route path, which can include params captured from the original path\n         */\n        this.updatePath = (destination) => {\n            const path = bindParamsToPath_1.default(destination, this.request.params);\n            // IncomingMessage defines path as only having a getter, so we need to redefine it, we can't just set path = destination, which would result in an error in development.\n            Object.defineProperty(this.request, 'path', {\n                get: () => path,\n            });\n        };\n        /**\n         * Updates the request's parameters based on a new path and route pattern. This is, in effect,\n         * an implementation of Next.js rewrites, put here instead of NextRoutes in anticipation of other frameworks\n         * implementing the same spec as many of them \"follow the leader\".\n         *\n         * **example**:\n         *\n         * ```js\n         * res.rewrite('/category/boys/:slug*', '/category/:slug*')\n         * // result: request.params will be { slug: ['category', 'boys'] }\n         * ```\n         * @private\n         * @param destination A destination path, which may contain path variables.\n         * @param pattern The path pattern for the destination route we're emulating\n         */\n        this.rewrite = (destination, pattern) => {\n            const path = bindParamsToPath_1.default(destination, this.request.params);\n            const newUrl = new URL(this.request.url, 'http://host');\n            newUrl.pathname = path;\n            this.request.url = newUrl.pathname + newUrl.search;\n            this.request.path = path;\n            this.request.params = new PathMatcher_1.default(pattern).match(path);\n        };\n        /**\n         * Responds with a static asset from the specified path.\n         *\n         * **Example**\n         *\n         * ```js\n         * serveStatic('path/to/asset/from/app/root')\n         * ```\n         *\n         * You can also use variables in the asset path.  For example, to return files under the `assets` directory\n         * when the url starts with `/static`:\n         *\n         * ```\n         *  new Router()\n         *    .get('/static/:path*', ({ serveStatic }) => {\n         *      serveStatic('assets/:path*')\n         *    })\n         * ```\n         *\n         * Notes:\n         * - if a folder contains an 'index.html', that page is also served when requesting the parent folder route.\n         *   Let's take the example of /posts/1 that will render /posts/1/index.html)\n         *   They are multiple components involved in this rewrite to make it work with S3 storage:\n         *   1. DeploymentBuilder creates and bundles an assets-aliases.json file, that indicates that\n         *     '/posts/1' should point to '/posts/1/index.html' asset file.\n         *   2. layer0-subaccount-infra/components/deploy-lambda/src/deploy.js re-uploads '/posts/1/index.html'\n         *     as '/posts/1' s3 key, which works because S3 is a key based storage and not a filesystem.\n         *     It's a bit of a hack and takes extra space, but allows root document rendering.\n         *   3. serveStatic(), both in ResponseWriter ad EdgeResponseWriter, remove any trailing slash on path\n         *     so that both '/posts/1/' and '/posts/1' match the '/posts/1' S3 file\n         *\n         * - We did not use S3 built-in Static Website feature for multiple reasons:\n         *   1. It is http only\n         *   2. /build-slug/public/posts/ renders /build-slug/public/posts/index.html correctly, but /build-slug/public/posts\n         *      without a trailing slash redirects to /build-slug/public/posts/.\n         *      While it's easy to rewrite the path and remove trailing slashes, we actually do, it's not easy\n         *      to add missing trailing slash as we don't know beforehand if the route is a directory or a file.\n         *      Having a redirect on every route is not acceptable either.\n         *      The Location header would also need to be rewritten to be relative to the actual website and\n         *      not the bucket prefix, but that's manageable.\n         *\n         * - ISG/ISR:\n         *   When handling a request for a static asset that is not in S3, the request follows this path:\n         *\n         *```\n         * Browser => Edge => S3 (requested asset, which results in a 404)\n         *            Edge => Buffer Proxy => S3 (options.loadingPage, if provided) => Response returned\n         *                                 => Edge => Buffer Proxy => Lambda => BehindEdgeResponseWriter => options.onNotFound => SSR (then this response is cached for the next request)\n         *```\n         *\n         *   Note that BehindEdgeResponseWriter is the key here. It overrides serveStatic and if options.onNotFound is provided, it will always be called.\n         *\n         * @param path The relative path to the asset from the app's root directory. You can reference path variables using `:variable`.\n         * @param options The different options to serving static assets including fallback to compute\n         * @returns A promise the resolves once the asset has been fetched from storage.\n         */\n        this.serveStatic = async (path, options = {}) => {\n            let filePath = path && bindParamsToPath_1.default(path, this.request.params);\n            const { permanent, exclude } = options;\n            // Remove trailing '/' so that both /path/ and /path are\n            // served by /path file.\n            filePath = filePath.replace(/\\/$/, '');\n            if (exclude === null || exclude === void 0 ? void 0 : exclude.some(excludedFile => filePath.indexOf(excludedFile) >= 0)) {\n                return this.send('404 - Not found', 404);\n            }\n            if (environment_1.isCloud()) {\n                const staticBackend = config_1.default.get(`backends.${permanent ? constants_1.BACKENDS.permanentStatic : constants_1.BACKENDS.static}`);\n                // AWS\n                // Static assets are stored in s3 in production, so we just need to proxy\n                // s3 for all of the correct headers to be sent and the correct file to be served.\n                await this.proxyHost(staticBackend, {\n                    path: slash_1.default(filePath),\n                    transformResponse: async (res) => {\n                        // S3 returns 403 on actual 404. We do the same thing in our local static file server.\n                        if (res.statusCode === 403) {\n                            if (options.loadingPage) {\n                                await this.proxyHost(config_1.default.get(`backends.${constants_1.BACKENDS.static}`), {\n                                    path: bindParamsToPath_1.default(options.loadingPage, this.request.params),\n                                });\n                            }\n                            else if (options.onNotFound) {\n                                await options.onNotFound(this);\n                            }\n                            else {\n                                // We translate the S3 403 into a 404. The edge does the same thing.\n                                res.statusCode = 404;\n                                res.statusMessage = 'Not Found';\n                            }\n                        }\n                        // Set the optional status code and message to the static response.\n                        if (options.statusCode) {\n                            res.statusCode = options.statusCode;\n                        }\n                        if (options.statusMessage) {\n                            res.statusMessage = options.statusMessage;\n                        }\n                    },\n                });\n            }\n            else {\n                // local development\n                if (!fs_1.default.existsSync(filePath)) {\n                    return this.send('404 - Not found', 404);\n                }\n                // Try serving root document \"($path)/index.html\" for paths matching\n                // a directory.\n                // We achieve the same result on S3 via assets-aliases.json.\n                if (fs_1.default.lstatSync(filePath).isDirectory()) {\n                    filePath = path_1.join(filePath, './index.html');\n                }\n                const stat = fs_1.default.statSync(filePath);\n                // not needed in production, so we leave it out to keep the bundle small\n                const mime = nonWebpackRequire_1.default('mime-types');\n                const chardet = nonWebpackRequire_1.default('chardet');\n                let contentType = mime.lookup(filePath);\n                // connascence with xdn-subaccount-infra - s3Bucket.js\n                if (contentType) {\n                    try {\n                        const encodingAnalysisResult = chardet.analyse(fs_1.default.readFileSync(filePath));\n                        if (encodingAnalysisResult.length > 0) {\n                            // chardet analyse returns array of possible encodings starting with most confident result\n                            const { name: encoding, confidence } = encodingAnalysisResult[0];\n                            if (encoding && confidence > 90) {\n                                contentType += `; charset=${encoding}`;\n                            }\n                        }\n                    }\n                    catch (e) {\n                        // will get here if a charset fails to be detected\n                    }\n                }\n                else {\n                    contentType = 'application/octet-stream';\n                }\n                // Using setUpstreamResponseHeader gives developers the opportunity to override this,\n                // just like they would in production, where the content-type header comes from S3 based\n                // on the metadata that is associated with the file at the time of upload.\n                this.setUpstreamResponseHeader(constants_1.HTTP_HEADERS.contentType, contentType);\n                // We don't allow developers to manipulate content-length header through the router\n                // (it's prohibited on the edge as it could lead to broken responses)\n                // In this case we know we are not running in the cloud so our code is free to do so.\n                this.internalSetResponseHeader(constants_1.HTTP_HEADERS.contentLength, stat.size.toString(), false, this.postCacheResponseActions);\n                if (options.statusCode) {\n                    this.response.statusCode = options.statusCode;\n                    this.response.statusMessage = options.statusMessage;\n                }\n                await this.setCreateResponseAction(() => {\n                    return new Promise((resolve, reject) => {\n                        fs_1.default.readFile(filePath, (err, data) => {\n                            /* istanbul ignore if */\n                            if (err) {\n                                reject(err);\n                            }\n                            else {\n                                this.response.body = data;\n                                resolve();\n                            }\n                        });\n                    });\n                });\n            }\n        };\n        /**\n         * Sets the caching behavior for both browser and edge.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/p/:productId', ({ cache, proxy }) => {\n         *      cache({\n         *        browser: {\n         *          maxAgeSeconds: 0,\n         *          serviceWorkerSeconds: 60 * 60, // 1 hour\n         *        },\n         *        edge: {\n         *          maxAgeSeconds: 60 * 60 * 24, // 24 hours\n         *          staleWhileRevalidateSeconds: 60 * 60 // 1 hour\n         *        }\n         *      })\n         *      proxy('origin')\n         *    })\n         * ```\n         *\n         * The `cache()` method can be called in the same route where the response is sent, or any prior route.  For example,\n         * with Next.js, it is common to use the next plugin to automatically inherit page routes based on Next.js conventions,\n         * and use Layer0 router simply to add caching:\n         *\n         * ```\n         *  import { Router } = from '@layer0/core/router'\n         *  import { createNextPlugin } from '@layer0/next'\n         *\n         *  const { nextMiddleware, renderNext } = createNextPlugin()\n         *\n         *  new Router()\n         *    .get('/p/:productId', ({ cache, proxy }) => {\n         *      cache({\n         *        browser: {\n         *          maxAgeSeconds: 0,\n         *          serviceWorkerSeconds: 60 * 60, // 1 hour\n         *        },\n         *        edge: {\n         *          maxAgeSeconds: 60 * 60 * 24, // 24 hours\n         *          staleWhileRevalidateSeconds: 60 * 60 // 1 hour\n         *        }\n         *      })\n         *      proxy('origin')\n         *    })\n         *    .use(nextMiddleware)\n         * ```\n         */\n        this.cache = (options) => {\n            const { browser, edge, key } = options;\n            if (edge) {\n                const { maxAgeSeconds, staleWhileRevalidateSeconds, forcePrivateCaching } = edge;\n                const value = [];\n                // Flip force-private-caching only if it is explicitly set.\n                if (typeof forcePrivateCaching !== 'undefined') {\n                    this.context.forcePrivateCaching = forcePrivateCaching === true;\n                }\n                this.cacheKey = key;\n                if (typeof this.route.criteria.method === 'string') {\n                    this.context.cacheRouteMethod = this.route.criteria.method;\n                }\n                if (maxAgeSeconds) {\n                    value.push('max-age=' + maxAgeSeconds);\n                    if (staleWhileRevalidateSeconds) {\n                        value.push('stale-while-revalidate=' + staleWhileRevalidateSeconds);\n                    }\n                }\n                if (value.length) {\n                    this.internalSetResponseHeader(constants_1.HTTP_HEADERS.x0CacheControl, value.join(', '), false, this.preCacheResponseActions);\n                }\n            }\n            if (browser || browser === false) {\n                const { maxAgeSeconds, serviceWorkerSeconds } = browser || { maxAgeSeconds: 0 };\n                if (serviceWorkerSeconds && maxAgeSeconds && maxAgeSeconds > 0) {\n                    console.error(`${logo_1.errorLogLabel} Within the caching configuration of your \"${this.route.criteria.path}\" route, when service worker caching is set, the browser max age must be set to zero. Refer to https://docs.layer0.co/guides/caching#section_caching_a_response`);\n                    throw new Error('When service worker caching is set, the browser max age must be set to zero. Refer to https://docs.layer0.co/guides/caching#section_caching_a_response');\n                }\n                if (maxAgeSeconds === 0) {\n                    this.setResponseHeader(constants_1.HTTP_HEADERS.cacheControl, 'private, no-store, no-cache');\n                }\n                else if (maxAgeSeconds) {\n                    // Here we use \"private\" instead of \"public\" to prevent downstream CDNs from caching the asset\n                    // Since we already have an explicit way to cache at edge, we choose to keep browser and edge\n                    // caching totally separate.\n                    this.setResponseHeader(constants_1.HTTP_HEADERS.cacheControl, `private, max-age=${maxAgeSeconds}`);\n                }\n                if (serviceWorkerSeconds) {\n                    this.setResponseHeader(constants_1.HTTP_HEADERS.xSwCacheControl, `max-age=${serviceWorkerSeconds}`);\n                }\n            }\n        };\n        /**\n         * Adds or replaces a response header immediately before delivering the response downstream.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ setResponseHeader, proxy }) => {\n         *      proxy('origin')\n         *      setResponseHeader('some-header', 'some-value')\n         *    })\n         * ```\n         *\n         * @param name The case-insensitive name of the response header\n         * @param value The value to set\n         */\n        this.setResponseHeader = (name, value) => {\n            this.internalSetResponseHeader(name, value, true, this.postCacheResponseActions);\n        };\n        this.internalSetResponseHeader = (name, value, validate, phase) => {\n            if (validate) {\n                validateWriter_1.validateSetResponseHeader(name);\n            }\n            this.scheduleExecution(phase, () => {\n                const interpolatedValue = this.interpolateParams(value);\n                this.response.setHeader(name, interpolatedValue);\n            });\n        };\n        /**\n         * Alters a response header immediately before delivering the response downstream.\n         * Use this method to derive the new header value from the existing one.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ updateResponseHeader, proxy }) => {\n         *      proxy('origin')\n         *      updateResponseHeader('some-header', /some-.*-part/gi, 'some-replacement')\n         *    })\n         * ```\n         *\n         * @param name The case-insensitive name of the response header\n         * @param match Regex to find the part that should be replaced.\n         * @param replace Value that will replace the matched part.\n         */\n        this.updateResponseHeader = (name, match, replace) => {\n            this.internalUpdateResponseHeader(name, match, replace, this.preCacheResponseActions);\n        };\n        this.internalUpdateResponseHeader = (name, match, replace, phase) => {\n            validateWriter_1.validateUpdateResponseHeader(name);\n            this.scheduleExecution(phase, () => {\n                const currentValue = this.response.getHeader(name);\n                const interpolatedReplace = this.interpolateParams(replace);\n                if (currentValue) {\n                    this.response.setHeader(name, currentValue.replace(match, interpolatedReplace));\n                }\n            });\n        };\n        /**\n         * Removes a response header immediately before delivering the response downstream.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ removeResponseHeader, proxy }) => {\n         *      proxy('origin')\n         *      removeResponseHeader('some-header')\n         *    })\n         * ```\n         * @param name The case-insensitive name of the response header\n         */\n        this.removeResponseHeader = (name) => {\n            this.internalRemoveResponseHeader(name, this.postCacheResponseActions);\n        };\n        this.internalRemoveResponseHeader = (name, phase) => {\n            validateWriter_1.validateRemoveResponseHeader(name);\n            this.scheduleExecution(phase, () => {\n                this.response.removeHeader(name);\n            });\n        };\n        /**\n         * Returns an array of values associated with all `set-cookie` headers.\n         */\n        this.getSetCookieValues = () => {\n            const headers = this.response.getHeader(constants_1.HTTP_HEADERS.setCookie);\n            if (typeof headers === 'string') {\n                return [headers];\n            }\n            return headers || [];\n        };\n        /**\n         * Returns action function for the \"add response cookie\" operation.\n         */\n        this.getAddResponseCookieAction = (name, value, options = {}) => {\n            return () => {\n                const setCookies = this.getSetCookieValues();\n                const interpolatedValue = this.interpolateParams(value);\n                let cookie = `${name}=${interpolatedValue}`;\n                let key;\n                for (key in options) {\n                    const opt = options[key];\n                    if (typeof opt === 'boolean' && opt) {\n                        cookie += `; ${key}`;\n                    }\n                    else {\n                        cookie += `; ${key}=${opt}`;\n                    }\n                }\n                this.response.setHeader(constants_1.HTTP_HEADERS.setCookie, [...setCookies, cookie]);\n            };\n        };\n        /**\n         * Adds a `set-cookie` header to the response before attempting to cache the response.\n         * This does not replace any cookies with the same name - for that you should use `updateUpstreamResponseCookie`.\n         * Furthermore, Layer0 does not cache responses with `set-cookie` so if you wish to add a cookie\n         * *after* the response is cached, you should use `addResponseCookie`.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ addUpstreamResponseCookie, proxy }) => {\n         *      proxy('origin')\n         *      addUpstreamResponseCookie('my-cookie', 'my-cookie-value', { domain: 'test.com' })\n         *    })\n         * ```\n         *\n         * @param name Name of the cookie to add.\n         * @param value Value to set\n         * @param options Optional options to add to cookie\n         */\n        this.addUpstreamResponseCookie = (name, value, options) => {\n            validateWriter_1.validateCookieName(name);\n            this.scheduleExecution(this.preCacheResponseActions, this.getAddResponseCookieAction(name, value, options));\n        };\n        /**\n         * Adds a `set-cookie` header to the response.\n         * This does not replace any cookies with the same name - for that you should use `updateResponseCookie`.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ addResponseCookie, proxy }) => {\n         *      proxy('origin')\n         *      addResponseCookie('my-cookie', 'my-cookie-value', { domain: 'test.com' })\n         *    })\n         * ```\n         *\n         * @param name Name of the cookie to add.\n         * @param value Value to set\n         * @param options Optional options to add to cookie\n         */\n        this.addResponseCookie = (name, value, options) => {\n            validateWriter_1.validateCookieName(name);\n            this.scheduleExecution(this.postCacheResponseActions, this.getAddResponseCookieAction(name, value, options));\n        };\n        /**\n         * Returns action function for the \"update response cookie\" operation.\n         *\n         * Notes:\n         * - Cookie names are case sensitive so we use case sensitive comparison.\n         */\n        this.getUpdateResponseCookieAction = (name, match, replace) => {\n            return () => {\n                const setCookies = this.getSetCookieValues().map((cookie) => {\n                    let [cookieName, ...cookieValues] = cookie.split('=');\n                    if (cookieName !== name) {\n                        return cookie;\n                    }\n                    const cookieValue = cookieValues.join('=').replace(match, replace);\n                    return [cookieName, cookieValue].join('=');\n                });\n                this.response.setHeader(constants_1.HTTP_HEADERS.setCookie, setCookies);\n            };\n        };\n        /**\n         * Updates a `set-cookie` header in the response before attempting to cache the response.\n         * If there are multiple cookies with the same name, all of them will be updated.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ updateUpstreamResponseCookie, proxy }) => {\n         *      proxy('origin')\n         *      updateUpstreamResponseCookie('my-cookie', /Domain=.+;/, 'Domain=mydomain.com;')\n         *    })\n         * ```\n         *\n         * @param name Case-insensitive name of the cookie to update\n         * @param match Regex to find the part that should be replaced.\n         * @param replace Value that will replace the matched part.\n         */\n        this.updateUpstreamResponseCookie = (name, match, replace) => {\n            validateWriter_1.validateCookieName(name);\n            this.scheduleExecution(this.preCacheResponseActions, this.getUpdateResponseCookieAction(name, match, replace));\n        };\n        /**\n         * Updates a `set-cookie` header in the response. If there are multiple cookies\n         * with the same name, all of them will be updated.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ updateResponseCookie, proxy }) => {\n         *      proxy('origin')\n         *      updateResponseCookie('my-cookie', /Domain=.+;/, 'Domain=mydomain.com;')\n         *    })\n         * ```\n         *\n         * @param name Case-insensitive name of the cookie to update\n         * @param match Regex to find the part that should be replaced.\n         * @param replace Value that will replace the matched part.\n         */\n        this.updateResponseCookie = (name, match, replace) => {\n            validateWriter_1.validateCookieName(name);\n            this.scheduleExecution(this.postCacheResponseActions, this.getUpdateResponseCookieAction(name, match, replace));\n        };\n        /**\n         * Returns action function for the \"remove response cookie\" operation.\n         *\n         * Notes:\n         * - Cookie names are case sensitive so we use case sensitive comparison.\n         */\n        this.getRemoveResponseCookieAction = (name) => {\n            return () => {\n                const setCookies = this.getSetCookieValues().filter((cookie) => cookie.split('=')[0] !== name);\n                this.response.setHeader(constants_1.HTTP_HEADERS.setCookie, setCookies);\n            };\n        };\n        /**\n         * Removes a specific `set-cookie` header from the response before attempting to cache the response.\n         * If you wish to remove all such headers use `removeUpstreamHeader`.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ removeUpstreamResponseCookie, proxy }) => {\n         *      proxy('origin')\n         *      removeUpstreamResponseCookie('my-cookie')\n         *    })\n         * ```\n         * @param name The case-insensitive name of the cookie\n         */\n        this.removeUpstreamResponseCookie = (name) => {\n            validateWriter_1.validateCookieName(name);\n            this.scheduleExecution(this.preCacheResponseActions, this.getRemoveResponseCookieAction(name));\n        };\n        /**\n         * Removes a specific `set-cookie` header from the response.\n         * If you wish to remove all such headers use `removeHeader`.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ removeResponseCookie, proxy }) => {\n         *      proxy('origin')\n         *      removeResponseCookie('my-cookie')\n         *    })\n         * ```\n         * @param name The case-insensitive name of the cookie\n         */\n        this.removeResponseCookie = (name) => {\n            validateWriter_1.validateCookieName(name);\n            this.scheduleExecution(this.postCacheResponseActions, this.getRemoveResponseCookieAction(name));\n        };\n        /**\n         * Adds or replaces an upstream response header before attempting to cache the response.\n         * In local development, this is the same as calling `setResponseHeader` but on edge, it adds\n         * a header immediately after the upstream fetch has finished.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ setUpstreamResponseHeader, proxy }) => {\n         *      proxy('origin')\n         *      setUpstreamResponseHeader('x-0-surrogate-key', 'proxy=origin')\n         *    })\n         * ```\n         *\n         * @param name The case-insensitive name of the response header\n         * @param value The value to set\n         */\n        this.setUpstreamResponseHeader = (name, value) => {\n            const validate = name.toLowerCase() != constants_1.HTTP_HEADERS.x0SurrogateKey;\n            return this.internalSetResponseHeader(name, value, validate, this.preCacheResponseActions);\n        };\n        /**\n         * Alters an upstream response header before attempting to cache the response.\n         * Use this method to derive the new header value from the existing one.\n         * In local development this is same as calling `updateResponseHeader` but on\n         * edge it updates a header immediately after the upstream fetch has finished.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ updateUpstreamResponseHeader, proxy }) => {\n         *      proxy('origin')\n         *      updateUpstreamResponseHeader('cache-control', /public/gi, 'private')\n         *    })\n         * ```\n         *\n         * @param name The case-insensitive name of the response header\n         * @param match Regex to find the part that should be replaced.\n         * @param replace Value that will replace the matched part.\n         */\n        this.updateUpstreamResponseHeader = (name, match, replace) => {\n            return this.internalUpdateResponseHeader(name, match, replace, this.preCacheResponseActions);\n        };\n        /**\n         * Removes a response header before attempting to cache the response.\n         * In local development this is same as calling `updateUpstreamResponseHeader` but\n         * on edge it removes a header immediately after the upstream fetch has finished.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ removeUpstreamResponseHeader, proxy }) => {\n         *      proxy('origin')\n         *      removeUpstreamResponseHeader(HTTP_HEADERS.setCookie)\n         *    })\n         * ```\n         * @param name The case-insensitive name of the response header\n         */\n        this.removeUpstreamResponseHeader = (name) => {\n            return this.internalRemoveResponseHeader(name, this.preCacheResponseActions);\n        };\n        /**\n         * Adds or replaces a request header.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ setRequestHeader, proxy }) => {\n         *      setRequestHeader('some-header', 'some-value')\n         *      proxy('origin')\n         *    })\n         * ```\n         *\n         * @param name The case-insensitive name of the request header\n         * @param value The value to set\n         */\n        this.setRequestHeader = (name, value) => {\n            validateWriter_1.validateSetRequestHeader(name);\n            this.scheduleExecution(this.postCacheRequestActions, () => {\n                this.request.headers[name.toLowerCase()] = value;\n            });\n        };\n        /**\n         * Keeps count of the number of times we have started to execute any\n         * workload immediately. When the counter is at zero, we are not in\n         * the immediate execution mode.\n         */\n        this.runImmediatelyDepthCounter = 0;\n        /**\n         * Runs the given callback immediately, switching the response writer object\n         * into immediate execution mode.\n         *\n         * @param callback\n         */\n        this.runImmediately = async (callback) => {\n            try {\n                ++this.runImmediatelyDepthCounter;\n                await callback();\n            }\n            finally {\n                --this.runImmediatelyDepthCounter;\n            }\n        };\n        /**\n         * Either schedules the action for the later execution or, when running immediately,\n         * executes it right away.\n         *\n         * @param phase Array of Functions belonging to the specific execution phase (pre-cache request, post-cache request, etc)\n         * @param action Action to be executed either immediately or put into the execution array\n         */\n        this.scheduleExecution = (phase, action) => {\n            if (this.runningImmediately) {\n                action();\n            }\n            else {\n                phase.push(action);\n            }\n        };\n        /**\n         * Alters a request header. Use this method to derive the new header value from the existing one.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ updateRequestHeader, proxy }) => {\n         *      updateRequestHeader('some-header', /some-.*-part/gi, 'some-replacement')\n         *      proxy('origin')\n         *    })\n         * ```\n         *\n         * @param name The case-insensitive name of the request header\n         * @param match Regex to find the part that should be replaced.\n         * @param replace Value that will replace the matched part.\n         */\n        this.updateRequestHeader = (name, match, replace) => {\n            validateWriter_1.validateUpdateRequestHeader(name);\n            this.scheduleExecution(this.postCacheRequestActions, () => {\n                const key = name.toLowerCase();\n                const currentValue = this.request.headers[key];\n                const interpolatedReplace = this.interpolateParams(replace);\n                if (Array.isArray(currentValue)) {\n                    this.request.headers[key] = currentValue.map(v => v.replace(match, interpolatedReplace));\n                }\n                else if (currentValue) {\n                    this.request.headers[key] = currentValue.replace(match, interpolatedReplace);\n                }\n            });\n        };\n        /**\n         * Removes a request header.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', async ({ removeRequestHeader, proxy }) => {\n         *      removeRequestHeader('some-header')\n         *      proxy('origin')\n         *    })\n         * ```\n         * @param name The case-insensitive name of the request header\n         */\n        this.removeRequestHeader = (name) => {\n            validateWriter_1.validateRemoveRequestHeader(name);\n            this.scheduleExecution(this.postCacheRequestActions, () => {\n                delete this.request.headers[name.toLowerCase()];\n            });\n        };\n        /**\n         * Returns the service worker with proper edge and browser cache headers\n         * @param path The path to the service worker relative to the root directory of your app\n         *\n         * **Example**\n         *\n         * ```js\n         *  new Router()\n         *    .get('/service-worker.js', ({ serviceWorker }) => {\n         *      serviceWorker('dist/service-worker.js')\n         *    })\n         * ```\n         */\n        this.serviceWorker = (path) => {\n            this.cache({\n                edge: {\n                    maxAgeSeconds: 30758400,\n                },\n                browser: {\n                    // It is critical that the service worker is never cached in the browser or it may never update.\n                    // This can be catastrophic if a broken service worker is installed since it can prevent the site\n                    // from being accessed at all\n                    maxAgeSeconds: 0,\n                },\n            });\n            this.serveStatic(path);\n        };\n        /**\n         * Serves an HTML app shell from a static file.\n         * @param indexHtmlPath The path to the app shell html file\n         *\n         * **Example**\n         *\n         * ```js\n         *  new Router()\n         *    .fallback(({ appShell }) => {\n         *      appShell('dist/index.html')\n         *    })\n         * ```\n         */\n        this.appShell = (indexHtmlPath) => {\n            this.setResponseHeader(constants_1.HTTP_HEADERS.contentType, 'text/html');\n            this.serveStatic(indexHtmlPath);\n        };\n        /**\n         * Sends the necessary response headers to allow CORS\n         * @param config\n         *\n         * **Example**\n         *\n         * ```js\n         *  new Router()\n         *    .match('/api/:path*', ({ allowCors }) => {\n         *      allowCors({\n         *        origin: '*', // this is the default\n         *        methods: ['get', 'post'],\n         *        headers: ['x-some-header'],\n         *        maxAge: 60 * 60, // one hour\n         *        credentials: true\n         *      })\n         *    })\n         * ```\n         */\n        this.allowCors = (config = {}) => {\n            this.setResponseHeader('Access-Control-Allow-Origin', config.origin || '*');\n            if (config.methods) {\n                this.setResponseHeader('Access-Control-Allow-Methods', config.methods.join(', '));\n            }\n            if (config.headers) {\n                this.setResponseHeader('Access-Control-Allow-Headers', config.headers.join(', '));\n            }\n            if (config.maxAge) {\n                this.setResponseHeader('Access-Control-Max-Age', config.maxAge.toString());\n            }\n            if (config.credentials != null) {\n                this.setResponseHeader('Access-Control-Allow-Credentials', config.credentials.toString());\n            }\n        };\n        /**\n         * Sends content back to client. If content is a string, the respons will be sent\n         * directly from the edge. If it is a function, the request will be computed by a JavaScript worker.\n         *\n         * **Example**\n         *\n         * ```\n         *  new Router()\n         *    .get('/some/path', ({ send }) => {\n         *      return send('<html><body>Hello World!</body></html>', 200, 'OK')\n         *    })\n         * ```\n         * @param content The response body as a string\n         * @param statusCode The status to send\n         * @param statusMessage The status message to send\n         */\n        this.send = (content, statusCode = 200, statusMessage) => {\n            this.setCreateResponseAction(async () => {\n                this.response.statusCode = statusCode;\n                this.response.statusMessage = statusMessage;\n                if (typeof content === 'function') {\n                    this.response.body = content();\n                }\n                else {\n                    this.response.body = content;\n                }\n            });\n        };\n        /**\n         * Execute the provided callback function in the cloud. The callback is passed the request and the response.\n         *\n         * Use this method when you need to compute a response in the cloud rather than at the edge or at build time. A common example\n         * is when the response must be computed based on request parameters, headers, or cookies.\n         *\n         * A common example is to look up the destination for a redirect from an external API:\n         *\n         * ```js\n         *  new Router()\n         *    .get('/products/:id', ({ redirect, compute }) => {\n         *      compute(async (request, response) => {\n         *        const destination = await getDestinationFromAPI(request.params.id)\n         *        redirect(destination)\n         *      })\n         *    })\n         * ```\n         *\n         * This method can be combined with `cache` to compute responses in the cloud and cache them at edge:\n         *\n         * ```js\n         *  new Router()\n         *    .get('/products/:id', ({ cache, redirect, compute }) => {\n         *      cache({\n         *        edge: {\n         *          maxAgeSeconds: 60 * 60 * 24,\n         *          staleWhileRevalidateSeconds: 60 * 60,\n         *        }\n         *      })\n         *      compute(async (request, response) => {\n         *        const destination = await getDestinationFromAPI(request.params.id)\n         *        redirect(destination)\n         *      })\n         *    })\n         * ```\n         *\n         * Note: when calling `compute` in combination with `serveStatic`, the result of the `serveStatic` must be\n         * awaited in order to get the result from `serveStatic`, otherwise only reslut of the `compute` method\n         * will be returned.\n         *\n         * ```js\n         * new Router()\n         *   .get('/products/:id', ({ redirect, compute }) => {\n         *      compute(async (request, response) => {\n         *        const destination = await getDestinationFromAPI(request.params.id)\n         *        await serveStatic(destination)\n         *      })\n         *    })\n         * ```\n         *\n         * @param callback A function to run in the cloud to compute the response\n         */\n        this.compute = (callback) => {\n            this.setCreateResponseAction(async () => {\n                // We need to clear createResponseAction because the compute callback will likely send it's own response\n                // If we don't clear createResponseAction, setCreateResponseAction will throw a validation error which prevents multiple responses from being sent\n                await this.clearResponseAction().runImmediately(() => callback(this.request, this.response));\n            });\n        };\n        /**\n         * Send json error response to client\n         * @private\n         * @param err\n         */\n        this.onRouteError = (err) => {\n            let errorResponse = {\n                status: 'error',\n                message: err.message,\n            };\n            // Some errors are marked as user errors. We log those for higher visibility.\n            const isUserError = err.isUserError;\n            if (isUserError) {\n                console.error(`${logo_1.errorLogLabel} ${err.message}`);\n            }\n            if (process.env.NODE_ENV !== 'production') {\n                errorResponse = {\n                    message: `An error occured while running route ${this.route.toString()}: ${err.message}`,\n                    // We don't send the stack for user errors as they are raised from our code\n                    // but indicate issues in user's code.\n                    stack: !isUserError ? err.stack : undefined,\n                    url: this.request.url,\n                };\n            }\n            try {\n                this.response.setHeader(constants_1.HTTP_HEADERS.contentType, 'application/json');\n                this.response.writeHead(500);\n                this.response.end(JSON.stringify(errorResponse));\n            }\n            catch (e) {\n                console.error(`${logo_1.errorLogLabel} Could not write error response because headers have already been sent.`, errorResponse);\n            }\n        };\n        this.request = req;\n        this.response = res;\n        this.route = route;\n        this.context = context;\n    }\n    /**\n     * Called at the end of the request to send the response back to the browser. Methods like proxy,\n     * serveStatic, and render will replace this method with one that actually sends a response.\n     * @private\n     * @returns True if there send response was defined and invoked, otherwise false.\n     */\n    async sendResponse({ beforeResponse = () => true } = {}) {\n        let sendResponse = false;\n        for (let action of this.preCacheRequestActions) {\n            action();\n        }\n        let cachedResponse, cacheKey;\n        if (Cache_1.isCacheEnabled()) {\n            cacheKey = this.context.cacheKey || CacheKey_1.default.create(this.request, this.cacheKey);\n            cachedResponse = Cache_1.getCachedResponse(cacheKey);\n            if (this.cacheKey) {\n                // we put the custom cache key on the context so that it can be used by a later route which generates the response.  This is common, for example, with Next and Nuxt apps, which generate response via middleware.\n                this.context.cacheKey = cacheKey;\n            }\n            if (!this.validatePrefetch(cachedResponse)) {\n                console.log(`${logo_1.infoLogLabel} throttle ${this.request.url}`);\n                return true;\n            }\n        }\n        if (cachedResponse) {\n            sendResponse = true;\n            new timing_1.InternalTiming(timing_1.InternalNames.edgeCache).set(timing_1.CacheValue.hit);\n            this.applyCachedResponse(cachedResponse);\n        }\n        else {\n            for (let action of this.postCacheRequestActions) {\n                action();\n            }\n            if (this.createResponseAction) {\n                await this.createResponseAction();\n                sendResponse = true;\n            }\n            for (let action of this.preCacheResponseActions) {\n                action();\n            }\n            // This will evaluate the error routes based on the received status code.\n            // When this finds a match it will return that response was sent. That means\n            // That before response did take care of the response and issued a paged matching the error route.\n            const shouldContinue = await beforeResponse(this.response);\n            if (!shouldContinue) {\n                return sendResponse;\n            }\n        }\n        if (sendResponse && !this.streaming && !cachedResponse && Cache_1.isCacheEnabled()) {\n            const cached = Cache_1.maybeCacheResponse({\n                response: this.response,\n                // @ts-ignore - cacheKey can't actually be undefined here because it will be set if isCacheEnabled() is true\n                cacheKey,\n                context: this.context,\n            });\n            new timing_1.InternalTiming(timing_1.InternalNames.edgeCache).set(cached ? timing_1.CacheValue.cached : timing_1.CacheValue.pass);\n        }\n        for (let action of this.postCacheResponseActions) {\n            action();\n        }\n        if (sendResponse && !this.streaming) {\n            this.logCacheStatus();\n            timing_1.addTimings(this.response);\n            if (this.response.statusCode) {\n                this.response.writeHead(this.response.statusCode, this.response.statusMessage || undefined);\n            }\n            this.response.end(this.response.body);\n        }\n        return sendResponse;\n    }\n    /**\n     * Logs the cache status when running locally with caching is enabled\n     */\n    logCacheStatus() {\n        if (Cache_1.isCacheEnabled()) {\n            // for now we only add x-0-t when running with --cache because the only measurement we include is ecc=cached|pass|hit\n            const status = this.response.getHeader(constants_1.HTTP_HEADERS.x0CachingStatus);\n            const hitOrMiss = timing_1.getInternalTiming(timing_1.InternalNames.edgeCache);\n            const { url } = this.request;\n            console.log(`${logo_1.infoLogLabel} ${hitOrMiss} ${url}${status ? ` (${status})` : ''}`);\n        }\n    }\n    /**\n     * Copies the body, headers, and status from the cached response\n     * to the outgoing response.\n     * @param cachedResponse The cached response\n     */\n    applyCachedResponse(cachedResponse) {\n        this.response.statusCode = cachedResponse.statusCode;\n        this.response.statusMessage = cachedResponse.statusMessage;\n        this.response.body = lodash_clonedeep_1.default(cachedResponse.body);\n        for (let name of Object.keys(cachedResponse.headers)) {\n            // We have to cloneDeep because some headers are arrays rather than just strings.\n            this.response.setHeader(name, lodash_clonedeep_1.default(cachedResponse.headers[name]));\n        }\n    }\n    /**\n     * Rejects the request with status 412 and returns false if ?layer0_prefetch is present and\n     * no cached response was found.\n     */\n    validatePrefetch(cachedResponse) {\n        const isThrottled = Object.keys(this.request.query || {}).includes(constants_1.THROTTLED_QUERY_PARAM);\n        if (isThrottled && !cachedResponse) {\n            this.response.writeHead(constants_1.LAYER0_UNCACHED_PREFETCH_STATUS);\n            this.response.end();\n            return false;\n        }\n        else {\n            return true;\n        }\n    }\n    /**\n     * @param action\n     */\n    async setCreateResponseAction(action) {\n        if (this.runningImmediately) {\n            await action();\n        }\n        else {\n            if (this.createResponseAction != null) {\n                throw new Error('You may only call one of the following once in your route handler: proxy, serveStatic, serviceWorker, redirect, send.');\n            }\n            this.createResponseAction = action;\n        }\n    }\n    /**\n     * Returns true if the object is in the running immediately mode.\n     * When object is in the running immediately mode, all otherwise\n     * scheduled actions like header transform operations, are immediately\n     * executed.\n     * @private\n     */\n    get runningImmediately() {\n        return this.runImmediatelyDepthCounter > 0;\n    }\n    /**\n     * Clears response action. This is required for compute and error pages. Error pages must alter the initial response and execute the error routes separately.\n     *\n     * @private\n     * @returns\n     */\n    clearResponseAction() {\n        this.createResponseAction = undefined;\n        return this;\n    }\n}\nexports.default = ResponseWriter;\n/**\n * @private\n * @param backendConfig\n */\nfunction normalizeBackendConfig(backendConfig) {\n    if (typeof backendConfig === 'string')\n        backendConfig = { domainOrIp: backendConfig };\n    return backendConfig;\n}\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst os_1 = require(\"os\");\nconst constants_1 = require(\"../constants\");\nconst config_1 = __importDefault(require(\"../config\"));\n/**\n * Validates if provided backend exists in the config\n * @param backend\n */\nfunction validateBackends(backend) {\n    if (Object.values(constants_1.BACKENDS).includes(backend)) {\n        return;\n    }\n    if (config_1.default.get(`backends.${backend}`, false)) {\n        return;\n    }\n    const backends = Object.keys(config_1.default.get('backends'));\n    if (backends && backends.length) {\n        throw new Error(`To fix this problem use one of the \"backends\" configured in layer0.config.js:${os_1.EOL}${os_1.EOL}` +\n            ` - ${backends.join(`${os_1.EOL} - `)}${os_1.EOL}${os_1.EOL}` +\n            `or add \"${backend}\" to the \"backends\" property in layer0.config.js.`);\n    }\n    else {\n        throw new Error(`Add \"${backend}\" to the \"backends\" property in layer0.config.js.`);\n    }\n}\nexports.default = validateBackends;\n", "\"use strict\";\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst convertParamsToBackReferences_1 = __importStar(require(\"../utils/convertParamsToBackReferences\"));\nconst constants_1 = require(\"../constants\");\nconst get_1 = __importDefault(require(\"../utils/get\"));\nconst isEmpty_1 = __importDefault(require(\"../utils/isEmpty\"));\nconst ResponseWriter_1 = __importDefault(require(\"../router/ResponseWriter\"));\nconst Route_1 = __importDefault(require(\"../router/Route\"));\nconst validateBackends_1 = __importDefault(require(\"../utils/validateBackends\"));\nconst validateWriter_1 = require(\"../router/validateWriter\");\nconst universalRouteUtils_1 = require(\"../router/universalRouteUtils\");\nconst slash_1 = __importDefault(require(\"slash\"));\nconst FAR_FUTURE_TTL = 60 * 60 * 24 * 365 * 10;\n/**\n * A substitute implementation of `ResponseWriter` that creates the contents of `layer0.json`, which\n * is used to generate edge code.\n */\nclass EdgeResponseWriter extends ResponseWriter_1.default {\n    /**\n     * @param req The `HttpRequest` object\n     * @param res The `HttpResponse` object\n     * @param route The route being hit\n     * @param context The request context\n     */\n    constructor(_req, _res, route, context) {\n        super(_req, _res, route, context); // istanbul ignore next - this is a known issue with TypeScript\n        // Many of the methods such as updateRequestHeader assume transform.request\n        // and transform.response are initialized to empty arrays by the constructor.\n        this.stream = () => { };\n        this.setRequestHeader = (name, value) => {\n            validateWriter_1.validateSetRequestHeader(name);\n            this.edgeConfig.transform.request.push({\n                action: constants_1.ACTIONS.setHeader,\n                name,\n                value,\n            });\n        };\n        this.updateRequestHeader = (name, match, replace) => {\n            validateWriter_1.validateUpdateRequestHeader(name);\n            this.edgeConfig.transform.request.push({\n                action: constants_1.ACTIONS.updateHeader,\n                name,\n                valueRegex: match.source,\n                replaceValue: replace,\n            });\n        };\n        this.removeRequestHeader = (name) => {\n            validateWriter_1.validateRemoveRequestHeader(name);\n            this.edgeConfig.transform.request.push({\n                action: constants_1.ACTIONS.removeHeader,\n                name,\n            });\n        };\n        this.setResponseHeader = (name, value) => {\n            validateWriter_1.validateSetResponseHeader(name);\n            this.edgeConfig.transform.response.push({\n                action: constants_1.ACTIONS.setHeader,\n                name,\n                value,\n            });\n        };\n        this.updateResponseHeader = (name, match, replace) => {\n            validateWriter_1.validateUpdateResponseHeader(name);\n            this.edgeConfig.transform.response.push({\n                action: constants_1.ACTIONS.updateHeader,\n                name,\n                valueRegex: match.source,\n                replaceValue: replace,\n            });\n        };\n        this.removeResponseHeader = (name) => {\n            validateWriter_1.validateRemoveResponseHeader(name);\n            this.edgeConfig.transform.response.push({\n                action: constants_1.ACTIONS.removeHeader,\n                name,\n            });\n        };\n        /**\n         * Note:\n         * * We allow x-0-surrogate-key upstream response headers to be set by the edge logic,\n         * to equalizes what can be done in the serverless vs what can be done in the edge.\n         * * We do not extend this to other response headers because there are many that are\n         * set internally in VCL (e.g. x-0-version, x-0-shield-response, x-0-isg-loading-page-served,\n         * x-0-caching-status, and so on) which if affected would interfere with the correct\n         * functioning of the service.\n         */\n        this.setUpstreamResponseHeader = (name, value) => {\n            if (name.toLowerCase() != constants_1.HTTP_HEADERS.x0SurrogateKey) {\n                validateWriter_1.validateSetResponseHeader(name);\n            }\n            this.edgeConfig.transform.upstreamResponse.push({\n                action: constants_1.ACTIONS.setHeader,\n                name,\n                value,\n            });\n        };\n        this.updateUpstreamResponseHeader = (name, match, replace) => {\n            validateWriter_1.validateUpdateResponseHeader(name);\n            this.edgeConfig.transform.upstreamResponse.push({\n                action: constants_1.ACTIONS.updateHeader,\n                name,\n                valueRegex: match.source,\n                replaceValue: replace,\n            });\n        };\n        this.removeUpstreamResponseHeader = (name) => {\n            validateWriter_1.validateRemoveResponseHeader(name);\n            this.edgeConfig.transform.upstreamResponse.push({\n                action: constants_1.ACTIONS.removeHeader,\n                name,\n            });\n        };\n        this.addResponseCookie = (name, value) => {\n            this.edgeConfig.transform.response.push({\n                action: constants_1.ACTIONS.addCookie,\n                name,\n                value,\n            });\n        };\n        this.updateResponseCookie = (name, match, replace) => {\n            this.edgeConfig.transform.response.push({\n                action: constants_1.ACTIONS.updateCookie,\n                name,\n                valueRegex: match.source,\n                replaceValue: replace,\n            });\n        };\n        this.removeResponseCookie = (name) => {\n            this.edgeConfig.transform.response.push({\n                action: constants_1.ACTIONS.removeCookie,\n                name,\n            });\n        };\n        this.addUpstreamResponseCookie = (name, value) => {\n            this.edgeConfig.transform.upstreamResponse.push({\n                action: constants_1.ACTIONS.addCookie,\n                name,\n                value,\n            });\n        };\n        this.updateUpstreamResponseCookie = (name, match, replace) => {\n            this.edgeConfig.transform.upstreamResponse.push({\n                action: constants_1.ACTIONS.updateCookie,\n                name,\n                valueRegex: match.source,\n                replaceValue: replace,\n            });\n        };\n        this.removeUpstreamResponseCookie = (name) => {\n            this.edgeConfig.transform.upstreamResponse.push({\n                action: constants_1.ACTIONS.removeCookie,\n                name,\n            });\n        };\n        /**\n         * Sends a redirect from the edge\n         *\n         * In case of a complex redirect where the router needs to parse query string\n         * from the matched request, or inject query strings in the redirect, we delegate\n         * the response to Serverless compute and cache it for a very long time.\n         *\n         *\n         * @param to The destination URL\n         * @param statusCode The http response status.\n         */\n        this.redirect = (to, options = {}) => {\n            const { to: toPath, statusCode, query } = this._readRedirectParams(to, options);\n            const addQueryString = !isEmpty_1.default(query);\n            const writerParam = convertParamsToBackReferences_1.getBackReferences(Route_1.default.pathWithQueryString(toPath, query));\n            const parseQueryString = this.shouldParseQueryString(writerParam);\n            // Complex redirects manipulating query string are delegated to compute and cached \"for ever\".\n            // Cache key includes query string by default so every path / query string\n            // combination is cached independently, which is what we want as redirects\n            // location header includes original request's query string\n            if (parseQueryString || addQueryString) {\n                this.cache({\n                    edge: {\n                        maxAgeSeconds: FAR_FUTURE_TTL,\n                    },\n                });\n                this.proxy(constants_1.BACKENDS.js);\n                return;\n            }\n            this.setEdgeRoute({ action: constants_1.ACTIONS.syntheticRes, statusCode });\n            this.edgeConfig.transform.response.push({\n                action: constants_1.ACTIONS.setHeader,\n                name: constants_1.HTTP_HEADERS.location,\n                value: '${url}',\n            });\n            if (this.route.criteria.path) {\n                // This applies the 'to' argument, interpolate path params from the original request\n                // and appends original request's query strings (hence the added path-to-regexp matcher and added\n                // back reference)\n                const valueRegex = Route_1.default.toEdgeRegexString(this.route.criteria.path + '{(\\\\?[^#]+)}?');\n                const matchParams = convertParamsToBackReferences_1.getBackReferences(this.route.criteria.path);\n                const replaceValue = convertParamsToBackReferences_1.default(this.route.criteria.path, toPath) +\n                    `\\\\${Object.keys(matchParams).length + 1}`;\n                this.edgeConfig.transform.response.push({\n                    action: constants_1.ACTIONS.updateHeader,\n                    name: constants_1.HTTP_HEADERS.location,\n                    valueRegex,\n                    replaceValue,\n                });\n            }\n            else {\n                // This is a very special case where there is no path matcher, which is generally\n                // the case for fallback routes.\n                // We only extract the query string from the request path and\n                // apply them to the redirect 'to'.\n                this.edgeConfig.transform.response.push({\n                    action: constants_1.ACTIONS.updateHeader,\n                    name: constants_1.HTTP_HEADERS.location,\n                    valueRegex: Route_1.default.toEdgeRegexString('([^?]*){(\\\\?[^#]+)}?'),\n                    replaceValue: `${toPath}\\\\2`,\n                });\n            }\n        };\n        /**\n         * Serves static assets.\n         * @param path The request path\n         */\n        this.serveStatic = (path, { permanent, exclude, onNotFound, loadingPage, expiresSeconds, statusCode, statusMessage, disableAutoPublish, } = {}) => {\n            if (path && !path.startsWith('/'))\n                path = `/${path}`;\n            const fsPath = [];\n            let loadingPageTransform;\n            if (loadingPage) {\n                fsPath.push(loadingPage);\n                loadingPageTransform = {\n                    valueRegex: this.route.toEdgeRegexString(),\n                    replaceValue: convertParamsToBackReferences_1.default(this.route.criteria.path, loadingPage),\n                };\n            }\n            if (path) {\n                this.updatePath(slash_1.default(path));\n            }\n            if (typeof path === 'string') {\n                fsPath.push(path);\n            }\n            const isPermanent = permanent === true || get_1.default(permanent, 'enabled') || false;\n            this.setEdgeRoute({\n                action: constants_1.ACTIONS.proxy,\n                backend: isPermanent ? constants_1.BACKENDS.permanentStatic : constants_1.BACKENDS.static,\n                fsPath,\n                fsExclude: exclude,\n                fallbackToCompute: onNotFound != null,\n                loadingPage: loadingPageTransform,\n                expiresSeconds,\n                statusMessage,\n                statusCode,\n                disableAutoPublish,\n            });\n            return Promise.resolve();\n        };\n        this.verifyJwt = (options) => {\n            this.edgeConfig.jwtVerification = options;\n            return Promise.resolve();\n        };\n        /**\n         * Proxies from the edge\n         * @param backend\n         * @param config\n         * @param config.path\n         */\n        this.proxy = (backend, { path, transformResponse, transformRequest } = {}) => {\n            validateBackends_1.default(backend);\n            if (transformResponse != null || transformRequest != null || typeof path === 'function') {\n                backend = constants_1.BACKENDS.js;\n            }\n            else if (typeof path === 'string') {\n                // Only rewrite the request path if we're not going through compute, otherwise the router\n                // in compute would match the wrong route\n                this.updatePath(path);\n            }\n            this.setEdgeRoute({\n                action: constants_1.ACTIONS.proxy,\n                backend,\n            });\n            return Promise.resolve();\n        };\n        /**\n         * Rewrites the request path.\n         */\n        this.updatePath = (destination) => {\n            let replacePathValue = convertParamsToBackReferences_1.default(this.route.criteria.path, destination);\n            // Makes path definition more flexible, allowing path with no / prefix (ex: { path: ':path' })\n            if (replacePathValue[0] !== '/') {\n                replacePathValue = `/${replacePathValue}`;\n            }\n            this.edgeConfig.transform.request.push({\n                action: constants_1.ACTIONS.updatePath,\n                valueRegex: this.route.toEdgeRegexString(),\n                replaceValue: replacePathValue,\n            });\n        };\n        /**\n         * Creates the edge cache config\n         * @param config\n         */\n        this.cache = (config) => {\n            const { edge, browser, key } = config;\n            if (edge) {\n                const { maxAgeSeconds, staleWhileRevalidateSeconds, forcePrivateCaching } = edge;\n                this.edgeConfig.cache = {\n                    maxAgeSeconds,\n                    staleWhileRevalidateSeconds,\n                    forcePrivateCaching,\n                };\n            }\n            else if (edge === false) {\n                this.edgeConfig.cache = {\n                    disabled: true,\n                };\n            }\n            if (key) {\n                if (!this.edgeConfig.cache) {\n                    this.edgeConfig.cache = {};\n                }\n                this.edgeConfig.cache.customKey = key.toJSON();\n            }\n            if (browser || browser === false) {\n                const { maxAgeSeconds, serviceWorkerSeconds } = browser || { maxAgeSeconds: 0 };\n                if (serviceWorkerSeconds && maxAgeSeconds && maxAgeSeconds > 0) {\n                    throw new Error('When service worker caching is set, the browser max age must be set to zero. Refer to https://docs.layer0.co/guides/caching#section_caching_a_response');\n                }\n                if (maxAgeSeconds === 0) {\n                    this.edgeConfig.transform.response.push({\n                        action: constants_1.ACTIONS.setHeader,\n                        name: constants_1.HTTP_HEADERS.cacheControl,\n                        value: 'private, no-store, no-cache',\n                    });\n                }\n                else if (maxAgeSeconds) {\n                    // Here we use \"private\" instead of \"public\" to prevent downstream CDNs from caching the asset\n                    // Since we already have an explicit way to cache at edge, we choose to keep browser and edge\n                    // caching totally separate.\n                    this.edgeConfig.transform.response.push({\n                        action: constants_1.ACTIONS.setHeader,\n                        name: constants_1.HTTP_HEADERS.cacheControl,\n                        value: `private, max-age=${maxAgeSeconds}`,\n                    });\n                }\n                if (serviceWorkerSeconds) {\n                    this.edgeConfig.transform.response.push({\n                        action: constants_1.ACTIONS.setHeader,\n                        name: constants_1.HTTP_HEADERS.xSwCacheControl,\n                        value: `max-age=${serviceWorkerSeconds}`,\n                    });\n                }\n            }\n        };\n        /**\n         * Sends string content back to client. If content is a string, the response will be sent\n         * directly from the edge. If it is a function, the request will be computed by a JavaScript worker.\n         * StatusCode defaults to 200 on routes which is set by createEdgeConfig. On error routes we send the status code\n         * as null, since we need to preserve the status code of the failed request unless it is provided.\n         * @param content The content to send to the browser\n         * @param statusCode The HTTP status code.\n         * @param statusMessage The HTTP status message\n         */\n        this.send = (content, statusCode, statusMessage) => {\n            if (typeof content === 'function') {\n                this.render();\n            }\n            else {\n                this.setEdgeRoute({\n                    action: constants_1.ACTIONS.syntheticRes,\n                    statusCode,\n                    statusMessage,\n                    content,\n                });\n            }\n        };\n        /**\n         * Computed responses are always proxied to the serverless backend.\n         * @param callback\n         */\n        this.compute = (callback) => {\n            this.setEdgeRoute({\n                action: constants_1.ACTIONS.proxy,\n                backend: constants_1.BACKENDS.js,\n            });\n        };\n        /**\n         * Passes request and response to the specified callback, which should\n         * handle rendering the response as a string\n         */\n        this.render = () => {\n            this.setEdgeRoute({\n                action: constants_1.ACTIONS.proxy,\n                backend: constants_1.BACKENDS.js,\n            });\n            return Promise.resolve();\n        };\n        this.edgeConfig = {\n            transform: {\n                request: [],\n                upstreamResponse: [],\n                response: [],\n            },\n        };\n    }\n    shouldParseQueryString(writerParam) {\n        const query = this.route.criteria.query;\n        if (query === undefined) {\n            return false;\n        }\n        return Object.keys(query).some(key => {\n            const value = query[key];\n            return universalRouteUtils_1.isParamMatcher(value) && !!writerParam[key];\n        });\n    }\n    /**\n     * Sets the edge route and injects the x-0-route header value.\n     *\n     * Notes:\n     * - We need `x-0-route` header for statistics so we log it in the edge.\n     * We thus set it on the request, which allows us to log it, but in the edge\n     * code we unset this header before going upstream which avoids any leaking.\n     * - route.criteria.path can be null (fallback, or different match method)\n     * so we check that the path exists or injecting the request path as a fallback.\n     * - We don't allow upstream to dicate the `vary` header - developers can use\n     * our custom cache key mechanism which is a superset anyways. The only\n     * header we allow in the `vary` is `accept-encoding` which then shards\n     * the cache depending on the encoding that the user agent is accepting.\n     * In any case we already include `accept-encoding` in the default cache\n     * key so including it in `vary` is superfluous *except* that downstream\n     * caches might use it.\n     *\n     * @private\n     */\n    setEdgeRoute(route) {\n        this.edgeConfig.route = route;\n        this.edgeConfig.transform.upstreamResponse.push({\n            action: constants_1.ACTIONS.setHeader,\n            name: constants_1.HTTP_HEADERS.vary,\n            value: constants_1.HTTP_HEADERS.acceptEncoding,\n        });\n    }\n}\nexports.default = EdgeResponseWriter;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass RequestContext {\n    constructor() {\n        /**\n         * Set to true if ResponseWriter#cache is called with edge: { forcePrivateCaching: true }\n         */\n        this.forcePrivateCaching = false;\n    }\n}\nexports.default = RequestContext;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst EdgeResponseWriter_1 = __importDefault(require(\"./EdgeResponseWriter\"));\nclass EdgeErrorPageResponseWriter extends EdgeResponseWriter_1.default {\n    constructor() {\n        super(...arguments);\n        /**\n         * Disables proxy from the edge for error pages\n         *\n         * @param backend\n         * @param config\n         * @param config.path\n         */\n        this.proxy = (_backend, _opts = {}) => {\n            throw new Error('Proxy cannot be used inside router.catch()');\n        };\n    }\n}\nexports.default = EdgeErrorPageResponseWriter;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = __importDefault(require(\"../config\"));\nconst toEdgeRegex_1 = __importDefault(require(\"../utils/toEdgeRegex\"));\nconst toHttpMethodMatchRegex_1 = __importDefault(require(\"../utils/toHttpMethodMatchRegex\"));\nconst convertStringMatcherToRegex_1 = __importDefault(require(\"../utils/convertStringMatcherToRegex\"));\nconst EdgeResponseWriter_1 = __importDefault(require(\"./EdgeResponseWriter\"));\nconst constants_1 = require(\"../constants\");\nconst RequestContext_1 = __importDefault(require(\"../router/RequestContext\"));\nconst universalRouteUtils_1 = require(\"../router/universalRouteUtils\");\nconst EdgeErrorPageResponseWriter_1 = __importDefault(require(\"./EdgeErrorPageResponseWriter\"));\n/**\n * Returns cache object\n *\n * Notes:\n * - Method caching is only allowed when it's explicit:\n * 1. The matching was explicitly done on `post` and other methods and\n * 2. The caching properties were defined on the same route.\n *\n * @private\n */\nfunction buildRouteCacheKeysFromEdgeWriter({ edgeConfig }, matchExplicitMethod) {\n    var _a, _b;\n    // istanbul ignore next - edgeConfig.cache?.maxAgeSeconds is apparently untestable as it always shows as uncovered\n    if (edgeConfig.cache && ((_a = edgeConfig.cache) === null || _a === void 0 ? void 0 : _a.maxAgeSeconds) &&\n        ((_b = edgeConfig.cache) === null || _b === void 0 ? void 0 : _b.maxAgeSeconds) > 0 &&\n        matchExplicitMethod) {\n        return {\n            ...edgeConfig.cache,\n            matchExplicitMethod,\n        };\n    }\n    return edgeConfig.cache;\n}\n/**\n * Returns route action\n * @private\n */\nfunction buildRouteActionFromEdgeWriter({ edgeConfig }, isErrorRoute) {\n    var _a;\n    const route = edgeConfig.route;\n    // On error routes we don't use the default statusCode since we must preserve the status code\n    // of the error route.\n    if (((_a = edgeConfig.route) === null || _a === void 0 ? void 0 : _a.action) === constants_1.ACTIONS.syntheticRes &&\n        !edgeConfig.route.statusCode &&\n        !isErrorRoute) {\n        edgeConfig.route.statusCode = 200;\n    }\n    return route;\n}\n/**\n * Returns transformation object\n * @private\n */\nfunction buildTransformFromEdgeWriter({ edgeConfig }) {\n    return edgeConfig.transform;\n}\n/**\n * Returns the jwtVerification object (if any) validation is performed earlier\n * @private\n */\nfunction buildVerifyJwtFromEdgeWriter({ edgeConfig, }) {\n    return edgeConfig.jwtVerification;\n}\nfunction transformBodyCriteria(obj) {\n    return Object.entries(obj).reduce((memo, [key, value]) => {\n        if (value instanceof RegExp) {\n            memo[key] = convertStringMatcherToRegex_1.default(value);\n        }\n        else if (typeof value === 'object' && value !== null) {\n            memo[key] = transformBodyCriteria(value);\n        }\n        else {\n            memo[key] = convertStringMatcherToRegex_1.default(value);\n        }\n        return memo;\n    }, {});\n}\n/**\n * Build Outer Edge match configuration\n *\n * Notes:\n * - When resulting array is empty, it means that all requests should match\n * - If method matching is set to explicit method then set it in `matchExplicitMethod`\n * - All routes have implicit https protocol, so only if a criteria has explicitly been\n * set to http do we match for that protocol, otherwise we match https.\n *\n * @param route\n * @returns An array of match criteria\n * @private\n */\nfunction buildMatcherFromRoute(route) {\n    var _a;\n    const match = [];\n    const matchResp = [];\n    let matchProtocolJavaScriptRegExpSource;\n    let matchExplicitMethod;\n    if (route.criteria.protocol) {\n        let regex;\n        // Because HTTP is a subset of HTTPS we make sure that when strings are used we match\n        // the whole value rather than just a part of it.\n        if (typeof route.criteria.protocol === 'string') {\n            regex = new RegExp(`^${route.criteria.protocol}$`, 'i');\n        }\n        else {\n            regex = new RegExp(route.criteria.protocol);\n        }\n        if (!regex.test('http') && !regex.test('https')) {\n            throw new Error('Protocol matcher must match either \"http\" or \"https\"');\n        }\n        matchProtocolJavaScriptRegExpSource = regex.source;\n    }\n    if (route.criteria.path) {\n        match.push({\n            value: '${path}',\n            matchRegex: route.toEdgeRegexString(),\n        });\n    }\n    if (route.criteria.method) {\n        let matchRegex;\n        if (typeof route.criteria.method !== 'string') {\n            matchRegex = route.criteria.method;\n        }\n        else {\n            matchRegex = toHttpMethodMatchRegex_1.default(route.criteria.method);\n            if (Object.values(constants_1.HTTP_METHODS).includes(route.criteria.method)) {\n                matchExplicitMethod = route.criteria.method;\n            }\n        }\n        match.push({\n            value: '${method}',\n            matchRegex: toEdgeRegex_1.default(matchRegex),\n        });\n    }\n    if (route.criteria.headers) {\n        Object.entries(route.criteria.headers).forEach(([name, value]) => {\n            match.push({\n                value: `\\${req:${name}}`,\n                matchRegex: convertStringMatcherToRegex_1.default(value),\n            });\n        });\n    }\n    // Match is executed on deliver phase. This is required for error pages.\n    if ((_a = route.criteria.response) === null || _a === void 0 ? void 0 : _a.statusCode) {\n        matchResp.push({\n            value: `\\${res:status}`,\n            matchRegex: toEdgeRegex_1.default(route.criteria.response.statusCode),\n        });\n    }\n    if (route.criteria.query) {\n        Object.entries(route.criteria.query).forEach(([name, value]) => {\n            // Dynamic query matcher (ex: { query: { id: ':id' } }) don't need to be\n            // strictly matched against the route. They can be present or not.\n            if (universalRouteUtils_1.isParamMatcher(value))\n                return;\n            match.push({\n                value: `\\${query:${name}}`,\n                matchRegex: convertStringMatcherToRegex_1.default(value),\n            });\n        });\n    }\n    if (route.criteria.cookies) {\n        Object.entries(route.criteria.cookies).forEach(([name, value]) => {\n            match.push({\n                value: `\\${req:cookie:${name}}`,\n                matchRegex: convertStringMatcherToRegex_1.default(value),\n            });\n        });\n    }\n    if (route.criteria.body) {\n        match.push({\n            matchBody: JSON.stringify({\n                parse: route.criteria.body.parse,\n                criteria: transformBodyCriteria(route.criteria.body.criteria),\n            }),\n        });\n    }\n    return {\n        match,\n        matchResp,\n        matchExplicitMethod,\n        matchProtocolJavaScriptRegExpSource,\n    };\n}\n/**\n * Creates an outer edge manager config for the specified router by iterating through\n * each route and calling it with a mock request\n * and response.\n * @param router\n * @return An object containing the Edge config\n */\nasync function createEdgeConfig(router) {\n    let destinations = {};\n    if (!Object.keys(router.getDestinations()).length) {\n        destinations = {\n            default: await createDestination(router),\n        };\n    }\n    else {\n        for (let d in router.getDestinations()) {\n            destinations[d] = await createDestination(router.getDestinations()[d]);\n        }\n    }\n    return {\n        version: getLayer0Version(),\n        backends: {\n            ...config_1.default.get('backends'),\n        },\n        destinations,\n    };\n}\nexports.default = createEdgeConfig;\n/**\n * Gets the version of @layer0/core.  For this to work in testing an entry needed\n * to be added to moduleNameMapper in the jest config specifically for package.json\n * @return {String}\n */\nfunction getLayer0Version() {\n    // We purposefully don't override this version so that we can see in edge\n    // responses the *exact* version with which the edge was built.\n    return require('../package.json').version;\n}\nasync function createDestinationMapFunction(route, writer, faultyRoutes, isErrorRoute) {\n    try {\n        // @ts-ignore\n        await route.handler(writer);\n    }\n    catch (e) {\n        Error.captureStackTrace(e);\n        faultyRoutes.push({\n            route: route.toString(),\n            stackTrace: e.stack,\n        });\n    }\n    const { match, matchResp, matchExplicitMethod, matchProtocolJavaScriptRegExpSource, } = buildMatcherFromRoute(route);\n    return {\n        // used when building .layer0 to assemble the s3 directory structure\n        path: route.criteria.path,\n        // Consumed by Cache metrics to build the route string\n        routeJson: route.toJson(),\n        match,\n        matchResp,\n        matchProtocolJavaScriptRegExpSource,\n        cache: buildRouteCacheKeysFromEdgeWriter(writer, matchExplicitMethod),\n        route: buildRouteActionFromEdgeWriter(writer, isErrorRoute),\n        transform: buildTransformFromEdgeWriter(writer),\n        jwtVerification: buildVerifyJwtFromEdgeWriter(writer),\n    };\n}\nasync function createDestination(router) {\n    const faultyRoutes = [];\n    const destination = {\n        index: router.index,\n        errorRoutes: await Promise.all(router\n            .getRouteGroups()\n            .getRoutes()\n            .filter(route => route.isRespRoute())\n            .map(route => createDestinationMapFunction(route, new EdgeErrorPageResponseWriter_1.default({\n            url: '',\n            headers: {},\n        }, {}, route, new RequestContext_1.default()), faultyRoutes, true))),\n        routes: await Promise.all(router\n            .getRouteGroups()\n            .getRoutes()\n            .filter(route => !route.isRespRoute())\n            .map(route => createDestinationMapFunction(route, new EdgeResponseWriter_1.default({\n            url: '',\n            headers: {},\n        }, {}, route, new RequestContext_1.default()), faultyRoutes, false))),\n    };\n    // If any faulty routes occured, throw error with all faulty routes listed\n    if (faultyRoutes.length) {\n        let errorMessage = '\\nErrors occurred while attempting to deploy your application to Layer0 edge.' +\n            `\\nThe following ${faultyRoutes.length > 1 ? 'routes' : 'route'} could not be processed:`;\n        faultyRoutes.forEach(({ route, stackTrace }) => {\n            errorMessage = errorMessage.concat(`\\n* ${route}: ${stackTrace}`);\n        });\n        throw new Error(errorMessage);\n    }\n    return destination;\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * `minBy` function instead of importing lodash.\n *\n * Note that this function is not entirely equivalent to lodash's but it uses far less space in the bundle.\n *\n * @param collection Array of items of type T\n */\nfunction minBy(collection, iteratee) {\n    if (!collection || !collection.length) {\n        return undefined;\n    }\n    let min;\n    let minIterateeValue;\n    let minIterateeAssigned = false;\n    for (let item of collection) {\n        if (!minIterateeAssigned) {\n            min = item;\n            if (iteratee) {\n                minIterateeValue = iteratee(item);\n            }\n            minIterateeAssigned = true;\n            continue;\n        }\n        if (iteratee) {\n            const iterateeValue = iteratee(item);\n            if (iterateeValue < minIterateeValue) {\n                min = item;\n                minIterateeValue = iterateeValue;\n            }\n        }\n        else {\n            if (item < min) {\n                min = item;\n            }\n        }\n    }\n    return min;\n}\nexports.default = minBy;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Tasks {\n    constructor() {\n        this._tasks = [];\n        this._resolveHandler = Function.prototype;\n        this._errorHandler = (err) => {\n            throw err;\n        };\n    }\n    /**\n     * Adds a task to taks array that can be resolved with tasks.resolve()\n     *\n     * @param tasks List of tasks to finish\n     */\n    add(...tasks) {\n        this._tasks.push(...tasks);\n        return this;\n    }\n    /**\n     * Resolve Handler that will be called per each task with resolved value\n     *\n     * @param handler\n     */\n    onTaskDone(handler) {\n        this._resolveHandler = handler;\n        return this;\n    }\n    /**\n     * Error Handler that will be called per each task and can be useful\n     * for ignoring the specific errors\n     *\n     * @param errorHandler\n     */\n    onTaskError(errorHandler) {\n        this._errorHandler = errorHandler;\n        return this;\n    }\n    /**\n     * Finishes all tasks\n     */\n    resolve() {\n        const promises = this._convertTasksToPromises().map((task, i) => {\n            return task\n                .then((res) => {\n                this._resolveHandler(res);\n                return res;\n            })\n                .catch((err) => {\n                return this._errorHandler(err);\n            });\n        });\n        return Promise.all(promises);\n    }\n    /**\n     * Returns list of tasks that are converted into promises | functions\n     */\n    _convertTasksToPromises() {\n        return this._tasks.map(task => {\n            if (typeof task !== 'function') {\n                return Promise.resolve(task);\n            }\n            // Run the task and check if it returns a promise\n            try {\n                const taskResult = task();\n                if (taskResult instanceof Promise) {\n                    return taskResult;\n                }\n                // sync function results\n                return Promise.resolve(taskResult);\n            }\n            catch (e) {\n                // Return a error promise if sync task fails\n                // This allows to ignore some errors with error handler\n                return Promise.reject(e);\n            }\n        });\n    }\n}\nexports.default = Tasks;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = __importDefault(require(\"../config\"));\nconst Tasks_1 = __importDefault(require(\"../utils/Tasks\"));\nclass PreloadRequests {\n    constructor() {\n        this.options = [];\n    }\n    /**\n     * Adds prerender config to list\n     *\n     * @param preloadConfig\n     */\n    push(...preloadConfig) {\n        this.options.push(...preloadConfig);\n    }\n    /**\n     * Resolves Preload config per destination\n     * @param router\n     * @private\n     */\n    static async resolveDestinationPreloadConfig(router, destination) {\n        const requests = [];\n        await new Tasks_1.default()\n            .add(...router.preloadRequests.options)\n            .onTaskDone((result) => {\n            requests.push(...result.map(r => ({ ...r, destination })));\n        })\n            .resolve();\n        return {\n            requests,\n        };\n    }\n    /**\n     * Resolves compiled Preload config across all destinatons\n     * @param router\n     * @private\n     */\n    static async resolvePreloadConfig(router) {\n        const preloadRequests = [];\n        const tasks = new Tasks_1.default();\n        const destinations = router.getDestinations();\n        // Compile all the requests and options across all destinations\n        if (!Object.keys(destinations).length) {\n            tasks.add(PreloadRequests.resolveDestinationPreloadConfig(router, 'default'));\n        }\n        else {\n            for (let d in destinations) {\n                tasks.add(PreloadRequests.resolveDestinationPreloadConfig(destinations[d], d));\n            }\n        }\n        await tasks\n            .onTaskDone(({ requests }) => {\n            preloadRequests.push(...requests);\n        })\n            .resolve();\n        return {\n            requests: preloadRequests,\n            concurrency: config_1.default.get('prerenderConcurrency', null),\n        };\n    }\n}\nexports.default = PreloadRequests;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Reads the request body and returns it. It can only be used once per request.\n *\n * @param req\n * @return {Promise<Buffer>}\n */\nfunction readRawBody(req) {\n    return new Promise((resolve, reject) => {\n        const chunks = [];\n        req.on('data', (chunk) => chunk && chunks.push(chunk));\n        req.on('end', () => {\n            resolve(Buffer.concat(chunks));\n        });\n        req.on('abort', (e) => {\n            reject(e);\n        });\n    });\n}\nexports.default = readRawBody;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Gets the directory corresponding to the root of the project source code.\n */\nfunction getSourceDir() {\n    return process.env.LAYER0_ROOT_SOURCE_DIR || process.cwd();\n}\nexports.getSourceDir = getSourceDir;\n/**\n * Sets the directory corresponding to the root of the project source code.\n * @param dir The directory to set\n */\nfunction setSourceDir(dir) {\n    process.env.LAYER0_ROOT_SOURCE_DIR = dir;\n}\nexports.setSourceDir = setSourceDir;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst nonWebpackRequire_1 = __importDefault(require(\"./nonWebpackRequire\"));\n/**\n * Dynamically requires the version of a package listed in @layer0/core's depedencies\n * This allows us to ensure we are targeting the version of a package, such as globby, that is listed\n * in @layer0/core's package.json, as opposed to whatever version may or may not be included in the user's\n * app, which may not be compatible.\n */\nfunction requireInternal(packagePath) {\n    try {\n        const resolved = require.resolve(packagePath, {\n            paths: [require.resolve('@layer0/core')],\n        });\n        return nonWebpackRequire_1.default(resolved);\n    }\n    catch (e) {\n        return nonWebpackRequire_1.default(packagePath);\n    }\n}\nexports.default = requireInternal;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Route_1 = __importDefault(require(\"./Route\"));\nconst Cache_1 = require(\"../cache/Cache\");\nconst environment_1 = require(\"../environment\");\nconst path_1 = require(\"path\");\nconst nonWebpackRequire_1 = __importDefault(require(\"../utils/nonWebpackRequire\"));\nconst normalizeCriteria_1 = __importDefault(require(\"./normalizeCriteria\"));\nconst constants_1 = require(\"../constants\");\nconst source_1 = require(\"../source\");\nconst slash_1 = __importDefault(require(\"slash\"));\nconst requireInternal_1 = __importDefault(require(\"../utils/requireInternal\"));\n/**\n * The contents to be written to static-asset-manifest.json\n * @private\n */\nexports.staticAssetManifest = {};\n/**\n * The static asset manifest file name\n * @private\n */\nexports.STATIC_ASSET_MANIFEST_FILE = 'static-asset-manifest.json';\n/**\n * This class is needed for creating a route group that holds a routes that can\n * be dynamically updated on a local env.\n * @private\n */\nclass RouteGroup {\n    /**\n     * @param name Name of the route group - **required**\n     */\n    constructor(name) {\n        this._routes = [];\n        if (!name) {\n            throw new Error('Route group name is required!');\n        }\n        this.name = name;\n    }\n    /**\n     * Adds route to group.\n     * @param criteria The criteria to match.\n     * @param handler The handler to use for the route.\n     */\n    match(criteria, handler, { index, label } = {}) {\n        const route = new Route_1.default(criteria, handler, { label });\n        if (index != null) {\n            this._routes.splice(index, 0, route);\n        }\n        else {\n            this._routes.push(route);\n        }\n        return this;\n    }\n    /**\n     * Adds routes for all files in a directory tree.\n     * @private\n     * @param sourcePath The path to a directory containing static assets relative to the root of your project.\n     * @param options\n     * @returns A self-reference, suitable for chaining.\n     */\n    dir(sourcePath, options) {\n        const directory = path_1.join(source_1.getSourceDir(), sourcePath);\n        const manifest = (exports.staticAssetManifest[slash_1.default(sourcePath)] = []); // we normalize paths to use \"/\" here in case the user is building on windows but running on Linux\n        let { ignore, label } = options;\n        if (typeof ignore === 'string') {\n            ignore = [ignore];\n        }\n        let files = environment_1.isCloud()\n            ? this.staticAssetsForPath(sourcePath)\n            : requireInternal_1.default('globby').sync(options.glob || '**/*', {\n                // glob is large and we don't need it in production so we use nonWebpackRequire\n                cwd: directory,\n                onlyFiles: true,\n                ignore: ignore || [],\n            });\n        if (options.sort) {\n            files = options.sort(files);\n        }\n        for (let file of files) {\n            const paths = (options.paths && options.paths(file)) || [`/${file}`];\n            if (!environment_1.isCloud()) {\n                manifest.push(slash_1.default(file)); // we normalize paths to use \"/\" here in case the user is building on windows but running on Linux\n            }\n            for (let path of paths) {\n                let route = path.replace(/\\/index.html$/, '');\n                if (route.length === 0) {\n                    route = '/';\n                }\n                this.match(route, async (res) => {\n                    options.handler && options.handler(file)(res);\n                }, { label });\n            }\n        }\n        return this;\n    }\n    /**\n     * Adds routes for all static assets in a directory tree.\n     * @param sourcePath The path to a directory containing static assets relative to the root of your project.\n     * @param options\n     * @returns A self-reference, suitable for chaining.\n     */\n    static(sourcePath, options) {\n        const handler = (file) => (res) => {\n            if (options.handler) {\n                options.handler(file)(res);\n            }\n            res.serveStatic(`${sourcePath}/${file}`);\n        };\n        return this.dir(sourcePath, { ...options, handler, label: `static('${sourcePath}')` });\n    }\n    /**\n     * Adds Basic Authentication.\n     *\n     * **example**\n     *\n     * ```js\n     *  router\n     *    .requireBasicAuth({ username: 'user', password: 's3cr3t!' })\n     *    // ...include additional routes below...\n     * ```\n     *\n     * You can also require basic auth for a subset of URLs using the criteria option:\n     *\n     * ```js\n     *  router\n     *    .requireBasicAuth({ criteria: '/secret/:path*' username: 'user', password: 's3cr3t!' })\n     *    // ...include additional routes below...\n     * ```\n     *\n     * The criteria option accepts a path pattern as a string, or a RouteCriteria object.\n     *\n     * @param options\n     * @returns A self-reference, suitable for chaining.\n     */\n    requireBasicAuth(options) {\n        let { route, username, password, realm = 'Access to the site' } = options;\n        if (username && password) {\n            const token = Buffer.from(`${username}:${password}`).toString('base64');\n            route = normalizeCriteria_1.default(route);\n            // Add route handlers that will return 401, 403 or remove the authorizaton header,\n            // depending on the request properties.\n            // We run these handlers only if they have not already run in the edge. To detect this\n            // we cannot use `x-0-version` header because it gets injected very early in the edge\n            // so by the time the router matching runs, it's already present. We also cannot use\n            // `x-0-lambda-name` header because it gets removed by XBP before it reaches the lambda.\n            // We use `x-0-matched-routes` as the definitive indicator that a router has ran before\n            // the traffic reached this router.\n            this\n                // Provide challenge when the Authorization header is not present.\n                .match({\n                ...route,\n                headers: {\n                    ...route.headers,\n                    [constants_1.HTTP_HEADERS.authorization]: null,\n                    [constants_1.HTTP_HEADERS.x0MatchedRoutes]: null,\n                },\n            }, ({ send, setResponseHeader }) => {\n                setResponseHeader('WWW-Authenticate', `Basic realm=\"${realm}\"`);\n                send('', 401, 'Unauthorized');\n            })\n                // Block the request when the Authorization header is not matching the basic auth token.\n                .match({\n                ...route,\n                headers: {\n                    ...route.headers,\n                    [constants_1.HTTP_HEADERS.authorization]: new RegExp(`^((?!Basic ${token}).)*$`),\n                    [constants_1.HTTP_HEADERS.x0MatchedRoutes]: null,\n                },\n            }, ({ send }) => {\n                send('', 403, 'Forbidden');\n            })\n                // Do not leak authorization header upstream as upstreams are not likely to recognize it\n                // and are free to block the request.\n                .match({\n                ...route,\n                headers: {\n                    ...route.headers,\n                    [constants_1.HTTP_HEADERS.x0MatchedRoutes]: null,\n                },\n            }, ({ removeRequestHeader }) => {\n                removeRequestHeader('authorization');\n            });\n        }\n        return this;\n    }\n    /**\n     * Since the files are now on S3, we can no longer crawl the file system to\n     * determine the routes, so we use the manifest file.\n     * We also prevent webpack from trying to bundle the manifest, which will fail.\n     */\n    staticAssetsForPath(path) {\n        return nonWebpackRequire_1.default(path_1.join(process.cwd(), exports.STATIC_ASSET_MANIFEST_FILE))[path];\n    }\n    /**\n     * Clears all routes in group.\n     * Used for updating routes dynamically for development purpose.\n     */\n    clear() {\n        this._routes = [];\n        if (!environment_1.isCloud()) {\n            Cache_1.clearCache();\n        }\n        return this;\n    }\n    /**\n     * Returns the routes in group.\n     * @returns Routes in group\n     */\n    get routes() {\n        return this._routes;\n    }\n    /**\n     * Returns number of routes in group.\n     * @returns Number of routes in the group.\n     */\n    get length() {\n        return this._routes.length;\n    }\n}\nexports.default = RouteGroup;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst RouteGroup_1 = __importDefault(require(\"./RouteGroup\"));\nconst constants_1 = require(\"../constants\");\n/**\n * Holds a list of route groups\n * This class is needed for querying route groups that is needed\n * for keeping the routes hierarchy while changing the routes in a group.\n * For example, updating next.js routes in local dev env.\n */\nclass RouteGroupList {\n    constructor() {\n        this.routeGroups = [];\n    }\n    /**\n     * Pushes route group to list.\n     * @param group The route group.\n     * @returns A self-reference suitable for chaining.\n     */\n    add(group) {\n        this.routeGroups.push(group);\n        return this;\n    }\n    /**\n     * Returns all route groups.\n     * @returns A list of all the route groups.\n     */\n    getGroups() {\n        return this.routeGroups;\n    }\n    /**\n     * Returns route group by name.\n     * @param name The name of the route group to find.\n     * @returns The route group with the given name, or `null` if not found.\n     */\n    findByName(name) {\n        return this.routeGroups.find(g => g.name === name);\n    }\n    /**\n     * Returns all registered routes in all groups.\n     * @returns List of registered routes.\n     */\n    getRoutes() {\n        let routes = [];\n        this.getGroups().forEach(group => {\n            routes = routes.concat(group.routes);\n        });\n        if (this.fallback) {\n            routes = routes.concat(this.fallback.routes);\n        }\n        return routes;\n    }\n    /**\n     * Sets the fallback group, which is always run last.\n     * @param handler\n     */\n    setFallback(handler) {\n        const fallbackGroup = new RouteGroup_1.default(constants_1.ROUTES_FALLBACK);\n        fallbackGroup.match(null, handler);\n        this.fallback = fallbackGroup;\n    }\n    /**\n     * Returns the length of route groups list.\n     * @returns The number of route groups in the list.\n     */\n    get length() {\n        return this.routeGroups.length;\n    }\n}\nexports.default = RouteGroupList;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"../constants\");\nconst timing_1 = require(\"../timing\");\nconst uuid_1 = require(\"uuid\");\nconst addBuiltInRoutes_1 = __importDefault(require(\"./addBuiltInRoutes\"));\nconst BehindEdgeResponseWriterProxy_1 = __importDefault(require(\"./BehindEdgeResponseWriterProxy\"));\nconst config_1 = __importDefault(require(\"../config\"));\nconst createEdgeConfig_1 = __importDefault(require(\"../edge/createEdgeConfig\"));\nconst interpolateParams_1 = __importDefault(require(\"./interpolateParams\"));\nconst minBy_1 = __importDefault(require(\"../utils/minBy\"));\nconst PreloadRequests_1 = __importDefault(require(\"./PreloadRequests\"));\nconst readRawBody_1 = __importDefault(require(\"../utils/readRawBody\"));\nconst RequestContext_1 = __importDefault(require(\"./RequestContext\"));\nconst ResponseWriter_1 = __importDefault(require(\"./ResponseWriter\"));\nconst RouteGroup_1 = __importStar(require(\"./RouteGroup\"));\nconst RouteGroupList_1 = __importDefault(require(\"./RouteGroupList\"));\nconst BROTLI_ENCODING_REGEX = /\\bbr\\b/;\nconst GZIP_ENCODING_REGEX = /\\bgzip\\b/;\n/**\n * A router.\n */\nclass Router {\n    constructor(options = { excludeBuiltInRoutes: false }) {\n        this.routeGroups = new RouteGroupList_1.default();\n        this.preloadRequests = new PreloadRequests_1.default();\n        this.plugins = [];\n        this.destinations = {};\n        this.nextRouterIndex = 0;\n        /**\n         * Index is used to determine the precedence of a router when routing rules\n         * have not resolved to a specific destination. The router with the lowest\n         * number wins.\n         * @private\n         *\n         */\n        this._index = 0;\n        /**\n         * Checks headers for validity and updates them as needed.\n         *\n         * Notes:\n         * - If x-request-id is not present we generate it and later inject it into\n         * the response.\n         * - If accept-encoding includes gzip then we use it but eliminating everything else\n         * as we don't support other encodings. If there is no gzip in accept-encoding\n         * then we delete it entirely forcing upstream to return uncoded response.\n         * - We emulate the edge router by injecting the same headers it injects:\n         *    - x-0-client-ip\n         *    - x-forwarded-for\n         */\n        this.processRequestHeaders = (req) => {\n            if (!req.headers[constants_1.HTTP_HEADERS.xRequestId]) {\n                this.newRequestId = uuid_1.v4();\n                req.headers[constants_1.HTTP_HEADERS.xRequestId] = this.newRequestId;\n            }\n            // Normalize the accept encoding.\n            let acceptEncoding = req.headers[constants_1.HTTP_HEADERS.acceptEncoding];\n            if (typeof acceptEncoding === 'string') {\n                const acceptGzipEncoding = GZIP_ENCODING_REGEX.test(acceptEncoding);\n                const acceptBrotliEncoding = BROTLI_ENCODING_REGEX.test(acceptEncoding);\n                // Connasence of algorithm and values with edge: when both gzip and br are acceptable\n                // to the downstream, we normalize the accept-encoding and send them both to the upstream.\n                if (acceptGzipEncoding && acceptBrotliEncoding) {\n                    acceptEncoding = `${constants_1.GZIP_ENCODING}, ${constants_1.BROTLI_ENCODING}`;\n                }\n                else if (acceptGzipEncoding) {\n                    acceptEncoding = constants_1.GZIP_ENCODING;\n                }\n                else if (acceptBrotliEncoding) {\n                    acceptEncoding = constants_1.BROTLI_ENCODING;\n                }\n                else {\n                    acceptEncoding = null;\n                }\n            }\n            else {\n                acceptEncoding = null;\n            }\n            if (acceptEncoding) {\n                req.headers[constants_1.HTTP_HEADERS.acceptEncoding] = acceptEncoding;\n            }\n            else {\n                delete req.headers[constants_1.HTTP_HEADERS.acceptEncoding];\n            }\n            // Append the our local address to the x-forwarded-for header. If x-forwarded-for does not exist, we create it.\n            const connection = req.connection;\n            let localAddress = '127.0.0.1'; // put a default in, in case the underlying environment does not provide Ip.\n            if (connection && connection.remoteAddress) {\n                localAddress = connection.remoteAddress;\n                // By default we treat all local connections as if they were made on HTTPS.\n                // We treat the request as HTTP only if the user sends the x-0-protocol or\n                // they are running with cookie `local_layer0_emulate_http_protocol` set to `true`.\n                if (req.headers[constants_1.HTTP_HEADERS.x0Protocol] !== 'http') {\n                    const cookie = req.headers[constants_1.HTTP_HEADERS.cookie];\n                    if (typeof cookie === 'string' &&\n                        /\\blocal_layer0_emulate_http_protocol=true\\b/.test(cookie)) {\n                        req.headers[constants_1.HTTP_HEADERS.x0Protocol] = 'http';\n                    }\n                    else {\n                        req.headers[constants_1.HTTP_HEADERS.x0Protocol] = 'https';\n                    }\n                }\n            }\n            else {\n                // Assume HTTPS request when not specified. This doesn't normally happen as downstream\n                // components will have injected x-0-protocol by the time the Router is reached.\n                // But in tests we often use plain objects for requests and directly send them to a Router.\n                if (!req.headers[constants_1.HTTP_HEADERS.x0Protocol]) {\n                    req.headers[constants_1.HTTP_HEADERS.x0Protocol] = 'https';\n                }\n            }\n            if (req.headers[constants_1.HTTP_HEADERS.xForwardedFor]) {\n                req.headers[constants_1.HTTP_HEADERS.xForwardedFor] = `${req.headers[constants_1.HTTP_HEADERS.xForwardedFor]}, ${localAddress}`;\n            }\n            else {\n                req.headers[constants_1.HTTP_HEADERS.xForwardedFor] = `${localAddress}`;\n            }\n            if (!req.headers[constants_1.HTTP_HEADERS.x0ClientIp]) {\n                // The client Ip is always the left most x-forwarded-for: value.\n                req.headers[constants_1.HTTP_HEADERS.x0ClientIp] = (req.headers[constants_1.HTTP_HEADERS.xForwardedFor]).split(',')[0];\n            }\n            if (!Router.isRequestFromEdge(req)) {\n                this.processRequestDeviceHeaders(req);\n                this.processRequestGeoHeaders(req);\n            }\n        };\n        /**\n         * Emulates edge by injecting device headers into the request prior to routing.\n         *\n         * Notes:\n         * - This code must be the same as the the generated edge router.\n         * - This code has been directly translated from ECL compiler\n         * - We emulate the edge router by injecting the same headers it injects:\n         *    - x-0-device\n         *    - x-0-vendor\n         *    - x-0-browser\n         *    - x-0-device-is-bot\n         */\n        this.processRequestDeviceHeaders = (req) => {\n            let device = 'desktop';\n            let vendor = 'generic';\n            let isBot = false;\n            let browser = 'generic';\n            // Note: unlike outer-edge code, we transform everything to lower case for faster matching\n            const ua = (req.headers[constants_1.HTTP_HEADERS.userAgent] || '').toLowerCase();\n            if (/ipad/.test(ua)) {\n                device = 'tablet';\n                vendor = 'apple';\n            }\n            else if (/ip(hone|od)/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'apple';\n            }\n            else if (/android.*(mobile|mini)/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'android';\n            }\n            else if (/android/.test(ua)) {\n                device = 'tablet';\n                vendor = 'android';\n            }\n            else if (/opera mobi/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'android';\n            }\n            else if (/playbook u rim tablet/.test(ua)) {\n                device = 'tablet';\n                vendor = 'blackberry';\n            }\n            else if (/hp-tablet.*touchpad/.test(ua)) {\n                device = 'tablet';\n                vendor = 'hp';\n            }\n            else if (/kindle\\/3/.test(ua)) {\n                device = 'tablet';\n                vendor = 'kindle';\n            }\n            else if (/mobile.+firefox/.test(ua)) {\n                device = 'mobile';\n                vendor = 'firefoxos';\n            }\n            else if (/^htc/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'htc';\n            }\n            else if (/fennec/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'fennec';\n            }\n            else if (/iemobile/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'microsoft';\n            }\n            else if (/blackberry/.test(ua) || /bb10.*mobile/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'blackberry';\n            }\n            else if (/gt-.*build\\/gingerbread/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'android';\n            }\n            else if (/symbianos.*applewebkit/.test(ua)) {\n                device = 'smartphone';\n                vendor = 'symbian';\n            }\n            else if (/symbian/.test(ua) ||\n                /^sonyericsson/.test(ua) ||\n                /^nokia/.test(ua) ||\n                /^samsung/.test(ua) ||\n                /^lg/.test(ua) ||\n                /bada/.test(ua) ||\n                /blazer/.test(ua) ||\n                /cellphone/.test(ua) ||\n                // /iemobile/.test(ua) || duplicate - this case never hits because it matches above\n                /midp-2.0/.test(ua) ||\n                /u990/.test(ua) ||\n                /netfront/.test(ua) ||\n                /opera mini/.test(ua) ||\n                /palm/.test(ua) ||\n                /nintendo wii/.test(ua) ||\n                /playstation portable/.test(ua) ||\n                /portalmmm/.test(ua) ||\n                /proxinet/.test(ua) ||\n                /sonyericsson/.test(ua) ||\n                // /symbian/.test(ua) || duplicate\n                /windows ?ce/.test(ua) ||\n                /winwap/.test(ua) ||\n                /eudoraweb/.test(ua) ||\n                // /htc/.test(ua) || duplicate\n                /240x320/.test(ua) ||\n                /avantgo/.test(ua)) {\n                device = 'mobile';\n            }\n            if (/bot/.test(ua) ||\n                /crawler/.test(ua) ||\n                /headless/.test(ua) ||\n                /prerender/.test(ua) ||\n                /preview/.test(ua) ||\n                /scanner/.test(ua) ||\n                /slurp/.test(ua) ||\n                /spider/.test(ua) ||\n                /(developers.google.com\\/+\\/web\\/snippet|embedly|facebookexternalhit|flipboard|googlepagespeed|google page speed)/.test(ua) ||\n                /(ia_archiver|moov-prerender-cache-exerciser|nuzzel|outbrain|pinterest|qwantify|tumblr|vkshare)/.test(ua) ||\n                /(w3c_validator|whatsapp|xing-contenttabreceiver|yahoo)/.test(ua)) {\n                isBot = true;\n            }\n            else {\n                isBot = false;\n            }\n            if (/edge/.test(ua)) {\n                browser = 'edge';\n            }\n            else if (/chrome|chromium|crios/.test(ua)) {\n                browser = 'chrome';\n            }\n            else if (/firefox/.test(ua)) {\n                browser = 'firefox';\n            }\n            else if (/opera|opr/.test(ua)) {\n                browser = 'opera';\n            }\n            else if (/msie/.test(ua) || /trident/.test(ua)) {\n                browser = 'msie';\n            }\n            else if (/safari/.test(ua)) {\n                browser = 'safari';\n            }\n            req.headers[constants_1.HTTP_HEADERS.x0Device] = device;\n            req.headers[constants_1.HTTP_HEADERS.x0DeviceIsBot] = isBot ? '1' : '0';\n            req.headers[constants_1.HTTP_HEADERS.x0Vendor] = vendor;\n            req.headers[constants_1.HTTP_HEADERS.x0Browser] = browser;\n        };\n        /**\n         * Emulates edge by injecting Geolocation headers into the request prior to routing.\n         *  - x-0-geo-city\n         *  - x-0-geo-country-code\n         *  - x-0-geo-latitude\n         *  - x-0-geo-longitude\n         *  - x-0-geo-postal-code\n         */\n        this.processRequestGeoHeaders = (req) => {\n            req.headers[constants_1.HTTP_HEADERS.x0GeoCity] = 'San Francisco';\n            req.headers[constants_1.HTTP_HEADERS.x0GeoCountryCode] = 'US';\n            req.headers[constants_1.HTTP_HEADERS.x0GeoLatitude] = '37.792094';\n            req.headers[constants_1.HTTP_HEADERS.x0GeoLongitude] = '-122.401622';\n            req.headers[constants_1.HTTP_HEADERS.x0GeoPostalCode] = '94104';\n        };\n        /**\n         * Adds the `rawBody` (Buffer) and `body` (String) to the request\n         * @param req\n         */\n        this.processRequestBody = async (req) => {\n            req.rawBody = await readRawBody_1.default(req);\n            Object.defineProperty(req, 'body', {\n                configurable: true,\n                get() {\n                    return this.rawBody.toString('utf8');\n                },\n            });\n        };\n        /**\n         * Checks if the number of user headers is within the limits.\n         *\n         * Notes:\n         * - User headers are all those that do not have `x-0-` prefix.\n         * - We check user headers counts in the router because in local\n         * development the router is running on \"the edge\" and we want to\n         * simulate the edge behavior (which actually has hard limits on\n         * header count - see `LAYER0_MAX_USER_HEADERS_ALLOWED` for more info)\n         */\n        this.isUserHeaderCountWithinLimits = (headers) => {\n            const userHeaderNames = Object.keys(headers).filter(name => name.toLowerCase().indexOf(constants_1.LAYER0_HEADERS_PREFIX) !== 0);\n            return userHeaderNames.length <= constants_1.LAYER0_MAX_USER_HEADERS_ALLOWED;\n        };\n        /**\n         * Patches writeHead method of the response so that we can do any post-response work.\n         *\n         * Notes:\n         * - Injects response ID header when this same component has generated the request ID.\n         * All components that actually generate the request ID before processing the request\n         * or going upstream are then also responsible for sending back the request ID downstream.\n         * - Return status 542 when there are too many response headers.\n         *\n         * @param req The request\n         * @param res The response\n         */\n        this.patchResWriteHead = (req, res) => {\n            const originalWriteHead = res.writeHead;\n            res.writeHead = (...args) => {\n                res.writeHead = originalWriteHead;\n                if (this.newRequestId) {\n                    res.setHeader(constants_1.HTTP_HEADERS.xRequestId, this.newRequestId);\n                }\n                const HEADERS_ARGS_INDEX = 2;\n                const headers = args[HEADERS_ARGS_INDEX];\n                if (headers) {\n                    for (let key of Object.keys(headers)) {\n                        res.setHeader(key, interpolateParams_1.default(req, res, headers[key]));\n                    }\n                }\n                if (this.isUserHeaderCountWithinLimits(res.getHeaders())) {\n                    res.writeHead(...args);\n                    return;\n                }\n                res.writeHead(constants_1.LAYER0_TOO_MANY_HEADERS_STATUS_CODE, 'Too many response headers');\n            };\n        };\n        /**\n         * Handles a request, sending the response by running the handler for each matched route.\n         * @param req The request\n         * @param res The response\n         */\n        this.run = async (req, res) => {\n            const routeMatchTime = new timing_1.InternalTiming(timing_1.InternalNames.routeMatching).start();\n            let router = this;\n            const context = new RequestContext_1.default();\n            this.processRequestHeaders(req);\n            if (!this.isUserHeaderCountWithinLimits(req.headers)) {\n                res.writeHead(constants_1.LAYER0_TOO_MANY_HEADERS_STATUS_CODE, 'Too many request headers');\n                res.end();\n                return;\n            }\n            await this.processRequestBody(req);\n            this.patchResWriteHead(req, res);\n            if (Object.keys(this.destinations).length > 1) {\n                const { LAYER0_ROUTER_DESTINATION } = process.env;\n                let destinationName = ((req.headers[constants_1.HTTP_HEADERS.x0Destination] || LAYER0_ROUTER_DESTINATION));\n                if (!destinationName) {\n                    // Connascence of algorithm between @layer0/core and @layer0/build-lambda:\n                    // when destination cannot be determined by other means, then\n                    // we choose the first router that was added to the list.\n                    destinationName = minBy_1.default(Object.keys(this.destinations), destinationName => {\n                        return this.destinations[destinationName]._index;\n                    });\n                }\n                router = this.destinations[destinationName];\n                if (!router) {\n                    throw new Error(`Routing destination \"${destinationName}\" not found.`);\n                }\n            }\n            router.plugins.forEach(p => p.onRequest(req)); // this gives the plugin an opportunity to update the routes before the request is handled\n            const createResponseWriter = (route) => {\n                const writer = new ResponseWriter_1.default(req, res, route, context);\n                return Router.isRequestFromEdge(req) ? BehindEdgeResponseWriterProxy_1.default.create(writer) : writer;\n            };\n            // Loop thru route groups routes\n            const routes = router.routeGroups.getRoutes().filter(r => !r.isRespRoute());\n            const errorRoutes = router.routeGroups.getRoutes().filter(r => r.isRespRoute());\n            for (let route of routes) {\n                let writer;\n                try {\n                    if (!route.match(req))\n                        continue;\n                    // Run different response writer depending on if the router\n                    // is behind the edge or not.\n                    writer = createResponseWriter(route);\n                    routeMatchTime.pause();\n                    await route.handler(writer);\n                    // Stop running routes if the route has defined the send response,\n                    // otherwise continue to the next route.\n                    const done = await writer.sendResponse({\n                        // We may need to alter the response based on the status code to issue a error page\n                        beforeResponse: async (res) => {\n                            // We only run the error page handler when accessed via permalink. Otherwise we may execute the\n                            // error route in both edge and serverless and that will render the error page for error page rendered by serverless which is incorrect.\n                            if (!Router.isRequestFromEdge(req)) {\n                                /* istanbul ignore else */\n                                if (routeMatchTime.ended) {\n                                    routeMatchTime.resume();\n                                }\n                                for (let errorRoute of errorRoutes) {\n                                    if (!errorRoute.matchResponse(res))\n                                        continue;\n                                    writer = createResponseWriter(errorRoute);\n                                    routeMatchTime.pause();\n                                    await errorRoute.handler(writer);\n                                    writer.sendResponse();\n                                    return false;\n                                }\n                            }\n                            // When nothing was matched by error handler or we are behind edge,\n                            // return original response.\n                            return true;\n                        },\n                    });\n                    routeMatchTime.resume();\n                    if (done) {\n                        return;\n                    }\n                }\n                catch (e) {\n                    // @ts-ignore\n                    writer = writer || createResponseWriter(req, res, route, context);\n                    writer.onRouteError(e);\n                    return;\n                }\n            }\n            routeMatchTime.end();\n            this.builtInFallback(req, res);\n        };\n        if (!options.excludeBuiltInRoutes) {\n            addBuiltInRoutes_1.default(this);\n        }\n    }\n    /**\n     * Returns a manifest of all static assets to be served via router.static\n     * @private\n     */\n    getStaticAssetManifest() {\n        return RouteGroup_1.staticAssetManifest;\n    }\n    /**\n     * Allows the lambda handler to add the __js__ backend in the cloud\n     * @private\n     * @param name\n     * @param value\n     */\n    setBackend(name, value) {\n        config_1.default.get('backends')[name] = value;\n        return this;\n    }\n    /**\n     * Constructs plugin and pushes it to registered plugins\n     * @param pluginInstance A plugin to use.\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    use(pluginInstance) {\n        pluginInstance.onRegister(this);\n        this.plugins.push(pluginInstance);\n        return this;\n    }\n    /**\n     * Adds a named destination to which you can map traffic using the traffic shaping settings in your environment\n     * in Layer0 developer console\n     * @param name The name of the destination\n     * @param router A router to use when handling requests\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    destination(name, router) {\n        router.setIndex(this.nextRouterIndex++);\n        this.destinations[name] = router;\n        return this;\n    }\n    /**\n     * Returns all plugins, including those registered on destination routers.\n     */\n    getPlugins() {\n        let plugins = this.plugins;\n        for (let router of Object.values(this.destinations)) {\n            plugins = plugins.concat(router.getPlugins());\n        }\n        return plugins;\n    }\n    /**\n     * Sets the index at which the router has been added to its parent router\n     * @private\n     * @param index\n     */\n    setIndex(index) {\n        this._index = index;\n    }\n    /**\n     * Returns the index at which the router has been added to its parent router\n     * @private\n     * @returns router's index\n     */\n    get index() {\n        return this._index;\n    }\n    /**\n     * Adds a RouteGroup to router and calls route register function for group.\n     * @private\n     * @param name Group name\n     * @param registerRoutesFn Group route register function\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    group(name, registerRoutesFn) {\n        const newGroup = new RouteGroup_1.default(name);\n        registerRoutesFn(newGroup);\n        this.routeGroups.add(newGroup);\n        return this;\n    }\n    /**\n     * Adds a route matching all methods.\n     *\n     * Example:\n     *\n     * ```js\n     *  new Router().match('/p/:productId', ({ cache, proxy }) => {\n     *    cache({\n     *      edge: {\n     *        maxAgeSeconds: 60 * 60 * 24\n     *      }\n     *    })\n     *\n     *    proxy('origin')\n     *  })\n     * ```\n     *\n     * @param criteria Either the path as a string or an object with `path`, `method`, and `headers`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    match(criteria, handler) {\n        return this.group('root', routeGroup => routeGroup.match(criteria, handler));\n    }\n    /**\n     * Adds preload config for router\n     *\n     * ```js\n     *  new Router().preload(\n     *    async () => [{ path: '/foo', headers: { foo: 'bar' } }],\n     *    [{ path: '/bar' }]\n     *  )\n     * ```\n     *\n     * @param preloadOptions\n     */\n    prerender(...preloadOptions) {\n        this.preloadRequests.push(...preloadOptions);\n        return this;\n    }\n    /**\n     * Adds a route matching the given HTTP method.\n     *\n     * @param method HTTP method\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @private\n     */\n    matchMethod(method, criteria, handler) {\n        if (typeof criteria === 'string') {\n            return this.match({\n                method,\n                path: criteria,\n            }, handler);\n        }\n        if (criteria.method) {\n            throw new Error(`Invalid criteria property method passed to call to Router#${method}. Specifying a method in the criteria is redundant.`);\n        }\n        return this.match({ ...criteria, method }, handler);\n    }\n    /**\n     * Adds a route matching `HEAD` HTTP method.\n     *\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    head(criteria, handler) {\n        return this.matchMethod(constants_1.HTTP_METHODS.head, criteria, handler);\n    }\n    /**\n     * Adds a route matching `GET` HTTP method.\n     *\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    get(criteria, handler) {\n        return this.matchMethod(constants_1.HTTP_METHODS.get, criteria, handler);\n    }\n    /**\n     * Adds a route matching `POST` HTTP method.\n     *\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    post(criteria, handler) {\n        return this.matchMethod(constants_1.HTTP_METHODS.post, criteria, handler);\n    }\n    /**\n     * Adds a route matching `DELETE` HTTP method.\n     *\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    delete(criteria, handler) {\n        return this.matchMethod(constants_1.HTTP_METHODS.delete, criteria, handler);\n    }\n    /**\n     * Adds a route matching `PUT` HTTP method.\n     *\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    put(criteria, handler) {\n        return this.matchMethod(constants_1.HTTP_METHODS.put, criteria, handler);\n    }\n    /**\n     * Adds a route matching `PATCH` HTTP method.\n     *\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    patch(criteria, handler) {\n        return this.matchMethod(constants_1.HTTP_METHODS.patch, criteria, handler);\n    }\n    /**\n     * Adds a route matching `OPTIONS` HTTP method.\n     *\n     * @param criteria Either the path as a string or an object with `path`, `headers` and `cookies`.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    options(criteria, handler) {\n        return this.matchMethod(constants_1.HTTP_METHODS.options, criteria, handler);\n    }\n    /**\n     * Adds a route that will run if no other routes are matched\n     * @param handler A handler function that will be called when no other route is matched\n     * @returns A self-reference, suitable for chaining.\n     */\n    fallback(handler) {\n        this.routeGroups.setFallback(handler);\n        return this;\n    }\n    /**\n     * Adds a route that matches all requests with internal error header.\n     * @param handler A handler function that will be called when the route is matched\n     * @returns {Router} A self-reference, suitable for chaining.\n     */\n    catch(error, handler) {\n        let errorRegex;\n        if (error instanceof RegExp) {\n            errorRegex = error;\n        }\n        else {\n            errorRegex = new RegExp(`^${error.toString()}$`);\n        }\n        this.group(constants_1.ROUTES_CATCH_GROUP, routeGroup => routeGroup.match({ headers: { 'x-0-error-status-code': errorRegex }, response: { statusCode: errorRegex } }, async (writer) => {\n            await handler(writer);\n            writer.cache({\n                edge: false,\n                browser: {\n                    maxAgeSeconds: 0,\n                },\n            });\n        }));\n        return this;\n    }\n    /**\n     * Disables crawling of permalinks by setting the `x-robots-tag: noindex` response header\n     * for hosts matching layer0.link or layer0-perma.link.\n     *\n     * ```js\n     *  new Router().noIndexPermalink()\n     * ```\n     *\n     * * @returns {Router} A self-reference, suitable for chaining.\n     */\n    noIndexPermalink() {\n        return this.group(constants_1.ROUTES_NOINDEX_GROUP, routeGroup => routeGroup.match({\n            headers: {\n                host: /layer0.link|layer0-perma.link/,\n            },\n        }, ({ setResponseHeader }) => {\n            setResponseHeader('x-robots-tag', 'noindex');\n        }));\n    }\n    /**\n     * Both edge and @core/router have a built-in fallback that has the following rules:\n     *\n     * 1. On HTTP protocol return a 301 with the same request path in `location` header but on HTTPS\n     * protocol.\n     * 2. On HTTPS protocol return a 404.\n     *\n     * One complication is that in local development HTTPS does not exist - it is only emulated.\n     * Therefore in local development we could go into a redirect loop if the HTTP is emulated\n     * through the `local_layer0_emulate_http_protocol` cookie. There are a few options:\n     *\n     * 1. Always return 404 in local development.\n     * 2. If the cookie is present, issue 301 but unset the cookie in the response.\n     * 3. If the cookie is not present, return 301.\n     *\n     * We feel that the least surprising is simply always issuing 404 as that is also the original behavior.\n     *\n     * @param res\n     */\n    builtInFallback(req, res) {\n        const connection = req.connection;\n        if (connection && connection.remoteAddress) {\n            res.writeHead(404);\n        }\n        else {\n            if (req.headers[constants_1.HTTP_HEADERS.x0Protocol] === 'http') {\n                res.setHeader(constants_1.HTTP_HEADERS.location, `https://${req.headers[constants_1.HTTP_HEADERS.host]}${req.url}`);\n                res.writeHead(301);\n            }\n            else {\n                res.writeHead(404);\n            }\n        }\n        res.end();\n    }\n    /**\n     * Adds routes for all static assets in a directory tree.\n     *\n     * **Example**\n     *\n     * ```js\n     *  router.static('public')\n     * ```\n     *\n     * To only serve files matching a particular pattern, use the `glob` options:\n     *\n     * ```js\n     *  router.static('public', {\n     *    glob: '*.css'\n     *  })\n     * ```\n     *\n     * By default the path on which files are served corresponds to the path within the directory,\n     * so for example, `public/css/main.css` would be served at `'/css/main.css'`,\n     * you can override this using the `path` option:\n     *\n     * ```js\n     *  router.static('public', {\n     *    paths: file => ['/assets/ + file] // will serve public/css/main.css at /assets/css/main.css\n     *  })\n     * ```\n     *\n     * You can add caching or other additional handler logic using the `handler` option:\n     *\n     * ```js\n     *  router.static('public', {\n     *    handler: (file) => ({ cache }) => {\n     *      cache({\n     *        browser: {\n     *          maxAgeSeconds: 60 * 60\n     *        },\n     *        edge: {\n     *          maxAgeSeconds: 60 * 60 * 24,\n     *          staleWhileRevalidateSeconds: 60 * 60\n     *        }\n     *      })\n     *    }\n     *  })\n     * ```\n     *\n     * @param sourcePath The path to a directory containing static assets relative to the root of your project.\n     * @param options\n     * @returns A self-reference, suitable for chaining.\n     */\n    static(sourcePath, options = {}) {\n        return this.group('root', routeGroup => routeGroup.static(sourcePath, options));\n    }\n    /**\n     * Shorthand for adding GraphQL body matching\n     *\n     * Examples:\n     *\n     * // by default the path is graphql\n     * new Router().graphqlOperation(\"GetRates\")\n     *\n     * or\n     *\n     * // with optional non-default path\n     * new Router().graphqlOperation({ path: \"/gql-api\", name: \"GetRates\" })\n     *\n     * @param criteria Either the operation name as a string or an object with `path`, `name`.\n     * @param handler A handler function that will be called when the route is matched\n     *\n     * @returns A self-reference, suitable for chaining.\n     */\n    graphqlOperation(criteria, handler) {\n        if (typeof criteria === 'string' || criteria instanceof RegExp) {\n            return this.post({ path: '/graphql', body: { parse: 'json', criteria: { operationName: criteria } } }, handler);\n        }\n        else {\n            const { path, name } = criteria;\n            return this.post({ path, body: { parse: 'json', criteria: { operationName: name } } }, handler);\n        }\n    }\n    /**\n     * Adds Basic Authentication.\n     *\n     * **example**\n     *\n     * ```js\n     *  router\n     *    .requireBasicAuth({ username: 'user', password: 's3cr3t!' })\n     *    // ...include additional routes below...\n     * ```\n     *\n     * You can also require basic auth for a subset of URLs using the `criteria` option:\n     *\n     * ```js\n     *  router\n     *    .requireBasicAuth({ criteria: '/secret/:path*', username: 'user', password: 's3cr3t!' })\n     *    // ...include additional routes below...\n     * ```\n     *\n     * The criteria option accepts a path pattern as a string, or a RouteCriteria object.\n     *\n     * @param options\n     * @returns A self-reference, suitable for chaining.\n     */\n    requireBasicAuth(options) {\n        return this.group('root', routeGroup => routeGroup.requireBasicAuth(options));\n    }\n    /**\n     * Returns edge config from current router\n     * @private\n     */\n    createEdgeConfig() {\n        return createEdgeConfig_1.default(this);\n    }\n    /**\n     * Returns preload config from current router\n     * @private\n     */\n    createPreloadConfig() {\n        return PreloadRequests_1.default.resolvePreloadConfig(this);\n    }\n    /**\n     * @private\n     */\n    getDestinations() {\n        return this.destinations;\n    }\n    /**\n     * @private\n     */\n    getRouteGroups() {\n        return this.routeGroups;\n    }\n    /**\n     * Returns a string summarizing all routes for debugging purposes. Don't rely on the format\n     * of this string as we may improve it over time.\n     */\n    toString() {\n        return ('Routes\\n======\\n' +\n            this.routeGroups\n                .getRoutes()\n                .map((r, i) => `${i}:\\t${r.toString()}`)\n                .join('\\n'));\n    }\n    /**\n     * Returns true if the request came through Layer0 edge.\n     *\n     * Notes:\n     * - If the request came through Layer0 edge then `x-0-version` has been injected.\n     *\n     * @param req The request\n     */\n    static isRequestFromEdge(req) {\n        return typeof req.headers[constants_1.HTTP_HEADERS.x0Version] == 'string';\n    }\n}\nexports.default = Router;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass GroupConfig {\n    constructor(name) {\n        this.name = name;\n    }\n    byPattern(pattern) {\n        this.pattern = pattern;\n    }\n    toJSON() {\n        if (!this.pattern) {\n            throw new Error('byPattern is required for group ' + this.name);\n        }\n        return {\n            groupedValue: this.name,\n            matchRegex: this.pattern.source,\n        };\n    }\n}\nexports.default = GroupConfig;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst GroupConfig_1 = __importDefault(require(\"./GroupConfig\"));\nclass Groups {\n    constructor() {\n        this.groups = [];\n        this.name = null;\n    }\n    group(name) {\n        const group = new GroupConfig_1.default(name);\n        this.groups.push(group);\n        return group;\n    }\n    toJSON() {\n        return this.groups.map(p => p.toJSON());\n    }\n}\nexports.default = Groups;\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Groups_1 = __importDefault(require(\"./Groups\"));\nconst cookie_1 = require(\"cookie\");\nexports.CUSTOM_CACHE_KEY_ACTIONS = {\n    blacklistAll: 'blacklist-all-query-parameters',\n    blacklistSome: 'blacklist-some-query-parameters',\n    whitelistSome: 'whitelist-some-query-parameters',\n    addValue: 'add-value',\n    removeMethod: 'remove-method',\n    removeBody: 'remove-body',\n};\n/**\n * Allows you to split or normalize the cache space for a given route. Common use cases include:\n *\n * - serving multiple variants of the same URL based on a currency and/or language cookie.\n * - caching different responses based on device type\n * - ignoring all but a specific set of query parameters when looking up a response from the cache.\n *\n * **Example**\n *\n * ```js\n *  import { Router, CustomCacheKey } from '@layer0/core/router'\n *\n *  new Router()\n *    .match('/some-path', ({ cache }) => {\n *      cache({\n *        key: new CustomCacheKey()\n *          .excludeAllQueryParametersExcept('color', 'size')\n *          .addCookie('currency')\n *          .addCookie('location', cookie => {\n *            cookie.group('na').byPattern('us|ca')\n *            cookie.group('eur').byPattern('de|fr|ee')\n *          }),\n *        edge: {\n *          maxAgeSeconds: 60 * 60\n *        }\n *      })\n *    })\n * ```\n */\nclass CustomCacheKey {\n    constructor() {\n        this.config = [];\n        this.actions = [];\n    }\n    /**\n     * Creates a copy of the cache key.\n     */\n    clone() {\n        const newKey = new CustomCacheKey();\n        newKey.actions = this.actions;\n        newKey.config = this.config;\n        return newKey;\n    }\n    /**\n     * Excludes the entire query string from the cache key.\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    excludeAllQueryParameters() {\n        this.config.push({ action: exports.CUSTOM_CACHE_KEY_ACTIONS.blacklistAll });\n        this.actions.push((key, srcRequest) => {\n            key.query = {};\n        });\n        return this;\n    }\n    /**\n     * Excludes the provided query parameters from the cache key.  All other parameters\n     * will still be part of the cache key. We also refer to this as \"blacklisting\" query parameters.\n     * @param names The names of the query parameters to blacklist\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    excludeQueryParameters(...names) {\n        this.config.push({\n            action: exports.CUSTOM_CACHE_KEY_ACTIONS.blacklistSome,\n            names,\n        });\n        this.actions.push((key, srcRequest) => {\n            for (let name of names) {\n                delete key.query[name];\n            }\n        });\n        return this;\n    }\n    /**\n     * Excludes all query parameters except those provided from the cache key.  We also refer to\n     * this as \"whitelisting\" query parameters.  We recommend using this method over `excludeQueryParameters`\n     * as it's difficult to know all of the query parameters your application might receive and unexpected\n     * query parameters can lead to significantly lower cache hit rates.\n     * @param names The names of the query parameters to whitelist\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    excludeAllQueryParametersExcept(...names) {\n        this.config.push({\n            action: exports.CUSTOM_CACHE_KEY_ACTIONS.whitelistSome,\n            names,\n        });\n        this.actions.push((key, srcRequest) => {\n            const toKeep = new Set(names);\n            for (let name in key.query) {\n                if (!toKeep.has(name)) {\n                    delete key.query[name];\n                }\n            }\n        });\n        return this;\n    }\n    /**\n     * Adds a request header to the cache key.\n     * This will have no effect on service worker cache.\n     * @param name The name of the request header\n     * @param createGroups A function that accepts a `Groups` instance and calls `groups.group(name)` to group multiple values into a single cache key component\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    addHeader(name, createGroups) {\n        this.actions.push((key, srcRequest) => {\n            let values = srcRequest.headers[name];\n            if (!Array.isArray(values)) {\n                values = [values];\n            }\n            if (createGroups) {\n                key.headers[name] = this.createGroupedValue(createGroups, values);\n            }\n            else {\n                key.headers[name] = values;\n            }\n        });\n        return this.addValue(`\\${req:${name}}`, createGroups);\n    }\n    /**\n     * Removes the HTTP method from the cache key.\n     * @return A self-reference, suitable for chaining.\n     */\n    removeMethod() {\n        this.actions.push((key, srcRequest) => {\n            key.method = undefined;\n        });\n        this.config.push({\n            action: exports.CUSTOM_CACHE_KEY_ACTIONS.removeMethod,\n        });\n        return this;\n    }\n    /**\n     * Removes the HTTP body from the cache key.\n     * @return A self-reference, suitable for chaining.\n     */\n    removeBody() {\n        this.actions.push((key, srcRequest) => {\n            key.body = undefined;\n        });\n        this.config.push({\n            action: exports.CUSTOM_CACHE_KEY_ACTIONS.removeBody,\n        });\n        return this;\n    }\n    /**\n     * Creates a key value for a header or cookie based on the specified group creator\n     * @param createGroups the GroupCreator\n     * @param srcValues The values of the header or cookie in the request\n     */\n    createGroupedValue(createGroups, srcValues) {\n        const groups = new Groups_1.default();\n        const result = [];\n        createGroups(groups);\n        const matchingGroup = this.findMatchingGroup(groups, srcValues);\n        if (matchingGroup) {\n            result.push(matchingGroup);\n        }\n        else {\n            // if the value doesn't match any group, use the value itself\n            result.push(...srcValues);\n        }\n        return result;\n    }\n    findMatchingGroup(groups, srcValues) {\n        var _a;\n        for (let group of groups.groups) {\n            for (let value of srcValues) {\n                /* istanbul ignore next */\n                if ((_a = group.pattern) === null || _a === void 0 ? void 0 : _a.test(value)) {\n                    return group.name;\n                }\n            }\n        }\n    }\n    /**\n     * Specifies that requests should be cached on a per-device basis.\n     * This will have no effect on service worker cache.\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    addDevice() {\n        return this.addHeader('x-0-device');\n    }\n    /**\n     * Specifies that requests should be cached on a per-vendor basis.\n     * This will have no effect on service worker cache.\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    addVendor() {\n        return this.addHeader('x-0-vendor');\n    }\n    /**\n     * Specifies that requests should be cached differently for bots.\n     * This will have no effect on service worker cache.\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    addIsBot() {\n        return this.addHeader('x-0-device-is-bot');\n    }\n    /**\n     * Specifies that requests should be cached on a per-browser basis.\n     * This will have no effect on service worker cache.\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    addBrowser() {\n        return this.addHeader('x-0-browser');\n    }\n    /**\n     * Adds a cookie to the cache key.\n     * This will have no effect on service worker cache.\n     * @param name The name of the cookie\n     * @param createGroups An function that accepts a `Groups` instance and calls `groups.group(name)` to group multiple values into a single cache key component\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    addCookie(name, createGroups) {\n        this.actions.push((key, srcRequest) => {\n            let cookieHeader = srcRequest.headers.cookie || '';\n            if (Array.isArray(cookieHeader)) {\n                // Based on https://tools.ietf.org/html/rfc6265#section-5.4 we should only get a single cookie header\n                // If we get more than one, we, just join them into a single parseable cookie value in case\n                // the origin decides to read them all\n                cookieHeader = cookieHeader.join(';');\n            }\n            const cookie = cookie_1.parse(cookieHeader);\n            const value = cookie[name];\n            if (createGroups) {\n                key.cookies[name] = this.createGroupedValue(createGroups, [value]);\n            }\n            else {\n                key.cookies[name] = value;\n            }\n        });\n        return this.addValue(`\\${req:cookie:${name}}`, createGroups);\n    }\n    /**\n     * @private\n     * @return {CustomCacheKey} A self-reference, suitable for chaining.\n     */\n    addValue(value, createGroups) {\n        const action = {\n            action: exports.CUSTOM_CACHE_KEY_ACTIONS.addValue,\n            value,\n        };\n        if (createGroups != null) {\n            const groups = new Groups_1.default();\n            createGroups(groups);\n            action.groups = groups.toJSON();\n        }\n        this.config.push(action);\n        return this;\n    }\n    getActions() {\n        return this.actions;\n    }\n    toJSON() {\n        return this.config;\n    }\n}\nexports.default = CustomCacheKey;\n", "\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./router\"));\n__export(require(\"./constants\"));\nvar config_1 = require(\"./config\");\nexports.config = config_1.default;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst __1 = require(\"..\");\n/**\n * Creates a response transformer that assigns surrogate keys for the given body parsed as JSON. Accepts a\n * callback function that takes the response body parsed as json and returns an array of surrogate\n * keys to assign the response when cached. This function will only be called on cache misses. When a request\n * has no body or a body that cannot be parsed as JSON, the callback function will be passed `undefined`.\n * Returning anything other than an array of string will result in no surrogate keys being assigned and a warning\n * will be logged.\n *\n * Example:\n *\n * ```\n *  new Router()\n *    .graphqlOperation('GetPost', ({ cache }) => {\n *      cache({\n *        edge: {\n *          maxAgeSeconds: 60 * 60\n *        }\n *      })\n *      proxy('graphql', {\n *        transformResponse: deriveSurrogateKeysFromJson(json => [`posts.${json.id}`])\n *      })\n *    })\n * ```\n * @param extractKeys\n * @returns\n */\nfunction deriveSurrogateKeysFromJson(extractKeys, options = { onConflict: 'merge' }) {\n    return async (res) => {\n        const result = extractKeys(parseBodyAsJson(res.body));\n        if (!Array.isArray(result)) {\n            console.warn(`The function provided to deriveSurrogateKeysFromJson should return an array, but returned a value of type \"${typeof result}\" instead. Surrogate keys will not be set.`);\n            return;\n        }\n        const keys = new Set(result);\n        if (options.onConflict === 'merge') {\n            let surrogateKeyFromOrigin = res.getHeader(__1.HTTP_HEADERS.x0SurrogateKey);\n            if (surrogateKeyFromOrigin != null) {\n                if (!Array.isArray(surrogateKeyFromOrigin)) {\n                    surrogateKeyFromOrigin = [surrogateKeyFromOrigin];\n                }\n                for (let header of surrogateKeyFromOrigin) {\n                    for (let key of header.split(' ')) {\n                        keys.add(key);\n                    }\n                }\n            }\n        }\n        else if (options.onConflict !== 'override') {\n            throw new Error(`invalid value \"${options.onConflict}\" for onConflict option in deriveSurrogateKeysFromJson. Use \"override\" or \"merge\".`);\n        }\n        if (keys.size > 0) {\n            res.setHeader(__1.HTTP_HEADERS.x0SurrogateKey, Array.from(keys).join(' '));\n        }\n    };\n}\nexports.default = deriveSurrogateKeysFromJson;\nfunction parseBodyAsJson(body) {\n    if (!body) {\n        return undefined;\n    }\n    try {\n        return JSON.parse(typeof body === 'string' ? body : body.toString('utf8'));\n    }\n    catch (e) {\n        return undefined;\n    }\n}\n", "\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst CustomCacheKey_1 = __importDefault(require(\"./CustomCacheKey\"));\n/**\n * Returns a DSL for creating custom server cache keys based on cookies, query parameters, and\n * request headers.\n *\n * example:\n *\n * ```js\n *  new Router()\n *    .get('/s/:id',\n *      cache({\n *        edge: {\n *          key: createCustomCacheKey()\n *            .addHeader('user-agent')\n *            .excludeQueryParameters(['uid'])\n *            .addCookie('location', cookie => {\n *              cookie.group('na').byPattern('us|ca')\n *              cookie.group('eur').byPattern('de|fr|ee')\n *            })\n *        }\n *      })\n *    )\n * ```\n * @deprecated Use `new CustomCacheKey()` instead.\n * @return {CustomCacheKey}\n */\nfunction createCustomCacheKey() {\n    return new CustomCacheKey_1.default();\n}\nexports.default = createCustomCacheKey;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Router_1 = require(\"./Router\");\nexports.Router = Router_1.default;\nvar CustomCacheKey_1 = require(\"./CustomCacheKey\");\nexports.CustomCacheKey = CustomCacheKey_1.default;\nvar ResponseWriter_1 = require(\"./ResponseWriter\");\nexports.ResponseWriter = ResponseWriter_1.default;\nvar deriveSurrogateKeysFromJson_1 = require(\"./deriveSurrogateKeysFromJson\");\nexports.deriveSurrogateKeysFromJson = deriveSurrogateKeysFromJson_1.default;\n/**\n * We've deprecated this to simplify the API. The examples in the docs now use `new CustomCacheKey()` instead.\n * @private\n * @deprecated Use `new CustomCacheKey()` instead.\n */\nvar createCustomCacheKey_1 = require(\"./createCustomCacheKey\");\nexports.createCustomCacheKey = createCustomCacheKey_1.default;\n", "// This file was added by layer0 init.\n// You should commit this file to source control.\n\nimport { Router } from '@layer0/core/router'\n\nexport default new Router()\n\n  .noIndexPermalink()\n  // Send requests to static assets in the build output folder `dist`\n  .static('dist')\n\n  // Send everything else to the App Shell\n  .fallback(({ appShell }) => {\n    appShell('dist/index.html')\n  })\n"],
  "mappings": "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",
  "names": []
}
